[
  {
    "updatedAt": "2025-12-08T18:55:49.000Z",
    "createdAt": "2025-06-20T01:04:28.472Z",
    "id": "3vZyObH9koXfTnp8",
    "name": "Leads R&R",
    "active": true,
    "isArchived": false,
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "leads",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          -1904,
          1376
        ],
        "id": "d0908e51-97fa-42bd-85d0-1553a8b1808e",
        "name": "Webhook",
        "webhookId": "a3414e97-f942-4938-a579-02cbf2d4bf12"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $('Webhook').item.json.body.referrer }}",
                      "rightValue": "https://camarasseguridad.net/",
                      "operator": {
                        "type": "string",
                        "operation": "contains"
                      },
                      "id": "8f3859ea-ae2e-4b73-994a-50b8a7abddf1"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "camaras CR"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "5aa0ed40-7430-4dbc-a76b-89dee516d122",
                      "leftValue": "={{ $('Webhook').item.json.body.referrer }}",
                      "rightValue": "https://mecanicapesada.top/",
                      "operator": {
                        "type": "string",
                        "operation": "contains"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Meca pesada"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "933ffc16-ac72-4e54-ad3b-19da3ffeceea",
                      "leftValue": "={{ $('Webhook').item.json.body.referrer }}",
                      "rightValue": "https://allpol.com.ar/",
                      "operator": {
                        "type": "string",
                        "operation": "contains"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Allpol"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "4f429151-5941-4228-ad42-ba5e3fa19ebc",
                      "leftValue": "={{ $('Webhook').item.json.body.referrer }}",
                      "rightValue": "https://cr-sites.com/bolsas-maceta/",
                      "operator": {
                        "type": "string",
                        "operation": "contains"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Bolsas Maceta"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "9334526e-7727-421d-aa5a-f6d8d3492040",
                      "leftValue": "={{ $('Webhook').item.json.body.referrer }}",
                      "rightValue": "https://laplata.camarasseguridad.net/",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Cámaras LP"
              }
            ]
          },
          "options": {
            "fallbackOutput": "none"
          }
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          144,
          1024
        ],
        "id": "d5955acd-6a28-47f9-8abe-e061836a02f7",
        "name": "Switch"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "1FdSsi95qgMzvCJ8N10-jloPiTJuCFF5_ZDPwVihQ69I",
            "mode": "list",
            "cachedResultName": "Leads Allpol",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FdSsi95qgMzvCJ8N10-jloPiTJuCFF5_ZDPwVihQ69I/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Hoja 1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FdSsi95qgMzvCJ8N10-jloPiTJuCFF5_ZDPwVihQ69I/edit#gid=0"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "ingreso": "={{ $json[\"currentDate-ARG\"] }}",
              "nombre": "={{ $('Webhook').item.json.body.nombre }}",
              "telefono": "={{ $('Webhook').item.json.body[\"Número de WhatsApp\"] }}",
              "producto": "={{ $('Webhook').item.json.body.mensaje }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "ingreso",
                "displayName": "ingreso",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "nombre",
                "displayName": "nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "telefono",
                "displayName": "telefono",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "producto",
                "displayName": "producto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.6,
        "position": [
          592,
          1168
        ],
        "id": "c5aa7fad-d608-43ce-a702-19b76c3f8525",
        "name": "Agrega contacos de la web a Leads Allpol",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "XCVUrxXJwWv4s45E",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "inputText": "={{ $('Webhook').item.json.body.mensaje }}",
          "categories": {
            "categories": [
              {
                "category": "lead",
                "description": "Dinero entrante, solicitudes relacionadas a servicios o productos,cotizacion, instalacion o reparacion. Todo lo que sea un lead para nosotros."
              },
              {
                "category": "otros",
                "description": "Solicitudes de empleo u ofrecimientos de cv.\nOfrecimiento de servicios o productos por parte de proveedores, personas o empresas que quieran vendernos algo."
              }
            ]
          },
          "options": {
            "fallback": "discard"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.textClassifier",
        "typeVersion": 1.1,
        "position": [
          -1248,
          1376
        ],
        "id": "945a89e4-3a1d-45f7-8ddf-66db4d7041d8",
        "name": "Text Classifier"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatDeepSeek",
        "typeVersion": 1,
        "position": [
          -1248,
          1584
        ],
        "id": "bb3fb79c-e121-4d11-9fb8-293adef89baf",
        "name": "DeepSeek Chat Model",
        "credentials": {
          "deepSeekApi": {
            "id": "l9T4qmBFqTej3Qxo",
            "name": "DeepSeek account"
          }
        }
      },
      {
        "parameters": {
          "outputFieldName": "currentDate-CR",
          "options": {
            "timezone": "America/Costa_Rica"
          }
        },
        "type": "n8n-nodes-base.dateTime",
        "typeVersion": 2,
        "position": [
          368,
          784
        ],
        "id": "59a3933d-1513-4372-928e-f0531b6c4593",
        "name": "Costa Rica"
      },
      {
        "parameters": {
          "outputFieldName": "currentDate-ARG",
          "options": {
            "timezone": "America/Buenos_Aires"
          }
        },
        "type": "n8n-nodes-base.dateTime",
        "typeVersion": 2,
        "position": [
          368,
          1168
        ],
        "id": "50bcf71f-401f-469d-862a-bd291b9b9ec3",
        "name": "Argentina"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "triggerAtHour": 6
              }
            ]
          }
        },
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          -1936,
          848
        ],
        "id": "304e4c03-f547-4db7-96da-607b53215b61",
        "name": "Schedule Trigger"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "d7c31bf0-ee99-4f20-b84a-10ca0bdd1407"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "1"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "137bfc40-aa1b-4d81-a3ab-e80de79b57fc",
                      "leftValue": "",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "2"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "6f2ba0e7-86e2-48f4-9fda-b79e6356e2f1",
                      "leftValue": "",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "3"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "3679acc8-fda4-495d-ab14-c8de55b0a049",
                      "leftValue": "",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "4"
              }
            ]
          },
          "options": {
            "allMatchingOutputs": true
          }
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          -1712,
          816
        ],
        "id": "1a3cccd5-c6b1-4b8f-a4c1-0fcd082d32e6",
        "name": "Switch1"
      },
      {
        "parameters": {
          "operation": "restart-instance",
          "instanceName": "evolutionapi"
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          -1488,
          752
        ],
        "id": "077ea19c-7262-4887-b5d5-01df6ca3305b",
        "name": "Malco CR",
        "credentials": {
          "evolutionApi": {
            "id": "lgR3M6buNvrwBzQ0",
            "name": "Evolution 50662292932 - Malco CR"
          }
        }
      },
      {
        "parameters": {
          "operation": "restart-instance",
          "instanceName": "Smart CR"
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          -1488,
          560
        ],
        "id": "9dd76b25-cfcd-49ad-bb58-06b11e3201f4",
        "name": "Smart CR",
        "credentials": {
          "evolutionApi": {
            "id": "zEeNcZfyeYVosz78",
            "name": "Smart CR"
          }
        }
      },
      {
        "parameters": {
          "operation": "restart-instance",
          "instanceName": "Allpol"
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          -1488,
          944
        ],
        "id": "7d844b9f-669c-41c3-8801-0874b345b592",
        "name": "Allpol",
        "credentials": {
          "evolutionApi": {
            "id": "BcKApPoAEmD2PL5m",
            "name": "wsp Allpol - 221 6925658"
          }
        }
      },
      {
        "parameters": {
          "outputFieldName": "currentDate-ARG",
          "options": {
            "timezone": "America/Buenos_Aires"
          }
        },
        "type": "n8n-nodes-base.dateTime",
        "typeVersion": 2,
        "position": [
          368,
          976
        ],
        "id": "78608835-bf87-4c16-9eff-0d6fff96a007",
        "name": "Argentina2"
      },
      {
        "parameters": {
          "outputFieldName": "currentDate-ARG",
          "options": {
            "timezone": "America/Buenos_Aires"
          }
        },
        "type": "n8n-nodes-base.dateTime",
        "typeVersion": 2,
        "position": [
          368,
          1360
        ],
        "id": "f738fdf7-cf1c-4b36-a3e2-d40e8f2cc40e",
        "name": "Argentina1"
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "Malco ARG",
          "remoteJid": "5492215548877",
          "messageText": "=Alejandro buenas, entro un mensaje de la pagina, si no te escribió le podes escribir vos, acá te dejo los datos:\n\n{{ $('Webhook').item.json.body.referrer }}\nSolicitud de contacto:\nfecha/hs: {{ $('Webhook').item.json.body.sentDateUTC }}\nnombre: {{ $('Webhook').item.json.body.Nombre }}\ntel: {{ $('Webhook').item.json.body['Número de WhatsApp'] }}\nmensaje: {{ $('Webhook').item.json.body.mensaje }}",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          -2592,
          2896
        ],
        "id": "92684be8-29fe-44f7-8a8c-f91f4315dc40",
        "name": "Alejandro",
        "credentials": {
          "evolutionApi": {
            "id": "uFLlpp0hjQkOnZnJ",
            "name": "Evolution 5492216115728 - Malco ARG"
          }
        }
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "Malco ARG",
          "remoteJid": "5492213184300",
          "messageText": "=Mati buenas, entro un mensaje de la pagina, si no te escribió le podes escribir vos, acá te dejo los datos:\n\n{{ $('Webhook').item.json.body.referrer }}\nSolicitud de contacto:\nfecha/hs: {{ $('Webhook').item.json.body.sentDateUTC }}\nnombre: {{ $('Webhook').item.json.body.Nombre }}\ntel: {{ $('Webhook').item.json.body['Número de WhatsApp'] }}\nmensaje: {{ $('Webhook').item.json.body.mensaje }}",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          -2592,
          2448
        ],
        "id": "41570900-1c48-46a4-80d7-a30059f58bf8",
        "name": "Matias",
        "credentials": {
          "evolutionApi": {
            "id": "uFLlpp0hjQkOnZnJ",
            "name": "Evolution 5492216115728 - Malco ARG"
          }
        }
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "1HU_G0Hy4IX3GuNccFU1Q-P1rUjeOVNd3XKr7e4FGSHk",
            "mode": "list",
            "cachedResultName": "Base de Datos - Leads",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HU_G0Hy4IX3GuNccFU1Q-P1rUjeOVNd3XKr7e4FGSHk/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1755573248,
            "mode": "list",
            "cachedResultName": "leads",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HU_G0Hy4IX3GuNccFU1Q-P1rUjeOVNd3XKr7e4FGSHk/edit#gid=1755573248"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [
              {
                "id": "timestamp",
                "displayName": "timestamp",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "lead_id",
                "displayName": "lead_id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "client_name",
                "displayName": "client_name",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "client_phone",
                "displayName": "client_phone",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "client_location",
                "displayName": "client_location",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "service_details",
                "displayName": "service_details",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "lead_source",
                "displayName": "lead_source",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "professional_id",
                "displayName": "professional_id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "price_per_lead",
                "displayName": "price_per_lead",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "currency_code",
                "displayName": "currency_code",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "status",
                "displayName": "status",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "notified_timestamp",
                "displayName": "notified_timestamp",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "weekly_summary_id",
                "displayName": "weekly_summary_id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.6,
        "position": [
          592,
          784
        ],
        "id": "b3bd1eb5-eca4-4d06-ace0-03fccbe6dca1",
        "name": "Append row in sheet",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "XCVUrxXJwWv4s45E",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "edf444ee-1b8d-4cb7-930e-42fabc24d557",
                "name": "client_name",
                "value": "={{ $json.body.nombre }}",
                "type": "string"
              },
              {
                "id": "853fffdc-e7b7-4379-9c54-ed218f8e6850",
                "name": "client_phone",
                "value": "={{ $json.body.tel }}",
                "type": "string"
              },
              {
                "id": "d0170f01-7548-4755-98d1-f70f3948d7a4",
                "name": "service_details",
                "value": "={{ $json.body.serv }}",
                "type": "string"
              },
              {
                "id": "7a69fec7-af59-4e5c-a985-97aea15601e3",
                "name": "lead_source",
                "value": "={{ $json.body.referrerArrival }}",
                "type": "string"
              },
              {
                "id": "97d463d6-b45a-4c35-aee2-bb06cbe202bc",
                "name": "professional_whatsapp",
                "value": "={{ $('Webhook').item.json.body.phoneAgent }}",
                "type": "string"
              },
              {
                "id": "887d5af4-c7e2-4389-aee5-9245499d6ae2",
                "name": "timestamp",
                "value": "={{ DateTime.now().setZone('America/Costa_Rica').toFormat('yyyy-MM-dd HH:mm:ss') }}",
                "type": "string"
              },
              {
                "id": "9162b23f-bdf3-4e3e-b040-d36c2f61cb69",
                "name": "ubicacion",
                "value": "={{ $json.body.ubi }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -1680,
          1376
        ],
        "id": "1b4c1ea5-ab30-4cec-927b-482d64448191",
        "name": "Edit Fields"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "9cbab708-bf85-4f1b-a591-b63303f36b0e",
                "leftValue": "={{ $json.daily_prompt_id }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -464,
          1360
        ],
        "id": "7ded00a4-a7c3-4f67-8940-d4241b06f609",
        "name": "If"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          -1552,
          2144
        ],
        "id": "99b1e00a-f9b8-4562-9e11-48f2c8d65738",
        "name": "Loop Over Items"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Leads a notificar en concordancia ordinal: {{ $json.client_name }} - {{ $json.client_phone }} - {{ $json.service_details }} - {{ $json.timestamp }}",
          "options": {
            "systemMessage": "={{ $('Loop Over Items').item.json.daily_prompt_id }}"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 2.2,
        "position": [
          -656,
          1904
        ],
        "id": "c04e9dc5-d584-4c12-bf43-0a2cac1f829b",
        "name": "AI Agent"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "30ef8bd3-c0e8-41ab-877a-c520f8aa3763",
                "leftValue": "={{ $json.client_name }}",
                "rightValue": "",
                "operator": {
                  "type": "array",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "looseTypeValidation": "={{ false }}",
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -880,
          1904
        ],
        "id": "b77af841-3214-4f61-a29f-7bac5c5023e5",
        "name": "If1"
      },
      {
        "parameters": {
          "fieldsToAggregate": {
            "fieldToAggregate": [
              {
                "fieldToAggregate": "client_name"
              },
              {
                "fieldToAggregate": "client_phone"
              },
              {
                "fieldToAggregate": "service_details"
              },
              {
                "fieldToAggregate": "timestamp"
              }
            ]
          },
          "options": {
            "mergeLists": true
          }
        },
        "type": "n8n-nodes-base.aggregate",
        "typeVersion": 1,
        "position": [
          -1104,
          1904
        ],
        "id": "cdac17f2-d509-42e9-8538-7d78feb0cef3",
        "name": "Aggregate"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "triggerAtHour": 17,
                "triggerAtMinute": 7
              }
            ]
          }
        },
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          -2000,
          2240
        ],
        "id": "fdaef204-c7c0-4a96-b763-2f4e5f40158d",
        "name": "Diario"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3.2,
        "position": [
          -80,
          2160
        ],
        "id": "4b034838-2ae8-499c-942e-cc49bb12cf0a",
        "name": "Merge"
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "evolutionapi",
          "remoteJid": "50662292932",
          "messageText": "={{ $json.output }}",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          -2592,
          2672
        ],
        "id": "74c0467c-c5c4-42e9-aa44-a9383239f401",
        "name": "A mi los descartados1",
        "credentials": {
          "evolutionApi": {
            "id": "lgR3M6buNvrwBzQ0",
            "name": "Evolution 50662292932 - Malco CR"
          }
        }
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "evolutionapi",
          "remoteJid": "=5492216115728",
          "messageText": "={{ $json.output }}",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          -304,
          1904
        ],
        "id": "febf77e0-4a30-4e42-b39f-751438a136cd",
        "name": "A mi de prueba",
        "credentials": {
          "evolutionApi": {
            "id": "lgR3M6buNvrwBzQ0",
            "name": "Evolution 50662292932 - Malco CR"
          }
        }
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{ $('Loop Over Items').item.json.whatsapp_number }}",
          "contextWindowLength": 7
        },
        "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "typeVersion": 1.3,
        "position": [
          -560,
          2064
        ],
        "id": "050f08bf-2b3c-4324-85c6-9e2843e8cda1",
        "name": "Simple Memory"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "claude-3-7-sonnet-20250219",
            "mode": "list",
            "cachedResultName": "Claude Sonnet 3.7"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
        "typeVersion": 1.3,
        "position": [
          -736,
          2064
        ],
        "id": "2be5222d-c7c9-4d58-a05d-5e3d97cd4d4a",
        "name": "Anthropic Chat Model",
        "credentials": {
          "anthropicApi": {
            "id": "KvZF7MNs1iI9NLKB",
            "name": "Anthropic account"
          }
        }
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "evolutionapi",
          "remoteJid": "542216115728",
          "messageText": "Hubo un fallo en la coneccion de N8N con Google",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          -1552,
          2336
        ],
        "id": "09a70a8d-0411-4045-9a83-93cda4bb86df",
        "name": "Enviar texto",
        "credentials": {
          "evolutionApi": {
            "id": "lgR3M6buNvrwBzQ0",
            "name": "Evolution 50662292932 - Malco CR"
          }
        }
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "evolutionapi",
          "remoteJid": "542216115728",
          "messageText": "Hubo un fallo en la coneccion de N8N con Google",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          -592,
          1568
        ],
        "id": "38649981-33c0-4099-9a16-fef5982d3613",
        "name": "Enviar texto1",
        "credentials": {
          "evolutionApi": {
            "id": "lgR3M6buNvrwBzQ0",
            "name": "Evolution 50662292932 - Malco CR"
          }
        }
      },
      {
        "parameters": {
          "operation": "search",
          "base": {
            "__rl": true,
            "value": "appuqvJKOHdjlI6Np",
            "mode": "list",
            "cachedResultName": "Profesionales",
            "cachedResultUrl": "https://airtable.com/appuqvJKOHdjlI6Np"
          },
          "table": {
            "__rl": true,
            "value": "tblowzUNVeV8gYJZq",
            "mode": "list",
            "cachedResultName": "hoja1",
            "cachedResultUrl": "https://airtable.com/appuqvJKOHdjlI6Np/tblowzUNVeV8gYJZq"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.airtable",
        "typeVersion": 2.1,
        "position": [
          -1776,
          2240
        ],
        "id": "a1c5d1a4-70ec-4b40-a29b-2babdda2ac4c",
        "name": "Lista profesionales",
        "credentials": {
          "airtableTokenApi": {
            "id": "2zDfs1ZY0VzfVfyg",
            "name": "Airtable Personal Access Token account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "operation": "search",
          "base": {
            "__rl": true,
            "value": "app8jff881WWUr8Sl",
            "mode": "list",
            "cachedResultName": "Base de Datos - Leads",
            "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl"
          },
          "table": {
            "__rl": true,
            "value": "tblCq162vKS035OZf",
            "mode": "list",
            "cachedResultName": "leads",
            "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl/tblCq162vKS035OZf"
          },
          "filterByFormula": "=AND({professional_id} = '{{ $json.whatsapp_number }}', {status} = 'sin-notificar')",
          "returnAll": false,
          "options": {}
        },
        "type": "n8n-nodes-base.airtable",
        "typeVersion": 2.1,
        "position": [
          -1296,
          2160
        ],
        "id": "47fd2f1f-4efd-46ce-80d1-7ca822493e88",
        "name": "Leads sin notificar",
        "credentials": {
          "airtableTokenApi": {
            "id": "2zDfs1ZY0VzfVfyg",
            "name": "Airtable Personal Access Token account"
          }
        }
      },
      {
        "parameters": {
          "operation": "upsert",
          "base": {
            "__rl": true,
            "value": "app8jff881WWUr8Sl",
            "mode": "list",
            "cachedResultName": "Base de Datos - Leads",
            "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl"
          },
          "table": {
            "__rl": true,
            "value": "tblCq162vKS035OZf",
            "mode": "list",
            "cachedResultName": "leads",
            "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl/tblCq162vKS035OZf"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "client_phone": "={{ $json.client_phone }}",
              "status": "notificado",
              "notified_timestamp": "={{new Date().toLocaleDateString()}}"
            },
            "matchingColumns": [
              "client_phone"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "readOnly": true,
                "removed": false
              },
              {
                "id": "timestamp",
                "displayName": "timestamp",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "client_name",
                "displayName": "client_name",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "client_phone",
                "displayName": "client_phone",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "client_location",
                "displayName": "client_location",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "service_details",
                "displayName": "service_details",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "lead_source",
                "displayName": "lead_source",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "De qué página o campaña vino el lead.",
                    "value": "De qué página o campaña vino el lead."
                  },
                  {
                    "name": "camarasseguridad.net",
                    "value": "camarasseguridad.net"
                  },
                  {
                    "name": "https://services.tochat.be/es/app/whatsapp/1b7894f5-baf9-4fb6-bb30-2fc621360617/edit",
                    "value": "https://services.tochat.be/es/app/whatsapp/1b7894f5-baf9-4fb6-bb30-2fc621360617/edit"
                  },
                  {
                    "name": "https://services.tochat.be/es/app/whatsapp/form/whatsapp-form/1b7894f5-baf9-4fb6-bb30-2fc621360617",
                    "value": "https://services.tochat.be/es/app/whatsapp/form/whatsapp-form/1b7894f5-baf9-4fb6-bb30-2fc621360617"
                  },
                  {
                    "name": "https://camarasseguridad.net/",
                    "value": "https://camarasseguridad.net/"
                  },
                  {
                    "name": "https://laplata.camarasseguridad.net/",
                    "value": "https://laplata.camarasseguridad.net/"
                  },
                  {
                    "name": "https://camarasseguridad.net/#servicios",
                    "value": "https://camarasseguridad.net/#servicios"
                  },
                  {
                    "name": "FALSE",
                    "value": "FALSE"
                  },
                  {
                    "name": "https://camarasseguridad.net/#formulario",
                    "value": "https://camarasseguridad.net/#formulario"
                  },
                  {
                    "name": "https://camarasseguridad.net/costa-rica/alajuela/",
                    "value": "https://camarasseguridad.net/costa-rica/alajuela/"
                  },
                  {
                    "name": "https://camarasseguridad.net/?utm_source=google&utm_medium=organic&utm_content=main_button&utm_campaign=gmb",
                    "value": "https://camarasseguridad.net/?utm_source=google&utm_medium=organic&utm_content=main_button&utm_campaign=gmb"
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "professional_id",
                "displayName": "professional_id",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "Identificador único del profesional asignado.",
                    "value": "Identificador único del profesional asignado."
                  },
                  {
                    "name": "50660742444",
                    "value": "50660742444"
                  },
                  {
                    "name": "542215548877",
                    "value": "542215548877"
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "price_per_lead",
                "displayName": "price_per_lead",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "Costo acordado por este lead específico.",
                    "value": "Costo acordado por este lead específico."
                  },
                  {
                    "name": "2000",
                    "value": "2000"
                  },
                  {
                    "name": "5000",
                    "value": "5000"
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "currency_code",
                "displayName": "currency_code",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "Código de la moneda para el cobro.",
                    "value": "Código de la moneda para el cobro."
                  },
                  {
                    "name": "CRC (Colones), ARS (Pesos)",
                    "value": "CRC (Colones), ARS (Pesos)"
                  },
                  {
                    "name": "CRC",
                    "value": "CRC"
                  },
                  {
                    "name": "ARS",
                    "value": "ARS"
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "status",
                "displayName": "status",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "Estado del lead en el flujo de n8n.",
                    "value": "Estado del lead en el flujo de n8n."
                  },
                  {
                    "name": "notificado",
                    "value": "notificado"
                  },
                  {
                    "name": "sin-notificar",
                    "value": "sin-notificar"
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "notified_timestamp",
                "displayName": "notified_timestamp",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "weekly_summary_id",
                "displayName": "weekly_summary_id",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.airtable",
        "typeVersion": 2.1,
        "position": [
          -336,
          2176
        ],
        "id": "1bc8d79c-99be-4852-a1f2-9a903d59649c",
        "name": "cambia a notificado",
        "credentials": {
          "airtableTokenApi": {
            "id": "2zDfs1ZY0VzfVfyg",
            "name": "Airtable Personal Access Token account"
          }
        }
      },
      {
        "parameters": {
          "operation": "create",
          "base": {
            "__rl": true,
            "value": "app8jff881WWUr8Sl",
            "mode": "list",
            "cachedResultName": "Base de Datos - Leads",
            "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl"
          },
          "table": {
            "__rl": true,
            "value": "tblCq162vKS035OZf",
            "mode": "list",
            "cachedResultName": "leads",
            "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl/tblCq162vKS035OZf"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "timestamp": "={{ $('Edit Fields').item.json.timestamp }}",
              "client_name": "={{ $('Edit Fields').item.json.client_name }}",
              "client_phone": "={{ $('Edit Fields').item.json.client_phone }}",
              "client_location": "={{ $('Edit Fields').item.json.ubicacion }}",
              "service_details": "={{ $('Edit Fields').item.json.service_details }}",
              "lead_source": "={{ $('Edit Fields').item.json.lead_source }}",
              "professional_id": "={{ $('Edit Fields').item.json.professional_whatsapp }}",
              "price_per_lead": "={{ $('Busca profesional').item.json.price_per_lead }}",
              "status": "=sin-notificar",
              "currency_code": "={{ $('Busca profesional').item.json.currency_code }}",
              "notified_timestamp": "={{ $now }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "timestamp",
                "displayName": "timestamp",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "client_name",
                "displayName": "client_name",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "client_phone",
                "displayName": "client_phone",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "client_location",
                "displayName": "client_location",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "service_details",
                "displayName": "service_details",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "lead_source",
                "displayName": "lead_source",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "professional_id",
                "displayName": "professional_id",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "price_per_lead",
                "displayName": "price_per_lead",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "Costo acordado por este lead específico.",
                    "value": "Costo acordado por este lead específico."
                  },
                  {
                    "name": "2000",
                    "value": "2000"
                  },
                  {
                    "name": "5000",
                    "value": "5000"
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "currency_code",
                "displayName": "currency_code",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "Código de la moneda para el cobro.",
                    "value": "Código de la moneda para el cobro."
                  },
                  {
                    "name": "CRC (Colones), ARS (Pesos)",
                    "value": "CRC (Colones), ARS (Pesos)"
                  },
                  {
                    "name": "CRC",
                    "value": "CRC"
                  },
                  {
                    "name": "ARS",
                    "value": "ARS"
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "status",
                "displayName": "status",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "Estado del lead en el flujo de n8n.",
                    "value": "Estado del lead en el flujo de n8n."
                  },
                  {
                    "name": "notificado",
                    "value": "notificado"
                  },
                  {
                    "name": "sin-notificar",
                    "value": "sin-notificar"
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "notified_timestamp",
                "displayName": "notified_timestamp",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "weekly_summary_id",
                "displayName": "weekly_summary_id",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.airtable",
        "typeVersion": 2.1,
        "position": [
          256,
          1520
        ],
        "id": "c7eecea6-4f63-4a17-a02b-fb7680e559f5",
        "name": "Create a record",
        "credentials": {
          "airtableTokenApi": {
            "id": "2zDfs1ZY0VzfVfyg",
            "name": "Airtable Personal Access Token account"
          }
        }
      },
      {
        "parameters": {
          "operation": "search",
          "base": {
            "__rl": true,
            "value": "appuqvJKOHdjlI6Np",
            "mode": "list",
            "cachedResultName": "Profesionales",
            "cachedResultUrl": "https://airtable.com/appuqvJKOHdjlI6Np"
          },
          "table": {
            "__rl": true,
            "value": "tblowzUNVeV8gYJZq",
            "mode": "list",
            "cachedResultName": "hoja1",
            "cachedResultUrl": "https://airtable.com/appuqvJKOHdjlI6Np/tblowzUNVeV8gYJZq"
          },
          "filterByFormula": "=AND({whatsapp_number} = {{$json.professional_whatsapp}}, {activo?} = 'si')",
          "options": {
            "fields": [
              "daily_prompt_id",
              "price_per_lead",
              "currency_code"
            ]
          }
        },
        "type": "n8n-nodes-base.airtable",
        "typeVersion": 2.1,
        "position": [
          -896,
          1360
        ],
        "id": "49aa9822-2b8c-4a0c-95b9-b6a23419cf02",
        "name": "Busca profesional",
        "alwaysOutputData": false,
        "credentials": {
          "airtableTokenApi": {
            "id": "2zDfs1ZY0VzfVfyg",
            "name": "Airtable Personal Access Token account"
          }
        }
      },
      {
        "parameters": {
          "operation": "search",
          "base": {
            "__rl": true,
            "value": "app8jff881WWUr8Sl",
            "mode": "list",
            "cachedResultName": "Base de Datos - Leads",
            "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl"
          },
          "table": {
            "__rl": true,
            "value": "tblCq162vKS035OZf",
            "mode": "list",
            "cachedResultName": "leads",
            "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl/tblCq162vKS035OZf"
          },
          "filterByFormula": "=AND(\n  {client_phone} = '{{ $('Edit Fields').item.json.client_phone }}',\n  OR(\n    IS_SAME(DATETIME_PARSE({timestamp}, 'YYYY-MM-DD HH:mm:ss'), TODAY(), 'day'),\n    IS_SAME(DATETIME_PARSE({timestamp}, 'YYYY-MM-DD HH:mm:ss'), DATEADD(TODAY(), -1, 'days'), 'day')\n  )\n)",
          "returnAll": false,
          "limit": 5,
          "options": {}
        },
        "type": "n8n-nodes-base.airtable",
        "typeVersion": 2.1,
        "position": [
          -208,
          1328
        ],
        "id": "9859c7ed-a6c9-4fa6-b3b8-ee783e3d8cfd",
        "name": "Busca Lead en registros",
        "alwaysOutputData": true,
        "credentials": {
          "airtableTokenApi": {
            "id": "2zDfs1ZY0VzfVfyg",
            "name": "Airtable Personal Access Token account"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "ff57a4ac-c416-47e4-b5b0-d79238e55b60",
                "leftValue": "={{ $json.id }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "empty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          16,
          1408
        ],
        "id": "439c1ac1-f456-45de-b7df-15e321cba636",
        "name": "Es Lead unico?",
        "alwaysOutputData": false
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "18e9ae0c-d9f0-4b48-813b-654e791d54ec",
                "leftValue": "={{ $('Webhook').item.json.body.mensaje }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "notExists",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -1456,
          1216
        ],
        "id": "ff11c8f7-6952-4148-a38b-c9aa9c61c073",
        "name": "If2"
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "evolutionapi",
          "remoteJid": "={{ $('Edit Fields').item.json.professional_whatsapp }}",
          "messageText": "=Nuevo cliente recibido {{ $now.setLocale('es-CR').format(\"dd LLL yyyy '- 'HH:mm a\") }}\n\nnombre: {{ $('Edit Fields').item.json.client_name }}\ntel: {{ $('Edit Fields').item.json.client_phone }}\nubicación: {{ $('Edit Fields').item.json.ubicacion }}",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          624,
          1600
        ],
        "id": "a4f1d615-9909-4d2a-8922-4709596c4566",
        "name": "Mensaje a Profesional",
        "credentials": {
          "evolutionApi": {
            "id": "lgR3M6buNvrwBzQ0",
            "name": "Evolution 50662292932 - Malco CR"
          }
        }
      }
    ],
    "connections": {
      "Webhook": {
        "main": [
          [
            {
              "node": "Edit Fields",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Costa Rica",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Argentina2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Argentina",
              "type": "main",
              "index": 0
            }
          ],
          [],
          [
            {
              "node": "Argentina1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Text Classifier": {
        "main": [
          [
            {
              "node": "Busca profesional",
              "type": "main",
              "index": 0
            }
          ],
          [],
          []
        ]
      },
      "DeepSeek Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Text Classifier",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Costa Rica": {
        "main": [
          [
            {
              "node": "Append row in sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Argentina": {
        "main": [
          [
            {
              "node": "Agrega contacos de la web a Leads Allpol",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Schedule Trigger": {
        "main": [
          [
            {
              "node": "Switch1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch1": {
        "main": [
          [
            {
              "node": "Smart CR",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Malco CR",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Allpol",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Argentina2": {
        "main": [
          []
        ]
      },
      "Argentina1": {
        "main": [
          []
        ]
      },
      "Alejandro": {
        "main": [
          []
        ]
      },
      "Agrega contacos de la web a Leads Allpol": {
        "main": [
          []
        ]
      },
      "Append row in sheet": {
        "main": [
          []
        ]
      },
      "Edit Fields": {
        "main": [
          [
            {
              "node": "If2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If": {
        "main": [
          [
            {
              "node": "Busca Lead en registros",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items": {
        "main": [
          [],
          [
            {
              "node": "Leads sin notificar",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent": {
        "main": [
          [
            {
              "node": "A mi de prueba",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If1": {
        "main": [
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate": {
        "main": [
          [
            {
              "node": "If1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Diario": {
        "main": [
          [
            {
              "node": "Lista profesionales",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "A mi de prueba": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Simple Memory": {
        "ai_memory": [
          [
            {
              "node": "AI Agent",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Anthropic Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Lista profesionales": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Enviar texto",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Leads sin notificar": {
        "main": [
          [
            {
              "node": "Aggregate",
              "type": "main",
              "index": 0
            },
            {
              "node": "cambia a notificado",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "cambia a notificado": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Create a record": {
        "main": [
          [
            {
              "node": "Mensaje a Profesional",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Busca profesional": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Busca Lead en registros": {
        "main": [
          [
            {
              "node": "Es Lead unico?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Es Lead unico?": {
        "main": [
          [
            {
              "node": "Create a record",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If2": {
        "main": [
          [
            {
              "node": "Busca profesional",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Text Classifier",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1",
      "availableInMCP": true
    },
    "staticData": {
      "node:Schedule Trigger": {
        "recurrenceRules": []
      },
      "node:Schedule Trigger1": {
        "recurrenceRules": []
      },
      "node:Diario": {
        "recurrenceRules": []
      }
    },
    "meta": {
      "templateCredsSetupCompleted": true
    },
    "pinData": {
      "Switch": [],
      "Diario": [
        {
          "json": {
            "timestamp": "2025-11-15T17:07:25.024-05:00",
            "Readable date": "November 15th 2025, 5:07:25 pm",
            "Readable time": "5:07:25 pm",
            "Day of week": "Saturday",
            "Year": "2025",
            "Month": "November",
            "Day of month": "15",
            "Hour": "17",
            "Minute": "07",
            "Second": "25",
            "Timezone": "America/New_York (UTC-05:00)"
          }
        }
      ],
      "Schedule Trigger": [
        {
          "json": {
            "timestamp": "2025-11-21T06:00:19.049-05:00",
            "Readable date": "November 21st 2025, 6:00:19 am",
            "Readable time": "6:00:19 am",
            "Day of week": "Friday",
            "Year": "2025",
            "Month": "November",
            "Day of month": "21",
            "Hour": "06",
            "Minute": "00",
            "Second": "19",
            "Timezone": "America/New_York (UTC-05:00)"
          }
        }
      ]
    },
    "versionId": "b59d032a-11de-4923-93e8-768ab1122bfb",
    "activeVersionId": "b59d032a-11de-4923-93e8-768ab1122bfb",
    "triggerCount": 3,
    "shared": [
      {
        "updatedAt": "2025-06-20T01:04:28.477Z",
        "createdAt": "2025-06-20T01:04:28.477Z",
        "role": "workflow:owner",
        "workflowId": "3vZyObH9koXfTnp8",
        "projectId": "CyuOAJo56zhDqPtw"
      }
    ],
    "activeVersion": {
      "updatedAt": "2025-12-08T18:55:49.326Z",
      "createdAt": "2025-12-08T18:55:49.326Z",
      "versionId": "b59d032a-11de-4923-93e8-768ab1122bfb",
      "workflowId": "3vZyObH9koXfTnp8",
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "leads",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2,
          "position": [
            -1904,
            1376
          ],
          "id": "d0908e51-97fa-42bd-85d0-1553a8b1808e",
          "name": "Webhook",
          "webhookId": "a3414e97-f942-4938-a579-02cbf2d4bf12"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('Webhook').item.json.body.referrer }}",
                        "rightValue": "https://camarasseguridad.net/",
                        "operator": {
                          "type": "string",
                          "operation": "contains"
                        },
                        "id": "8f3859ea-ae2e-4b73-994a-50b8a7abddf1"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "camaras CR"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "5aa0ed40-7430-4dbc-a76b-89dee516d122",
                        "leftValue": "={{ $('Webhook').item.json.body.referrer }}",
                        "rightValue": "https://mecanicapesada.top/",
                        "operator": {
                          "type": "string",
                          "operation": "contains"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Meca pesada"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "933ffc16-ac72-4e54-ad3b-19da3ffeceea",
                        "leftValue": "={{ $('Webhook').item.json.body.referrer }}",
                        "rightValue": "https://allpol.com.ar/",
                        "operator": {
                          "type": "string",
                          "operation": "contains"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Allpol"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "4f429151-5941-4228-ad42-ba5e3fa19ebc",
                        "leftValue": "={{ $('Webhook').item.json.body.referrer }}",
                        "rightValue": "https://cr-sites.com/bolsas-maceta/",
                        "operator": {
                          "type": "string",
                          "operation": "contains"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Bolsas Maceta"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9334526e-7727-421d-aa5a-f6d8d3492040",
                        "leftValue": "={{ $('Webhook').item.json.body.referrer }}",
                        "rightValue": "https://laplata.camarasseguridad.net/",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Cámaras LP"
                }
              ]
            },
            "options": {
              "fallbackOutput": "none"
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            144,
            1024
          ],
          "id": "d5955acd-6a28-47f9-8abe-e061836a02f7",
          "name": "Switch"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1FdSsi95qgMzvCJ8N10-jloPiTJuCFF5_ZDPwVihQ69I",
              "mode": "list",
              "cachedResultName": "Leads Allpol",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FdSsi95qgMzvCJ8N10-jloPiTJuCFF5_ZDPwVihQ69I/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FdSsi95qgMzvCJ8N10-jloPiTJuCFF5_ZDPwVihQ69I/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "ingreso": "={{ $json[\"currentDate-ARG\"] }}",
                "nombre": "={{ $('Webhook').item.json.body.nombre }}",
                "telefono": "={{ $('Webhook').item.json.body[\"Número de WhatsApp\"] }}",
                "producto": "={{ $('Webhook').item.json.body.mensaje }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "ingreso",
                  "displayName": "ingreso",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "nombre",
                  "displayName": "nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "telefono",
                  "displayName": "telefono",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "producto",
                  "displayName": "producto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            592,
            1168
          ],
          "id": "c5aa7fad-d608-43ce-a702-19b76c3f8525",
          "name": "Agrega contacos de la web a Leads Allpol",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "XCVUrxXJwWv4s45E",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "inputText": "={{ $('Webhook').item.json.body.mensaje }}",
            "categories": {
              "categories": [
                {
                  "category": "lead",
                  "description": "Dinero entrante, solicitudes relacionadas a servicios o productos,cotizacion, instalacion o reparacion. Todo lo que sea un lead para nosotros."
                },
                {
                  "category": "otros",
                  "description": "Solicitudes de empleo u ofrecimientos de cv.\nOfrecimiento de servicios o productos por parte de proveedores, personas o empresas que quieran vendernos algo."
                }
              ]
            },
            "options": {
              "fallback": "discard"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.textClassifier",
          "typeVersion": 1.1,
          "position": [
            -1248,
            1376
          ],
          "id": "945a89e4-3a1d-45f7-8ddf-66db4d7041d8",
          "name": "Text Classifier"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatDeepSeek",
          "typeVersion": 1,
          "position": [
            -1248,
            1584
          ],
          "id": "bb3fb79c-e121-4d11-9fb8-293adef89baf",
          "name": "DeepSeek Chat Model",
          "credentials": {
            "deepSeekApi": {
              "id": "l9T4qmBFqTej3Qxo",
              "name": "DeepSeek account"
            }
          }
        },
        {
          "parameters": {
            "outputFieldName": "currentDate-CR",
            "options": {
              "timezone": "America/Costa_Rica"
            }
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            368,
            784
          ],
          "id": "59a3933d-1513-4372-928e-f0531b6c4593",
          "name": "Costa Rica"
        },
        {
          "parameters": {
            "outputFieldName": "currentDate-ARG",
            "options": {
              "timezone": "America/Buenos_Aires"
            }
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            368,
            1168
          ],
          "id": "50bcf71f-401f-469d-862a-bd291b9b9ec3",
          "name": "Argentina"
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "triggerAtHour": 6
                }
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.2,
          "position": [
            -1936,
            848
          ],
          "id": "304e4c03-f547-4db7-96da-607b53215b61",
          "name": "Schedule Trigger"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "",
                        "rightValue": "",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "d7c31bf0-ee99-4f20-b84a-10ca0bdd1407"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "1"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "137bfc40-aa1b-4d81-a3ab-e80de79b57fc",
                        "leftValue": "",
                        "rightValue": "",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "2"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "6f2ba0e7-86e2-48f4-9fda-b79e6356e2f1",
                        "leftValue": "",
                        "rightValue": "",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "3"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "3679acc8-fda4-495d-ab14-c8de55b0a049",
                        "leftValue": "",
                        "rightValue": "",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "4"
                }
              ]
            },
            "options": {
              "allMatchingOutputs": true
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -1712,
            816
          ],
          "id": "1a3cccd5-c6b1-4b8f-a4c1-0fcd082d32e6",
          "name": "Switch1"
        },
        {
          "parameters": {
            "operation": "restart-instance",
            "instanceName": "evolutionapi"
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            -1488,
            752
          ],
          "id": "077ea19c-7262-4887-b5d5-01df6ca3305b",
          "name": "Malco CR",
          "credentials": {
            "evolutionApi": {
              "id": "lgR3M6buNvrwBzQ0",
              "name": "Evolution 50662292932 - Malco CR"
            }
          }
        },
        {
          "parameters": {
            "operation": "restart-instance",
            "instanceName": "Smart CR"
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            -1488,
            560
          ],
          "id": "9dd76b25-cfcd-49ad-bb58-06b11e3201f4",
          "name": "Smart CR",
          "credentials": {
            "evolutionApi": {
              "id": "zEeNcZfyeYVosz78",
              "name": "Smart CR"
            }
          }
        },
        {
          "parameters": {
            "operation": "restart-instance",
            "instanceName": "Allpol"
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            -1488,
            944
          ],
          "id": "7d844b9f-669c-41c3-8801-0874b345b592",
          "name": "Allpol",
          "credentials": {
            "evolutionApi": {
              "id": "BcKApPoAEmD2PL5m",
              "name": "wsp Allpol - 221 6925658"
            }
          }
        },
        {
          "parameters": {
            "outputFieldName": "currentDate-ARG",
            "options": {
              "timezone": "America/Buenos_Aires"
            }
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            368,
            976
          ],
          "id": "78608835-bf87-4c16-9eff-0d6fff96a007",
          "name": "Argentina2"
        },
        {
          "parameters": {
            "outputFieldName": "currentDate-ARG",
            "options": {
              "timezone": "America/Buenos_Aires"
            }
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            368,
            1360
          ],
          "id": "f738fdf7-cf1c-4b36-a3e2-d40e8f2cc40e",
          "name": "Argentina1"
        },
        {
          "parameters": {
            "resource": "messages-api",
            "instanceName": "Malco ARG",
            "remoteJid": "5492215548877",
            "messageText": "=Alejandro buenas, entro un mensaje de la pagina, si no te escribió le podes escribir vos, acá te dejo los datos:\n\n{{ $('Webhook').item.json.body.referrer }}\nSolicitud de contacto:\nfecha/hs: {{ $('Webhook').item.json.body.sentDateUTC }}\nnombre: {{ $('Webhook').item.json.body.Nombre }}\ntel: {{ $('Webhook').item.json.body['Número de WhatsApp'] }}\nmensaje: {{ $('Webhook').item.json.body.mensaje }}",
            "options_message": {}
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            -2592,
            2896
          ],
          "id": "92684be8-29fe-44f7-8a8c-f91f4315dc40",
          "name": "Alejandro",
          "credentials": {
            "evolutionApi": {
              "id": "uFLlpp0hjQkOnZnJ",
              "name": "Evolution 5492216115728 - Malco ARG"
            }
          }
        },
        {
          "parameters": {
            "resource": "messages-api",
            "instanceName": "Malco ARG",
            "remoteJid": "5492213184300",
            "messageText": "=Mati buenas, entro un mensaje de la pagina, si no te escribió le podes escribir vos, acá te dejo los datos:\n\n{{ $('Webhook').item.json.body.referrer }}\nSolicitud de contacto:\nfecha/hs: {{ $('Webhook').item.json.body.sentDateUTC }}\nnombre: {{ $('Webhook').item.json.body.Nombre }}\ntel: {{ $('Webhook').item.json.body['Número de WhatsApp'] }}\nmensaje: {{ $('Webhook').item.json.body.mensaje }}",
            "options_message": {}
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            -2592,
            2448
          ],
          "id": "41570900-1c48-46a4-80d7-a30059f58bf8",
          "name": "Matias",
          "credentials": {
            "evolutionApi": {
              "id": "uFLlpp0hjQkOnZnJ",
              "name": "Evolution 5492216115728 - Malco ARG"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1HU_G0Hy4IX3GuNccFU1Q-P1rUjeOVNd3XKr7e4FGSHk",
              "mode": "list",
              "cachedResultName": "Base de Datos - Leads",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HU_G0Hy4IX3GuNccFU1Q-P1rUjeOVNd3XKr7e4FGSHk/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1755573248,
              "mode": "list",
              "cachedResultName": "leads",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HU_G0Hy4IX3GuNccFU1Q-P1rUjeOVNd3XKr7e4FGSHk/edit#gid=1755573248"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {},
              "matchingColumns": [],
              "schema": [
                {
                  "id": "timestamp",
                  "displayName": "timestamp",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "lead_id",
                  "displayName": "lead_id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "client_name",
                  "displayName": "client_name",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "client_phone",
                  "displayName": "client_phone",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "client_location",
                  "displayName": "client_location",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "service_details",
                  "displayName": "service_details",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "lead_source",
                  "displayName": "lead_source",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "professional_id",
                  "displayName": "professional_id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "price_per_lead",
                  "displayName": "price_per_lead",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "currency_code",
                  "displayName": "currency_code",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "status",
                  "displayName": "status",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "notified_timestamp",
                  "displayName": "notified_timestamp",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "weekly_summary_id",
                  "displayName": "weekly_summary_id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            592,
            784
          ],
          "id": "b3bd1eb5-eca4-4d06-ace0-03fccbe6dca1",
          "name": "Append row in sheet",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "XCVUrxXJwWv4s45E",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "edf444ee-1b8d-4cb7-930e-42fabc24d557",
                  "name": "client_name",
                  "value": "={{ $json.body.nombre }}",
                  "type": "string"
                },
                {
                  "id": "853fffdc-e7b7-4379-9c54-ed218f8e6850",
                  "name": "client_phone",
                  "value": "={{ $json.body.tel }}",
                  "type": "string"
                },
                {
                  "id": "d0170f01-7548-4755-98d1-f70f3948d7a4",
                  "name": "service_details",
                  "value": "={{ $json.body.serv }}",
                  "type": "string"
                },
                {
                  "id": "7a69fec7-af59-4e5c-a985-97aea15601e3",
                  "name": "lead_source",
                  "value": "={{ $json.body.referrerArrival }}",
                  "type": "string"
                },
                {
                  "id": "97d463d6-b45a-4c35-aee2-bb06cbe202bc",
                  "name": "professional_whatsapp",
                  "value": "={{ $('Webhook').item.json.body.phoneAgent }}",
                  "type": "string"
                },
                {
                  "id": "887d5af4-c7e2-4389-aee5-9245499d6ae2",
                  "name": "timestamp",
                  "value": "={{ DateTime.now().setZone('America/Costa_Rica').toFormat('yyyy-MM-dd HH:mm:ss') }}",
                  "type": "string"
                },
                {
                  "id": "9162b23f-bdf3-4e3e-b040-d36c2f61cb69",
                  "name": "ubicacion",
                  "value": "={{ $json.body.ubi }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1680,
            1376
          ],
          "id": "1b4c1ea5-ab30-4cec-927b-482d64448191",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "9cbab708-bf85-4f1b-a591-b63303f36b0e",
                  "leftValue": "={{ $json.daily_prompt_id }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -464,
            1360
          ],
          "id": "7ded00a4-a7c3-4f67-8940-d4241b06f609",
          "name": "If"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            -1552,
            2144
          ],
          "id": "99b1e00a-f9b8-4562-9e11-48f2c8d65738",
          "name": "Loop Over Items"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=Leads a notificar en concordancia ordinal: {{ $json.client_name }} - {{ $json.client_phone }} - {{ $json.service_details }} - {{ $json.timestamp }}",
            "options": {
              "systemMessage": "={{ $('Loop Over Items').item.json.daily_prompt_id }}"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 2.2,
          "position": [
            -656,
            1904
          ],
          "id": "c04e9dc5-d584-4c12-bf43-0a2cac1f829b",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "30ef8bd3-c0e8-41ab-877a-c520f8aa3763",
                  "leftValue": "={{ $json.client_name }}",
                  "rightValue": "",
                  "operator": {
                    "type": "array",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": "={{ false }}",
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -880,
            1904
          ],
          "id": "b77af841-3214-4f61-a29f-7bac5c5023e5",
          "name": "If1"
        },
        {
          "parameters": {
            "fieldsToAggregate": {
              "fieldToAggregate": [
                {
                  "fieldToAggregate": "client_name"
                },
                {
                  "fieldToAggregate": "client_phone"
                },
                {
                  "fieldToAggregate": "service_details"
                },
                {
                  "fieldToAggregate": "timestamp"
                }
              ]
            },
            "options": {
              "mergeLists": true
            }
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            -1104,
            1904
          ],
          "id": "cdac17f2-d509-42e9-8538-7d78feb0cef3",
          "name": "Aggregate"
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "triggerAtHour": 17,
                  "triggerAtMinute": 7
                }
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.2,
          "position": [
            -2000,
            2240
          ],
          "id": "fdaef204-c7c0-4a96-b763-2f4e5f40158d",
          "name": "Diario"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            -80,
            2160
          ],
          "id": "4b034838-2ae8-499c-942e-cc49bb12cf0a",
          "name": "Merge"
        },
        {
          "parameters": {
            "resource": "messages-api",
            "instanceName": "evolutionapi",
            "remoteJid": "50662292932",
            "messageText": "={{ $json.output }}",
            "options_message": {}
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            -2592,
            2672
          ],
          "id": "74c0467c-c5c4-42e9-aa44-a9383239f401",
          "name": "A mi los descartados1",
          "credentials": {
            "evolutionApi": {
              "id": "lgR3M6buNvrwBzQ0",
              "name": "Evolution 50662292932 - Malco CR"
            }
          }
        },
        {
          "parameters": {
            "resource": "messages-api",
            "instanceName": "evolutionapi",
            "remoteJid": "=5492216115728",
            "messageText": "={{ $json.output }}",
            "options_message": {}
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            -304,
            1904
          ],
          "id": "febf77e0-4a30-4e42-b39f-751438a136cd",
          "name": "A mi de prueba",
          "credentials": {
            "evolutionApi": {
              "id": "lgR3M6buNvrwBzQ0",
              "name": "Evolution 50662292932 - Malco CR"
            }
          }
        },
        {
          "parameters": {
            "sessionIdType": "customKey",
            "sessionKey": "={{ $('Loop Over Items').item.json.whatsapp_number }}",
            "contextWindowLength": 7
          },
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            -560,
            2064
          ],
          "id": "050f08bf-2b3c-4324-85c6-9e2843e8cda1",
          "name": "Simple Memory"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "claude-3-7-sonnet-20250219",
              "mode": "list",
              "cachedResultName": "Claude Sonnet 3.7"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
          "typeVersion": 1.3,
          "position": [
            -736,
            2064
          ],
          "id": "2be5222d-c7c9-4d58-a05d-5e3d97cd4d4a",
          "name": "Anthropic Chat Model",
          "credentials": {
            "anthropicApi": {
              "id": "KvZF7MNs1iI9NLKB",
              "name": "Anthropic account"
            }
          }
        },
        {
          "parameters": {
            "resource": "messages-api",
            "instanceName": "evolutionapi",
            "remoteJid": "542216115728",
            "messageText": "Hubo un fallo en la coneccion de N8N con Google",
            "options_message": {}
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            -1552,
            2336
          ],
          "id": "09a70a8d-0411-4045-9a83-93cda4bb86df",
          "name": "Enviar texto",
          "credentials": {
            "evolutionApi": {
              "id": "lgR3M6buNvrwBzQ0",
              "name": "Evolution 50662292932 - Malco CR"
            }
          }
        },
        {
          "parameters": {
            "resource": "messages-api",
            "instanceName": "evolutionapi",
            "remoteJid": "542216115728",
            "messageText": "Hubo un fallo en la coneccion de N8N con Google",
            "options_message": {}
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            -592,
            1568
          ],
          "id": "38649981-33c0-4099-9a16-fef5982d3613",
          "name": "Enviar texto1",
          "credentials": {
            "evolutionApi": {
              "id": "lgR3M6buNvrwBzQ0",
              "name": "Evolution 50662292932 - Malco CR"
            }
          }
        },
        {
          "parameters": {
            "operation": "search",
            "base": {
              "__rl": true,
              "value": "appuqvJKOHdjlI6Np",
              "mode": "list",
              "cachedResultName": "Profesionales",
              "cachedResultUrl": "https://airtable.com/appuqvJKOHdjlI6Np"
            },
            "table": {
              "__rl": true,
              "value": "tblowzUNVeV8gYJZq",
              "mode": "list",
              "cachedResultName": "hoja1",
              "cachedResultUrl": "https://airtable.com/appuqvJKOHdjlI6Np/tblowzUNVeV8gYJZq"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.airtable",
          "typeVersion": 2.1,
          "position": [
            -1776,
            2240
          ],
          "id": "a1c5d1a4-70ec-4b40-a29b-2babdda2ac4c",
          "name": "Lista profesionales",
          "credentials": {
            "airtableTokenApi": {
              "id": "2zDfs1ZY0VzfVfyg",
              "name": "Airtable Personal Access Token account"
            }
          },
          "onError": "continueErrorOutput"
        },
        {
          "parameters": {
            "operation": "search",
            "base": {
              "__rl": true,
              "value": "app8jff881WWUr8Sl",
              "mode": "list",
              "cachedResultName": "Base de Datos - Leads",
              "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl"
            },
            "table": {
              "__rl": true,
              "value": "tblCq162vKS035OZf",
              "mode": "list",
              "cachedResultName": "leads",
              "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl/tblCq162vKS035OZf"
            },
            "filterByFormula": "=AND({professional_id} = '{{ $json.whatsapp_number }}', {status} = 'sin-notificar')",
            "returnAll": false,
            "options": {}
          },
          "type": "n8n-nodes-base.airtable",
          "typeVersion": 2.1,
          "position": [
            -1296,
            2160
          ],
          "id": "47fd2f1f-4efd-46ce-80d1-7ca822493e88",
          "name": "Leads sin notificar",
          "credentials": {
            "airtableTokenApi": {
              "id": "2zDfs1ZY0VzfVfyg",
              "name": "Airtable Personal Access Token account"
            }
          }
        },
        {
          "parameters": {
            "operation": "upsert",
            "base": {
              "__rl": true,
              "value": "app8jff881WWUr8Sl",
              "mode": "list",
              "cachedResultName": "Base de Datos - Leads",
              "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl"
            },
            "table": {
              "__rl": true,
              "value": "tblCq162vKS035OZf",
              "mode": "list",
              "cachedResultName": "leads",
              "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl/tblCq162vKS035OZf"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "client_phone": "={{ $json.client_phone }}",
                "status": "notificado",
                "notified_timestamp": "={{new Date().toLocaleDateString()}}"
              },
              "matchingColumns": [
                "client_phone"
              ],
              "schema": [
                {
                  "id": "id",
                  "displayName": "id",
                  "required": false,
                  "defaultMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": true,
                  "removed": false
                },
                {
                  "id": "timestamp",
                  "displayName": "timestamp",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "client_name",
                  "displayName": "client_name",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "client_phone",
                  "displayName": "client_phone",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "client_location",
                  "displayName": "client_location",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "service_details",
                  "displayName": "service_details",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "lead_source",
                  "displayName": "lead_source",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "options",
                  "options": [
                    {
                      "name": "De qué página o campaña vino el lead.",
                      "value": "De qué página o campaña vino el lead."
                    },
                    {
                      "name": "camarasseguridad.net",
                      "value": "camarasseguridad.net"
                    },
                    {
                      "name": "https://services.tochat.be/es/app/whatsapp/1b7894f5-baf9-4fb6-bb30-2fc621360617/edit",
                      "value": "https://services.tochat.be/es/app/whatsapp/1b7894f5-baf9-4fb6-bb30-2fc621360617/edit"
                    },
                    {
                      "name": "https://services.tochat.be/es/app/whatsapp/form/whatsapp-form/1b7894f5-baf9-4fb6-bb30-2fc621360617",
                      "value": "https://services.tochat.be/es/app/whatsapp/form/whatsapp-form/1b7894f5-baf9-4fb6-bb30-2fc621360617"
                    },
                    {
                      "name": "https://camarasseguridad.net/",
                      "value": "https://camarasseguridad.net/"
                    },
                    {
                      "name": "https://laplata.camarasseguridad.net/",
                      "value": "https://laplata.camarasseguridad.net/"
                    },
                    {
                      "name": "https://camarasseguridad.net/#servicios",
                      "value": "https://camarasseguridad.net/#servicios"
                    },
                    {
                      "name": "FALSE",
                      "value": "FALSE"
                    },
                    {
                      "name": "https://camarasseguridad.net/#formulario",
                      "value": "https://camarasseguridad.net/#formulario"
                    },
                    {
                      "name": "https://camarasseguridad.net/costa-rica/alajuela/",
                      "value": "https://camarasseguridad.net/costa-rica/alajuela/"
                    },
                    {
                      "name": "https://camarasseguridad.net/?utm_source=google&utm_medium=organic&utm_content=main_button&utm_campaign=gmb",
                      "value": "https://camarasseguridad.net/?utm_source=google&utm_medium=organic&utm_content=main_button&utm_campaign=gmb"
                    }
                  ],
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "professional_id",
                  "displayName": "professional_id",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "options",
                  "options": [
                    {
                      "name": "Identificador único del profesional asignado.",
                      "value": "Identificador único del profesional asignado."
                    },
                    {
                      "name": "50660742444",
                      "value": "50660742444"
                    },
                    {
                      "name": "542215548877",
                      "value": "542215548877"
                    }
                  ],
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "price_per_lead",
                  "displayName": "price_per_lead",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "options",
                  "options": [
                    {
                      "name": "Costo acordado por este lead específico.",
                      "value": "Costo acordado por este lead específico."
                    },
                    {
                      "name": "2000",
                      "value": "2000"
                    },
                    {
                      "name": "5000",
                      "value": "5000"
                    }
                  ],
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "currency_code",
                  "displayName": "currency_code",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "options",
                  "options": [
                    {
                      "name": "Código de la moneda para el cobro.",
                      "value": "Código de la moneda para el cobro."
                    },
                    {
                      "name": "CRC (Colones), ARS (Pesos)",
                      "value": "CRC (Colones), ARS (Pesos)"
                    },
                    {
                      "name": "CRC",
                      "value": "CRC"
                    },
                    {
                      "name": "ARS",
                      "value": "ARS"
                    }
                  ],
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "status",
                  "displayName": "status",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "options",
                  "options": [
                    {
                      "name": "Estado del lead en el flujo de n8n.",
                      "value": "Estado del lead en el flujo de n8n."
                    },
                    {
                      "name": "notificado",
                      "value": "notificado"
                    },
                    {
                      "name": "sin-notificar",
                      "value": "sin-notificar"
                    }
                  ],
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "notified_timestamp",
                  "displayName": "notified_timestamp",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "weekly_summary_id",
                  "displayName": "weekly_summary_id",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.airtable",
          "typeVersion": 2.1,
          "position": [
            -336,
            2176
          ],
          "id": "1bc8d79c-99be-4852-a1f2-9a903d59649c",
          "name": "cambia a notificado",
          "credentials": {
            "airtableTokenApi": {
              "id": "2zDfs1ZY0VzfVfyg",
              "name": "Airtable Personal Access Token account"
            }
          }
        },
        {
          "parameters": {
            "operation": "create",
            "base": {
              "__rl": true,
              "value": "app8jff881WWUr8Sl",
              "mode": "list",
              "cachedResultName": "Base de Datos - Leads",
              "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl"
            },
            "table": {
              "__rl": true,
              "value": "tblCq162vKS035OZf",
              "mode": "list",
              "cachedResultName": "leads",
              "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl/tblCq162vKS035OZf"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "timestamp": "={{ $('Edit Fields').item.json.timestamp }}",
                "client_name": "={{ $('Edit Fields').item.json.client_name }}",
                "client_phone": "={{ $('Edit Fields').item.json.client_phone }}",
                "client_location": "={{ $('Edit Fields').item.json.ubicacion }}",
                "service_details": "={{ $('Edit Fields').item.json.service_details }}",
                "lead_source": "={{ $('Edit Fields').item.json.lead_source }}",
                "professional_id": "={{ $('Edit Fields').item.json.professional_whatsapp }}",
                "price_per_lead": "={{ $('Busca profesional').item.json.price_per_lead }}",
                "status": "=sin-notificar",
                "currency_code": "={{ $('Busca profesional').item.json.currency_code }}",
                "notified_timestamp": "={{ $now }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "timestamp",
                  "displayName": "timestamp",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "client_name",
                  "displayName": "client_name",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "client_phone",
                  "displayName": "client_phone",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "client_location",
                  "displayName": "client_location",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "service_details",
                  "displayName": "service_details",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "lead_source",
                  "displayName": "lead_source",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "professional_id",
                  "displayName": "professional_id",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "price_per_lead",
                  "displayName": "price_per_lead",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "options",
                  "options": [
                    {
                      "name": "Costo acordado por este lead específico.",
                      "value": "Costo acordado por este lead específico."
                    },
                    {
                      "name": "2000",
                      "value": "2000"
                    },
                    {
                      "name": "5000",
                      "value": "5000"
                    }
                  ],
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "currency_code",
                  "displayName": "currency_code",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "options",
                  "options": [
                    {
                      "name": "Código de la moneda para el cobro.",
                      "value": "Código de la moneda para el cobro."
                    },
                    {
                      "name": "CRC (Colones), ARS (Pesos)",
                      "value": "CRC (Colones), ARS (Pesos)"
                    },
                    {
                      "name": "CRC",
                      "value": "CRC"
                    },
                    {
                      "name": "ARS",
                      "value": "ARS"
                    }
                  ],
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "status",
                  "displayName": "status",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "options",
                  "options": [
                    {
                      "name": "Estado del lead en el flujo de n8n.",
                      "value": "Estado del lead en el flujo de n8n."
                    },
                    {
                      "name": "notificado",
                      "value": "notificado"
                    },
                    {
                      "name": "sin-notificar",
                      "value": "sin-notificar"
                    }
                  ],
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "notified_timestamp",
                  "displayName": "notified_timestamp",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "weekly_summary_id",
                  "displayName": "weekly_summary_id",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.airtable",
          "typeVersion": 2.1,
          "position": [
            256,
            1520
          ],
          "id": "c7eecea6-4f63-4a17-a02b-fb7680e559f5",
          "name": "Create a record",
          "credentials": {
            "airtableTokenApi": {
              "id": "2zDfs1ZY0VzfVfyg",
              "name": "Airtable Personal Access Token account"
            }
          }
        },
        {
          "parameters": {
            "operation": "search",
            "base": {
              "__rl": true,
              "value": "appuqvJKOHdjlI6Np",
              "mode": "list",
              "cachedResultName": "Profesionales",
              "cachedResultUrl": "https://airtable.com/appuqvJKOHdjlI6Np"
            },
            "table": {
              "__rl": true,
              "value": "tblowzUNVeV8gYJZq",
              "mode": "list",
              "cachedResultName": "hoja1",
              "cachedResultUrl": "https://airtable.com/appuqvJKOHdjlI6Np/tblowzUNVeV8gYJZq"
            },
            "filterByFormula": "=AND({whatsapp_number} = {{$json.professional_whatsapp}}, {activo?} = 'si')",
            "options": {
              "fields": [
                "daily_prompt_id",
                "price_per_lead",
                "currency_code"
              ]
            }
          },
          "type": "n8n-nodes-base.airtable",
          "typeVersion": 2.1,
          "position": [
            -896,
            1360
          ],
          "id": "49aa9822-2b8c-4a0c-95b9-b6a23419cf02",
          "name": "Busca profesional",
          "alwaysOutputData": false,
          "credentials": {
            "airtableTokenApi": {
              "id": "2zDfs1ZY0VzfVfyg",
              "name": "Airtable Personal Access Token account"
            }
          }
        },
        {
          "parameters": {
            "operation": "search",
            "base": {
              "__rl": true,
              "value": "app8jff881WWUr8Sl",
              "mode": "list",
              "cachedResultName": "Base de Datos - Leads",
              "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl"
            },
            "table": {
              "__rl": true,
              "value": "tblCq162vKS035OZf",
              "mode": "list",
              "cachedResultName": "leads",
              "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl/tblCq162vKS035OZf"
            },
            "filterByFormula": "=AND(\n  {client_phone} = '{{ $('Edit Fields').item.json.client_phone }}',\n  OR(\n    IS_SAME(DATETIME_PARSE({timestamp}, 'YYYY-MM-DD HH:mm:ss'), TODAY(), 'day'),\n    IS_SAME(DATETIME_PARSE({timestamp}, 'YYYY-MM-DD HH:mm:ss'), DATEADD(TODAY(), -1, 'days'), 'day')\n  )\n)",
            "returnAll": false,
            "limit": 5,
            "options": {}
          },
          "type": "n8n-nodes-base.airtable",
          "typeVersion": 2.1,
          "position": [
            -208,
            1328
          ],
          "id": "9859c7ed-a6c9-4fa6-b3b8-ee783e3d8cfd",
          "name": "Busca Lead en registros",
          "alwaysOutputData": true,
          "credentials": {
            "airtableTokenApi": {
              "id": "2zDfs1ZY0VzfVfyg",
              "name": "Airtable Personal Access Token account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "ff57a4ac-c416-47e4-b5b0-d79238e55b60",
                  "leftValue": "={{ $json.id }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            16,
            1408
          ],
          "id": "439c1ac1-f456-45de-b7df-15e321cba636",
          "name": "Es Lead unico?",
          "alwaysOutputData": false
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "18e9ae0c-d9f0-4b48-813b-654e791d54ec",
                  "leftValue": "={{ $('Webhook').item.json.body.mensaje }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notExists",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -1456,
            1216
          ],
          "id": "ff11c8f7-6952-4148-a38b-c9aa9c61c073",
          "name": "If2"
        },
        {
          "parameters": {
            "resource": "messages-api",
            "instanceName": "evolutionapi",
            "remoteJid": "={{ $('Edit Fields').item.json.professional_whatsapp }}",
            "messageText": "=Nuevo cliente recibido {{ $now.setLocale('es-CR').format(\"dd LLL yyyy '- 'HH:mm a\") }}\n\nnombre: {{ $('Edit Fields').item.json.client_name }}\ntel: {{ $('Edit Fields').item.json.client_phone }}\nubicación: {{ $('Edit Fields').item.json.ubicacion }}",
            "options_message": {}
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            624,
            1600
          ],
          "id": "a4f1d615-9909-4d2a-8922-4709596c4566",
          "name": "Mensaje a Profesional",
          "credentials": {
            "evolutionApi": {
              "id": "lgR3M6buNvrwBzQ0",
              "name": "Evolution 50662292932 - Malco CR"
            }
          }
        }
      ],
      "connections": {
        "Webhook": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "Costa Rica",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Argentina2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Argentina",
                "type": "main",
                "index": 0
              }
            ],
            [],
            [
              {
                "node": "Argentina1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Text Classifier": {
          "main": [
            [
              {
                "node": "Busca profesional",
                "type": "main",
                "index": 0
              }
            ],
            [],
            []
          ]
        },
        "DeepSeek Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Text Classifier",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Costa Rica": {
          "main": [
            [
              {
                "node": "Append row in sheet",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Argentina": {
          "main": [
            [
              {
                "node": "Agrega contacos de la web a Leads Allpol",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger": {
          "main": [
            [
              {
                "node": "Switch1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch1": {
          "main": [
            [
              {
                "node": "Smart CR",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Malco CR",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Allpol",
                "type": "main",
                "index": 0
              }
            ],
            []
          ]
        },
        "Argentina2": {
          "main": [
            []
          ]
        },
        "Argentina1": {
          "main": [
            []
          ]
        },
        "Alejandro": {
          "main": [
            []
          ]
        },
        "Agrega contacos de la web a Leads Allpol": {
          "main": [
            []
          ]
        },
        "Append row in sheet": {
          "main": [
            []
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "If2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "Busca Lead en registros",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items": {
          "main": [
            [],
            [
              {
                "node": "Leads sin notificar",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent": {
          "main": [
            [
              {
                "node": "A mi de prueba",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If1": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate": {
          "main": [
            [
              {
                "node": "If1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Diario": {
          "main": [
            [
              {
                "node": "Lista profesionales",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "A mi de prueba": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Anthropic Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Lista profesionales": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Enviar texto",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Leads sin notificar": {
          "main": [
            [
              {
                "node": "Aggregate",
                "type": "main",
                "index": 0
              },
              {
                "node": "cambia a notificado",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "cambia a notificado": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Create a record": {
          "main": [
            [
              {
                "node": "Mensaje a Profesional",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca profesional": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ],
            []
          ]
        },
        "Busca Lead en registros": {
          "main": [
            [
              {
                "node": "Es Lead unico?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Es Lead unico?": {
          "main": [
            [
              {
                "node": "Create a record",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If2": {
          "main": [
            [
              {
                "node": "Busca profesional",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Text Classifier",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "authors": "malco fernandez",
      "name": null,
      "description": null
    },
    "tags": []
  },
  {
    "updatedAt": "2025-11-19T14:02:00.000Z",
    "createdAt": "2025-11-19T14:01:48.955Z",
    "id": "5mdeSznQUBSQro5k",
    "name": "Lista limpia",
    "active": false,
    "isArchived": true,
    "nodes": [],
    "connections": {},
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": null,
    "pinData": {},
    "versionId": "ae3fbee0-e9dd-4d2b-a4d6-1d4664c501a5",
    "activeVersionId": null,
    "triggerCount": 0,
    "shared": [
      {
        "updatedAt": "2025-11-19T14:01:48.960Z",
        "createdAt": "2025-11-19T14:01:48.960Z",
        "role": "workflow:owner",
        "workflowId": "5mdeSznQUBSQro5k",
        "projectId": "CyuOAJo56zhDqPtw"
      }
    ],
    "activeVersion": null,
    "tags": []
  },
  {
    "updatedAt": "2025-09-30T19:23:33.699Z",
    "createdAt": "2025-09-30T19:23:33.699Z",
    "id": "94x7SAJKgaOgB3Cf",
    "name": "Demo: RAG in n8n",
    "active": false,
    "isArchived": false,
    "nodes": [
      {
        "parameters": {
          "formTitle": "Upload your data to test RAG",
          "formFields": {
            "values": [
              {
                "fieldLabel": "Upload your file(s)",
                "fieldType": "file",
                "acceptFileTypes": ".pdf, .csv",
                "requiredField": true
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.formTrigger",
        "typeVersion": 2.2,
        "position": [
          -128,
          0
        ],
        "id": "f7a656ec-83fc-4ed2-a089-57a9def662b7",
        "name": "Upload your file here",
        "webhookId": "82848bc4-5ea2-4e5a-8bb6-3c09b94a8c5d"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
        "typeVersion": 1.2,
        "position": [
          528,
          480
        ],
        "id": "6ea78663-cf2f-4f2d-8e68-43047c2afd87",
        "name": "Embeddings OpenAI",
        "credentials": {
          "openAiApi": {
            "id": "4KlRoIAzZJhV4U20",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "dataType": "binary",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
        "typeVersion": 1.1,
        "position": [
          320,
          160
        ],
        "id": "94aecac0-03f9-4915-932b-d14a2576607b",
        "name": "Default Data Loader"
      },
      {
        "parameters": {
          "content": "### Léame\nCargue sus datos en una base de datos vectorial con el flujo 📚 **Cargar datos** y luego úselos como contexto de chat con el flujo 🐕 **Recuperador**.\n\n**Inicio rápido**\n1. Haga clic en el botón \"Ejecutar flujo de trabajo\" para ejecutar el flujo 📚 **Cargar datos**.\n2. Haga clic en el botón \"Abrir chat\" para ejecutar el flujo 🐕 **Recuperador**. A continuación, haga una pregunta sobre el contenido de sus documentos.\n\nPara más información, consulte [nuestra documentación sobre RAG en n8n](https://docs.n8n.io/advanced-ai/rag-in-n8n/).",
          "height": 316,
          "width": 440,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -656,
          -64
        ],
        "typeVersion": 1,
        "id": "0d07742b-0b36-4c2e-990c-266cbe6e2d4d",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "content": "### 📚 Load Data Flow",
          "height": 460,
          "width": 700,
          "color": 7
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -176,
          -64
        ],
        "typeVersion": 1,
        "id": "d19d04f3-5231-4e47-bed7-9f24a4a8f582",
        "name": "Sticky Note1"
      },
      {
        "parameters": {
          "mode": "insert",
          "memoryKey": {
            "__rl": true,
            "value": "vector_store_key",
            "mode": "list",
            "cachedResultName": "vector_store_key"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.vectorStoreInMemory",
        "typeVersion": 1.2,
        "position": [
          64,
          0
        ],
        "id": "bf50a11f-ca6a-4e04-a6d2-42fee272b260",
        "name": "Insert Data to Store"
      },
      {
        "parameters": {
          "mode": "retrieve-as-tool",
          "toolName": "knowledge_base",
          "toolDescription": "Use this knowledge base to answer questions from the user",
          "memoryKey": {
            "__rl": true,
            "mode": "list",
            "value": "vector_store_key"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.vectorStoreInMemory",
        "typeVersion": 1.2,
        "position": [
          944,
          208
        ],
        "id": "09c0db62-5413-440e-8c13-fb6bb66d9b6a",
        "name": "Query Data Tool"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 2,
        "position": [
          944,
          -16
        ],
        "id": "579aed76-9644-42d1-ac13-7369059ff1c2",
        "name": "AI Agent"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.chatTrigger",
        "typeVersion": 1.1,
        "position": [
          720,
          -16
        ],
        "id": "9c30de61-935a-471f-ae88-ec5f67beeefc",
        "name": "When chat message received",
        "webhookId": "4091fa09-fb9a-4039-9411-7104d213f601"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          720,
          208
        ],
        "id": "b5aa8942-9cd5-4c2f-bd77-7a0ceb921bac",
        "name": "OpenAI Chat Model",
        "credentials": {
          "openAiApi": {
            "id": "4KlRoIAzZJhV4U20",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "content": "### 🐕 2. Retriever Flow",
          "height": 460,
          "width": 680,
          "color": 7
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          608,
          -64
        ],
        "typeVersion": 1,
        "id": "28bc73a1-e64a-47bf-ac1c-ffe644894ea5",
        "name": "Sticky Note2"
      },
      {
        "parameters": {
          "content": "### Incrustaciones\n\nLas operaciones de inserción y recuperación utilizan el mismo nodo de incrustación.\n\nEsto garantiza que utilicen **exactamente las mismas incrustaciones y configuraciones**.\n\nEs posible que incrustaciones diferentes no funcionen o tengan consecuencias imprevistas.",
          "height": 272,
          "width": 320,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          672,
          448
        ],
        "typeVersion": 1,
        "id": "0cf8c647-418c-4d1a-8952-766145afca72",
        "name": "Sticky Note3"
      }
    ],
    "connections": {
      "Upload your file here": {
        "main": [
          [
            {
              "node": "Insert Data to Store",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Embeddings OpenAI": {
        "ai_embedding": [
          [
            {
              "node": "Insert Data to Store",
              "type": "ai_embedding",
              "index": 0
            },
            {
              "node": "Query Data Tool",
              "type": "ai_embedding",
              "index": 0
            }
          ]
        ]
      },
      "Default Data Loader": {
        "ai_document": [
          [
            {
              "node": "Insert Data to Store",
              "type": "ai_document",
              "index": 0
            }
          ]
        ]
      },
      "Query Data Tool": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "When chat message received": {
        "main": [
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": {
      "templateId": "rag-starter-template"
    },
    "pinData": {},
    "versionId": "5d2f1143-2d6a-4b7c-bd12-8cf061761914",
    "activeVersionId": null,
    "triggerCount": 0,
    "shared": [
      {
        "updatedAt": "2025-09-30T19:23:33.716Z",
        "createdAt": "2025-09-30T19:23:33.716Z",
        "role": "workflow:owner",
        "workflowId": "94x7SAJKgaOgB3Cf",
        "projectId": "CyuOAJo56zhDqPtw"
      }
    ],
    "activeVersion": null,
    "tags": []
  },
  {
    "updatedAt": "2025-12-15T18:11:37.000Z",
    "createdAt": "2025-12-15T15:53:59.860Z",
    "id": "9pBWg7IQeNUJczJO",
    "name": "Seguimientos Diarios Allpol",
    "active": false,
    "isArchived": true,
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "triggerAtHour": 9
              }
            ]
          }
        },
        "id": "schedule-trigger",
        "name": "Cada día 9AM",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          0,
          0
        ]
      },
      {
        "parameters": {
          "operation": "getAll",
          "tableId": "client_followups",
          "returnAll": true,
          "filterType": "string",
          "filterString": "scheduled_date=lte.{{ $now.format('yyyy-MM-dd') }}&status=eq.pending&select=*,clients(name,phone)",
          "options": {}
        },
        "id": "supabase-get",
        "name": "Get Followups Pendientes",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          220,
          0
        ],
        "credentials": {
          "supabaseApi": {
            "id": "supabase-creds",
            "name": "Supabase Allpol"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "condition-check",
                "leftValue": "={{ $input.all().length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "if-hay-pendientes",
        "name": "¿Hay pendientes?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          440,
          0
        ]
      },
      {
        "parameters": {
          "jsCode": "const followups = $input.all();\n\nconst today = new Date().toLocaleDateString('es-AR', { \n  weekday: 'long', \n  year: 'numeric', \n  month: 'long', \n  day: 'numeric' \n});\n\nlet message = `📅 *Seguimientos pendientes*\\n${today}\\n\\n`;\n\nconst typeEmojis = {\n  'reminder': '🔔',\n  'grouping': '📦',\n  'material': '🏭'\n};\n\nconst typeNames = {\n  'reminder': 'Recordatorio',\n  'grouping': 'Oportunidad de Agrupación',\n  'material': 'Material Disponible'\n};\n\nfollowups.forEach((item, index) => {\n  const f = item.json;\n  const emoji = typeEmojis[f.type] || '📌';\n  const typeName = typeNames[f.type] || f.type;\n  \n  // Calcular días de atraso\n  const schedDate = new Date(f.scheduled_date);\n  const todayDate = new Date();\n  const daysLate = Math.floor((todayDate - schedDate) / (1000 * 60 * 60 * 24));\n  const lateText = daysLate > 0 ? ` ⚠️ (${daysLate} días de atraso)` : '';\n  \n  message += `${index + 1}. ${emoji} *${f.clients?.name || 'Cliente'}*${lateText}\\n`;\n  message += `   _${typeName}_\\n`;\n  if (f.notes) message += `   📝 ${f.notes}\\n`;\n  if (f.product_reference) message += `   📦 ${f.product_reference}\\n`;\n  message += `   📱 ${f.clients?.phone || 'Sin teléfono'}\\n\\n`;\n});\n\nmessage += `─────────────────\\n`;\nmessage += `_Total: ${followups.length} seguimiento(s) pendiente(s)_\\n`;\nmessage += `\\n💡 _Abrí Allpol Gestión > Seguimientos para gestionar_`;\n\nreturn [{ json: { message, count: followups.length } }];"
        },
        "id": "code-format",
        "name": "Formatear Mensaje",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          660,
          -100
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://automatizacion-evolution-api.aq0vtr.easypanel.host/message/sendText/Allpol",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              },
              {
                "name": "apikey",
                "value": "97D1DBC4C9E6-42E7-85E8-8E53D285C69E"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"number\": \"5492216925658@s.whatsapp.net\",\n  \"text\": {{ JSON.stringify($json.message) }}\n}",
          "options": {}
        },
        "id": "http-whatsapp",
        "name": "Enviar WhatsApp",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          880,
          -100
        ]
      },
      {
        "parameters": {},
        "id": "noop-end",
        "name": "Sin pendientes",
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          660,
          100
        ]
      }
    ],
    "connections": {
      "Cada día 9AM": {
        "main": [
          [
            {
              "node": "Get Followups Pendientes",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Followups Pendientes": {
        "main": [
          [
            {
              "node": "¿Hay pendientes?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "¿Hay pendientes?": {
        "main": [
          [
            {
              "node": "Formatear Mensaje",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Sin pendientes",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Formatear Mensaje": {
        "main": [
          [
            {
              "node": "Enviar WhatsApp",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1",
      "timezone": "America/Argentina/Buenos_Aires",
      "callerPolicy": "workflowsFromSameOwner",
      "availableInMCP": false
    },
    "staticData": null,
    "meta": null,
    "pinData": null,
    "versionId": "ced0d023-1099-459b-8d63-861c66a53948",
    "activeVersionId": null,
    "triggerCount": 0,
    "shared": [
      {
        "updatedAt": "2025-12-15T15:53:59.866Z",
        "createdAt": "2025-12-15T15:53:59.866Z",
        "role": "workflow:owner",
        "workflowId": "9pBWg7IQeNUJczJO",
        "projectId": "CyuOAJo56zhDqPtw"
      }
    ],
    "activeVersion": null,
    "tags": []
  },
  {
    "updatedAt": "2025-07-29T14:20:50.000Z",
    "createdAt": "2025-07-29T03:31:07.633Z",
    "id": "9rIUHbeYPtzAAB8P",
    "name": "chatbot-pizza-order",
    "active": false,
    "isArchived": false,
    "nodes": [
      {
        "parameters": {},
        "id": "8a04b8e6-ac8b-487f-a5be-18369a292edc",
        "name": "Calculator",
        "type": "@n8n/n8n-nodes-langchain.toolCalculator",
        "position": [
          928,
          320
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "f0ce099e-41a7-433b-ac43-a9878969e0db",
        "name": "Chat OpenAI",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          208,
          320
        ],
        "typeVersion": 1
      },
      {
        "parameters": {},
        "id": "5a613397-c5bd-41cb-8626-65dd1ccb5a0b",
        "name": "Window Buffer Memory",
        "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "position": [
          368,
          320
        ],
        "typeVersion": 1.2
      },
      {
        "parameters": {
          "toolDescription": "Retrieve detailed information about the product menu.",
          "url": "https://n8n.io/webhook/get-products"
        },
        "id": "8c1b486b-36c0-4828-9838-2e5cbecdd63f",
        "name": "Get Products",
        "type": "@n8n/n8n-nodes-langchain.toolHttpRequest",
        "position": [
          528,
          320
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "toolDescription": "Process product orders.",
          "method": "POST",
          "url": "https://n8n.io/webhook/order-product",
          "sendBody": true,
          "parametersBody": {
            "values": [
              {
                "name": "message",
                "valueProvider": "fieldValue",
                "value": "={{ $json.chatInput }}"
              }
            ]
          }
        },
        "id": "a35682e4-2ac6-4af3-a724-245753cdcd15",
        "name": "Order Product",
        "type": "@n8n/n8n-nodes-langchain.toolHttpRequest",
        "position": [
          672,
          320
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "toolDescription": "Get the order status.",
          "url": "https://n8n.io/webhook/get-orders"
        },
        "id": "d60cfd94-aaf7-42e9-b01e-d717a3319200",
        "name": "Get Order",
        "type": "@n8n/n8n-nodes-langchain.toolHttpRequest",
        "position": [
          784,
          320
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "public": true,
          "initialMessages": "Hellooo! 👋 My name is Pizzaro 🍕. I'm here to help with your pizza order. How can I assist you?\n\n📣 INFO: If you’d like to order a pizza, please include your name + pizza type + quantity. Thank you!",
          "options": {}
        },
        "id": "6154ba61-77d1-4a03-9d81-121407846a28",
        "name": "When chat message received",
        "type": "@n8n/n8n-nodes-langchain.chatTrigger",
        "position": [
          0,
          0
        ],
        "webhookId": "d925cc6e-6dd7-4459-a917-e68d57ab0e2a",
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.chatInput }}",
          "options": {
            "systemMessage": "=Te llamas Pizzaro y eres asistente de pedidos de pizza.\n\n1. Si un cliente pregunta por el menú, proporciona información sobre los productos disponibles.\n2. Si un cliente realiza un pedido, confirma los detalles, infórmale de que está en proceso y agradécele.\n3. Si un cliente pregunta por el estado de su pedido, proporciona la fecha, el tipo de pizza y la cantidad."
          }
        },
        "id": "0266ccab-e93d-4065-a64b-ab90d78bc0e2",
        "name": "AI Agent",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          240,
          0
        ],
        "executeOnce": false,
        "typeVersion": 1.6
      }
    ],
    "connections": {
      "Get Order": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Calculator": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Chat OpenAI": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Get Products": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Order Product": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Window Buffer Memory": {
        "ai_memory": [
          [
            {
              "node": "AI Agent",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "When chat message received": {
        "main": [
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": null,
    "pinData": {},
    "versionId": "07a38d3c-0f0d-49ff-9f16-48b53cb2cc9f",
    "activeVersionId": null,
    "triggerCount": 0,
    "shared": [
      {
        "updatedAt": "2025-07-29T03:31:07.641Z",
        "createdAt": "2025-07-29T03:31:07.641Z",
        "role": "workflow:owner",
        "workflowId": "9rIUHbeYPtzAAB8P",
        "projectId": "CyuOAJo56zhDqPtw"
      }
    ],
    "activeVersion": null,
    "tags": []
  },
  {
    "updatedAt": "2025-12-15T18:09:11.000Z",
    "createdAt": "2025-12-15T16:02:11.250Z",
    "id": "BIRRbowBQlGr4BmB",
    "name": "Seguimientos Diarios Allpol",
    "active": false,
    "isArchived": true,
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "triggerAtHour": 9
              }
            ]
          }
        },
        "id": "schedule-trigger",
        "name": "Cada día 9AM",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          0,
          0
        ]
      },
      {
        "parameters": {
          "operation": "getAll",
          "tableId": "client_followups",
          "returnAll": true,
          "filterType": "string",
          "filterString": "scheduled_date=lte.{{ $now.format('yyyy-MM-dd') }}&status=eq.pending&select=*,clients(name,phone)",
          "options": {}
        },
        "id": "supabase-get",
        "name": "Get Followups Pendientes",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          220,
          0
        ],
        "credentials": {
          "supabaseApi": {
            "id": "supabase-creds",
            "name": "Supabase Allpol"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "condition-check",
                "leftValue": "={{ $input.all().length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "if-hay-pendientes",
        "name": "¿Hay pendientes?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          440,
          0
        ]
      },
      {
        "parameters": {
          "jsCode": "const followups = $input.all();\n\nconst today = new Date().toLocaleDateString('es-AR', { \n  weekday: 'long', \n  year: 'numeric', \n  month: 'long', \n  day: 'numeric' \n});\n\nlet message = `📅 *Seguimientos pendientes*\\n${today}\\n\\n`;\n\nconst typeEmojis = {\n  'reminder': '🔔',\n  'grouping': '📦',\n  'material': '🏭'\n};\n\nconst typeNames = {\n  'reminder': 'Recordatorio',\n  'grouping': 'Oportunidad de Agrupación',\n  'material': 'Material Disponible'\n};\n\nfollowups.forEach((item, index) => {\n  const f = item.json;\n  const emoji = typeEmojis[f.type] || '📌';\n  const typeName = typeNames[f.type] || f.type;\n  \n  // Calcular días de atraso\n  const schedDate = new Date(f.scheduled_date);\n  const todayDate = new Date();\n  const daysLate = Math.floor((todayDate - schedDate) / (1000 * 60 * 60 * 24));\n  const lateText = daysLate > 0 ? ` ⚠️ (${daysLate} días de atraso)` : '';\n  \n  message += `${index + 1}. ${emoji} *${f.clients?.name || 'Cliente'}*${lateText}\\n`;\n  message += `   _${typeName}_\\n`;\n  if (f.notes) message += `   📝 ${f.notes}\\n`;\n  if (f.product_reference) message += `   📦 ${f.product_reference}\\n`;\n  message += `   📱 ${f.clients?.phone || 'Sin teléfono'}\\n\\n`;\n});\n\nmessage += `─────────────────\\n`;\nmessage += `_Total: ${followups.length} seguimiento(s) pendiente(s)_\\n`;\nmessage += `\\n💡 _Abrí Allpol Gestión > Seguimientos para gestionar_`;\n\nreturn [{ json: { message, count: followups.length } }];"
        },
        "id": "code-format",
        "name": "Formatear Mensaje",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          660,
          -100
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://automatizacion-evolution-api.aq0vtr.easypanel.host/message/sendText/Allpol",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              },
              {
                "name": "apikey",
                "value": "97D1DBC4C9E6-42E7-85E8-8E53D285C69E"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"number\": \"5492216925658@s.whatsapp.net\",\n  \"text\": {{ JSON.stringify($json.message) }}\n}",
          "options": {}
        },
        "id": "http-whatsapp",
        "name": "Enviar WhatsApp",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          880,
          -100
        ]
      },
      {
        "parameters": {},
        "id": "noop-end",
        "name": "Sin pendientes",
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          660,
          100
        ]
      }
    ],
    "connections": {
      "Cada día 9AM": {
        "main": [
          [
            {
              "node": "Get Followups Pendientes",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Followups Pendientes": {
        "main": [
          [
            {
              "node": "¿Hay pendientes?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "¿Hay pendientes?": {
        "main": [
          [
            {
              "node": "Formatear Mensaje",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Sin pendientes",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Formatear Mensaje": {
        "main": [
          [
            {
              "node": "Enviar WhatsApp",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1",
      "timezone": "America/Argentina/Buenos_Aires",
      "callerPolicy": "workflowsFromSameOwner",
      "availableInMCP": false
    },
    "staticData": null,
    "meta": null,
    "pinData": null,
    "versionId": "92ee5f04-21ea-44b2-b448-93c0014b0cf2",
    "activeVersionId": null,
    "triggerCount": 0,
    "shared": [
      {
        "updatedAt": "2025-12-15T16:02:11.252Z",
        "createdAt": "2025-12-15T16:02:11.252Z",
        "role": "workflow:owner",
        "workflowId": "BIRRbowBQlGr4BmB",
        "projectId": "CyuOAJo56zhDqPtw"
      }
    ],
    "activeVersion": null,
    "tags": []
  },
  {
    "updatedAt": "2025-12-24T15:29:51.000Z",
    "createdAt": "2025-12-24T15:26:00.460Z",
    "id": "BhMqg4cSTIPhRrxh",
    "name": "Sync Project - Sync Now",
    "active": false,
    "isArchived": true,
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "sync-webhook",
          "options": {}
        },
        "id": "webhook-trigger",
        "name": "Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 1,
        "position": [
          0,
          0
        ]
      },
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "supabase_url",
                "value": "https://qvxxhwcspqntdesrajph.supabase.co"
              },
              {
                "name": "supabase_key",
                "value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF2eHhod2NzcHFudGRlc3JhanBoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NjQyOTI2MCwiZXhwIjoyMDgyMDA1MjYwfQ.wpVpE0i-KYtaH-LTR4Ho9IXtg_TFTIxzkO7T4gWsnbY"
              }
            ]
          },
          "options": {}
        },
        "id": "set-auth",
        "name": "Set Supabase Auth",
        "type": "n8n-nodes-base.set",
        "typeVersion": 1,
        "position": [
          200,
          0
        ]
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "={{\"SELECT * FROM sync_tasks WHERE id = '\" + $json.body.sync_id + \"'::uuid\"}}"
        },
        "id": "postgres-get-config",
        "name": "Postgres Get Config",
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 1,
        "position": [
          400,
          0
        ],
        "credentials": {
          "postgres": {
            "id": "POSTGRES_CREDENTIAL_ID_PLACEHOLDER",
            "name": "Postgres account"
          }
        }
      },
      {
        "parameters": {
          "sheetId": "={{$json.sheet_id}}",
          "range": "={{$json.range_config}}",
          "options": {}
        },
        "id": "google-sheets",
        "name": "Google Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 1,
        "position": [
          600,
          0
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "XCVUrxXJwWv4s45E",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "url": "={{$node[\"Set Supabase Auth\"].json[\"supabase_url\"]}}/storage/v1/object/public/templates/{{$node[\"Postgres Get Config\"].json[\"template_path\"]}}",
          "options": {}
        },
        "id": "download-template",
        "name": "Download Template",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 1,
        "position": [
          600,
          200
        ]
      },
      {
        "parameters": {
          "jsCode": "const template = $items(\"Download Template\")[0].json.data;\nconst rows = $items(\"Google Sheets\");\n\nlet finalHtml = \"\";\n\n/* Iterate over Google Sheets rows and replace placeholders in template */\nfor (const row of rows) {\n  let rowHtml = typeof template === 'string' ? template : JSON.stringify(template);\n  \n  for (const key of Object.keys(row.json)) {\n    // Replace {{ColumnName}} with value\n    // Using simple replace (first occurrence) or global regex\n    const val = row.json[key];\n    if (val !== undefined && val !== null) {\n       rowHtml = rowHtml.split('{{' + key + '}}').join(val);\n    }\n  }\n  finalHtml += rowHtml + \"\\n\";\n}\n\nreturn [{ json: { html: finalHtml, count: rows.length } }];"
        },
        "id": "process-template",
        "name": "Process Template",
        "type": "n8n-nodes-base.code",
        "typeVersion": 1,
        "position": [
          800,
          0
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{$node[\"Set Supabase Auth\"].json[\"supabase_url\"]}}/storage/v1/object/public-sites/{{$node[\"Postgres Get Config\"].json[\"output_path\"]}}",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "text/html"
              },
              {
                "name": "Authorization",
                "value": "Bearer {{$node[\"Set Supabase Auth\"].json[\"supabase_key\"]}}"
              }
            ]
          },
          "sendBody": true,
          "contentType": "raw",
          "rawContentType": "text/html",
          "body": "={{$json.html}}",
          "options": {}
        },
        "id": "upload-result",
        "name": "Upload Result",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 1,
        "position": [
          1000,
          0
        ]
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "={{\"UPDATE sync_tasks SET last_update = NOW(), last_action_log = 'Sincronización Exitosa: \" + $json.count + \" filas procesadas.' WHERE id = '\" + $node[\"Webhook\"].json.body.sync_id + \"'::uuid\"}}"
        },
        "id": "update-success",
        "name": "Update Success",
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 1,
        "position": [
          1200,
          0
        ],
        "credentials": {
          "postgres": {
            "id": "POSTGRES_CREDENTIAL_ID_PLACEHOLDER",
            "name": "Postgres account"
          }
        }
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          400,
          400
        ]
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "={{\"UPDATE sync_tasks SET last_action_log = 'Error: \" + $execution.error.message.replace(/'/g, \"''\") + \"' WHERE id = '\" + $node[\"Webhook\"].json.body.sync_id + \"'::uuid\"}}"
        },
        "id": "update-error",
        "name": "Update Error",
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 1,
        "position": [
          600,
          400
        ],
        "credentials": {
          "postgres": {
            "id": "POSTGRES_CREDENTIAL_ID_PLACEHOLDER",
            "name": "Postgres account"
          }
        }
      }
    ],
    "connections": {
      "Webhook": {
        "main": [
          [
            {
              "node": "Set Supabase Auth",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Supabase Auth": {
        "main": [
          [
            {
              "node": "Postgres Get Config",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Postgres Get Config": {
        "main": [
          [
            {
              "node": "Google Sheets",
              "type": "main",
              "index": 0
            },
            {
              "node": "Download Template",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Sheets": {
        "main": [
          [
            {
              "node": "Process Template",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Download Template": {
        "main": [
          [
            {
              "node": "Process Template",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Process Template": {
        "main": [
          [
            {
              "node": "Upload Result",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upload Result": {
        "main": [
          [
            {
              "node": "Update Success",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Update Error",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "callerPolicy": "workflowsFromSameOwner",
      "availableInMCP": false
    },
    "staticData": null,
    "meta": null,
    "pinData": null,
    "versionId": "bd98f08d-8197-411b-b43a-2dbfc79124a7",
    "activeVersionId": null,
    "triggerCount": 0,
    "shared": [
      {
        "updatedAt": "2025-12-24T15:26:00.465Z",
        "createdAt": "2025-12-24T15:26:00.465Z",
        "role": "workflow:owner",
        "workflowId": "BhMqg4cSTIPhRrxh",
        "projectId": "CyuOAJo56zhDqPtw"
      }
    ],
    "activeVersion": null,
    "tags": []
  },
  {
    "updatedAt": "2025-12-24T15:29:38.000Z",
    "createdAt": "2025-12-22T20:15:33.602Z",
    "id": "GSY1cBgyuHNLnq8i",
    "name": "Sync Project - Sync Now",
    "active": false,
    "isArchived": true,
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "sync-webhook",
          "options": {}
        },
        "id": "webhook-trigger",
        "name": "Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 1,
        "position": [
          0,
          0
        ],
        "webhookId": "6004196e-307b-438d-97f9-2208f1f7da0d"
      },
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "supabase_url",
                "value": "https://qvxxhwcspqntdesrajph.supabase.co"
              },
              {
                "name": "supabase_key",
                "value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF2eHhod2NzcHFudGRlc3JhanBoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NjQyOTI2MCwiZXhwIjoyMDgyMDA1MjYwfQ.wpVpE0i-KYtaH-LTR4Ho9IXtg_TFTIxzkO7T4gWsnbY"
              }
            ]
          },
          "options": {}
        },
        "id": "set-auth",
        "name": "Set Supabase Auth",
        "type": "n8n-nodes-base.set",
        "typeVersion": 1,
        "position": [
          208,
          0
        ]
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "SELECT * FROM sync_tasks WHERE id = $1",
          "additionalFields": {
            "queryParams": "={{$json.body.sync_id}}"
          }
        },
        "id": "postgres-get-config",
        "name": "Postgres Get Config",
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 1,
        "position": [
          400,
          0
        ],
        "credentials": {
          "postgres": {
            "id": "aobTbK1v7d49Vmqp",
            "name": "SyncProyect - Postgres a Supabase"
          }
        }
      },
      {
        "parameters": {
          "authentication": "oAuth2",
          "sheetId": "={{$json.sheet_id}}",
          "range": "={{$json.range_config}}",
          "options": {}
        },
        "id": "google-sheets",
        "name": "Google Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 1,
        "position": [
          608,
          0
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "XCVUrxXJwWv4s45E",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "url": "={{$node[\"Set Supabase Auth\"].json[\"supabase_url\"]}}/storage/v1/object/public/templates/{{$node[\"Postgres Get Configুরের\"].json[\"template_path\"]}}",
          "options": {}
        },
        "id": "download-template",
        "name": "Download Template",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 1,
        "position": [
          608,
          208
        ]
      },
      {
        "parameters": {
          "jsCode": "const template = $items(\"Download Template\")[0].json.data;\nconst rows = $items(\"Google Sheets\");\n\nlet finalHtml = \"\";\n\n/* Iterate over Google Sheets rows and replace placeholders in template */\nfor (const row of rows) {\n  let rowHtml = typeof template === 'string' ? template : JSON.stringify(template);\n  \n  for (const key of Object.keys(row.json)) {\n    // Replace {{ColumnName}} with value\n    // Using simple replace (first occurrence) or global regex\n    const val = row.json[key];\n    if (val !== undefined && val !== null) {\n       rowHtml = rowHtml.split('{{' + key + '}}').join(val);\n    }\n  }\n  finalHtml += rowHtml + \"\\n\";\n}\n\nreturn [{ json: { html: finalHtml, count: rows.length } }];"
        },
        "id": "process-template",
        "name": "Process Template",
        "type": "n8n-nodes-base.code",
        "typeVersion": 1,
        "position": [
          800,
          0
        ]
      },
      {
        "parameters": {
          "url": "={{$node[\"Set Supabase Auth\"].json[\"supabase_url\"]}}/storage/v1/object/public-sites/{{$node[\"Postgres Get Config\"].json[\"output_path\"]}}",
          "options": {}
        },
        "id": "upload-result",
        "name": "Upload Result",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 1,
        "position": [
          1008,
          0
        ]
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "UPDATE syncs SET last_update = NOW(), last_action = $1, status = 'success' WHERE id = $2",
          "additionalFields": {
            "queryParams": "={{ 'Sincronización Exitosa: ' + $json.count + ' filas procesadas.' }},{{$node[\"Postgres Get Config\"].json[\"id\"]}}"
          }
        },
        "id": "update-success",
        "name": "Update Success",
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 1,
        "position": [
          1200,
          0
        ],
        "credentials": {
          "postgres": {
            "id": "aobTbK1v7d49Vmqp",
            "name": "SyncProyect - Postgres a Supabase"
          }
        }
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          400,
          400
        ]
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "UPDATE sync_tasks SET last_action = $1, status = 'error' WHERE id = $2",
          "additionalFields": {
            "queryParams": "={{ 'Error: ' + $execution.error.message }},{{$node[\"Postgres Get Config\"].json[\"id\"]}}"
          }
        },
        "id": "update-error",
        "name": "Update Error",
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 1,
        "position": [
          608,
          400
        ],
        "credentials": {
          "postgres": {
            "id": "aobTbK1v7d49Vmqp",
            "name": "SyncProyect - Postgres a Supabase"
          }
        }
      }
    ],
    "connections": {
      "Webhook": {
        "main": [
          [
            {
              "node": "Set Supabase Auth",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Supabase Auth": {
        "main": [
          [
            {
              "node": "Postgres Get Config",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Postgres Get Config": {
        "main": [
          [
            {
              "node": "Google Sheets",
              "type": "main",
              "index": 0
            },
            {
              "node": "Download Template",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Sheets": {
        "main": [
          [
            {
              "node": "Process Template",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Download Template": {
        "main": [
          [
            {
              "node": "Process Template",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Process Template": {
        "main": [
          [
            {
              "node": "Upload Result",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upload Result": {
        "main": [
          [
            {
              "node": "Update Success",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Update Error",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "callerPolicy": "workflowsFromSameOwner",
      "availableInMCP": true,
      "timeSavedMode": "fixed",
      "executionOrder": "v0"
    },
    "staticData": null,
    "meta": {
      "templateCredsSetupCompleted": true
    },
    "pinData": {
      "Error Trigger": [
        {
          "json": {
            "execution": {
              "id": "30844",
              "url": "https://n8n.cr-sites.com/workflow/GSY1cBgyuHNLnq8i/executions/30844",
              "error": {
                "length": 104,
                "name": "error",
                "severity": "ERROR",
                "code": "42P01",
                "position": "15",
                "file": "parse_relation.c",
                "line": "1449",
                "routine": "parserOpenTable",
                "query": "SELECT * FROM syncs WHERE id = null",
                "message": "relation \"syncs\" does not exist",
                "stack": "error: relation \"syncs\" does not exist\n    at Parser.parseErrorMessage (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/pg-protocol@1.6.1/node_modules/pg-protocol/src/parser.ts:369:69)\n    at Parser.handlePacket (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/pg-protocol@1.6.1/node_modules/pg-protocol/src/parser.ts:188:21)\n    at Parser.parse (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/pg-protocol@1.6.1/node_modules/pg-protocol/src/parser.ts:103:30)\n    at TLSSocket.<anonymous> (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/pg-protocol@1.6.1/node_modules/pg-protocol/src/index.ts:7:48)\n    at TLSSocket.emit (node:events:519:28)\n    at addChunk (node:internal/streams/readable:561:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)\n    at TLSSocket.Readable.push (node:internal/streams/readable:392:5)\n    at TLSWrap.onStreamRead (node:internal/stream_base_commons:189:23)\n    at TLSWrap.callbackTrampoline (node:internal/async_hooks:130:17)"
              },
              "lastNodeExecuted": "Postgres Get Config",
              "mode": "webhook",
              "executionContext": {
                "version": 1,
                "establishedAt": 1766506569810,
                "source": "webhook"
              }
            },
            "workflow": {
              "id": "GSY1cBgyuHNLnq8i",
              "name": "Sync Project - Sync Now"
            }
          },
          "pairedItem": {
            "item": 0
          }
        }
      ],
      "Webhook": [
        {
          "json": {
            "headers": {
              "host": "n8n.cr-sites.com",
              "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36",
              "content-length": "50",
              "accept": "*/*",
              "accept-encoding": "gzip, br",
              "accept-language": "es-US,es-419;q=0.9,es;q=0.8,en;q=0.7",
              "cdn-loop": "cloudflare; loops=1",
              "cf-connecting-ip": "186.22.62.56",
              "cf-ipcountry": "AR",
              "cf-ray": "9b2a0acbb82950bd-EZE",
              "cf-visitor": "{\"scheme\":\"https\"}",
              "content-type": "application/json",
              "origin": "http://localhost:5173",
              "priority": "u=1, i",
              "referer": "http://localhost:5173/",
              "sec-ch-ua": "\"Google Chrome\";v=\"143\", \"Chromium\";v=\"143\", \"Not A(Brand\";v=\"24\"",
              "sec-ch-ua-mobile": "?0",
              "sec-ch-ua-platform": "\"Windows\"",
              "sec-fetch-dest": "empty",
              "sec-fetch-mode": "cors",
              "sec-fetch-site": "cross-site",
              "x-forwarded-for": "186.22.62.56, 104.23.237.26",
              "x-forwarded-host": "n8n.cr-sites.com",
              "x-forwarded-port": "443",
              "x-forwarded-proto": "https",
              "x-forwarded-server": "51e2ac7da1b4",
              "x-real-ip": "104.23.237.26"
            },
            "params": {},
            "query": {},
            "body": {
              "sync_id": "2a3d03f2-5ee7-4075-b3d4-449236770e08"
            },
            "webhookUrl": "https://n8n.cr-sites.com/webhook/sync-webhook",
            "executionMode": "production"
          },
          "pairedItem": {
            "item": 0
          }
        }
      ]
    },
    "versionId": "1d6c08f1-2b10-4579-867d-ff57f57c5ad1",
    "activeVersionId": null,
    "triggerCount": 1,
    "shared": [
      {
        "updatedAt": "2025-12-22T20:15:33.625Z",
        "createdAt": "2025-12-22T20:15:33.625Z",
        "role": "workflow:owner",
        "workflowId": "GSY1cBgyuHNLnq8i",
        "projectId": "CyuOAJo56zhDqPtw"
      }
    ],
    "activeVersion": null,
    "tags": []
  },
  {
    "updatedAt": "2025-12-17T13:37:24.876Z",
    "createdAt": "2025-12-15T16:02:23.053Z",
    "id": "M41AzCPlhql4OhOe",
    "name": "Seguimientos Diarios Allpol",
    "active": true,
    "isArchived": false,
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "triggerAtHour": 9
              }
            ]
          }
        },
        "id": "schedule-trigger",
        "name": "Cada día 9AM",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          0,
          0
        ]
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "SELECT\n  f.*,\n  json_build_object('name', c.name, 'phone', c.phone) as clients\nFROM\n  client_followups f\nJOIN\n  clients c ON f.client_id = c.id\nWHERE\n  f.scheduled_date <= CURRENT_DATE\n  AND f.status = 'pending'",
          "additionalOptions": {}
        },
        "id": "postgres-get",
        "name": "Get Followups Pendientes",
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 1,
        "position": [
          220,
          0
        ],
        "credentials": {
          "postgres": {
            "id": "8vHFUEVgUU6uzixr",
            "name": "Postgres a Supabase"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "condition-check",
                "leftValue": "={{ $input.all().length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "if-hay-pendientes",
        "name": "¿Hay pendientes?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          440,
          0
        ]
      },
      {
        "parameters": {
          "jsCode": "const followups = $input.all();\n\nconst today = new Date().toLocaleDateString('es-AR', { \n  weekday: 'long', \n  year: 'numeric', \n  month: 'long', \n  day: 'numeric' \n});\n\nlet message = `📅 *Seguimientos pendientes*\\n${today}\\n\\n`;\n\nconst typeEmojis = {\n  'reminder': '🔔',\n  'grouping': '📦',\n  'material': '🏭'\n};\n\nconst typeNames = {\n  'reminder': 'Recordatorio',\n  'grouping': 'Oportunidad de Agrupación',\n  'material': 'Material Disponible'\n};\n\nfollowups.forEach((item, index) => {\n  const f = item.json;\n  // Postgres json column handling\n  const client = typeof f.clients === 'string' ? JSON.parse(f.clients) : f.clients;\n  \n  const emoji = typeEmojis[f.type] || '📌';\n  const typeName = typeNames[f.type] || f.type;\n  \n  // Calcular días de atraso\n  const schedDate = new Date(f.scheduled_date);\n  const todayDate = new Date();\n  const daysLate = Math.floor((todayDate - schedDate) / (1000 * 60 * 60 * 24));\n  const lateText = daysLate > 0 ? ` ⚠️ (${daysLate} días de atraso)` : '';\n  \n  message += `${index + 1}. ${emoji} *${client?.name || 'Cliente'}*${lateText}\\n`;\n  message += `   _${typeName}_\\n`;\n  if (f.notes) message += `   📝 ${f.notes}\\n`;\n  if (f.product_reference) message += `   📦 ${f.product_reference}\\n`;\n  message += `   📱 ${client?.phone || 'Sin teléfono'}\\n\\n`;\n});\n\nmessage += `─────────────────\\n`;\nmessage += `_Total: ${followups.length} seguimiento(s) pendiente(s)_\\n`;\nmessage += `\\n💡 _Abrí Allpol Gestión > Seguimientos para gestionar_`;\n\nreturn [{ json: { message, count: followups.length } }];"
        },
        "id": "code-format",
        "name": "Formatear Mensaje",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          660,
          -100
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://automatizacion-evolution-api.aq0vtr.easypanel.host/message/sendText/Allpol",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              },
              {
                "name": "apikey",
                "value": "97D1DBC4C9E6-42E7-85E8-8E53D285C69E"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"number\": \"5492216925658@s.whatsapp.net\",\n  \"text\": {{ JSON.stringify($json.message) }}\n}",
          "options": {}
        },
        "id": "http-whatsapp",
        "name": "Enviar WhatsApp",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          880,
          -100
        ]
      },
      {
        "parameters": {},
        "id": "noop-end",
        "name": "Sin pendientes",
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          660,
          100
        ]
      }
    ],
    "connections": {
      "Cada día 9AM": {
        "main": [
          [
            {
              "node": "Get Followups Pendientes",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Followups Pendientes": {
        "main": [
          [
            {
              "node": "¿Hay pendientes?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "¿Hay pendientes?": {
        "main": [
          [
            {
              "node": "Formatear Mensaje",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Sin pendientes",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Formatear Mensaje": {
        "main": [
          [
            {
              "node": "Enviar WhatsApp",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1",
      "timezone": "America/Argentina/Buenos_Aires",
      "callerPolicy": "workflowsFromSameOwner",
      "availableInMCP": true
    },
    "staticData": {
      "node:Cada día 9AM": {
        "recurrenceRules": []
      }
    },
    "meta": null,
    "pinData": null,
    "versionId": "fca6e73b-800c-441c-8f7d-c6f966d2c638",
    "activeVersionId": "fca6e73b-800c-441c-8f7d-c6f966d2c638",
    "triggerCount": 1,
    "shared": [
      {
        "updatedAt": "2025-12-15T16:02:23.056Z",
        "createdAt": "2025-12-15T16:02:23.056Z",
        "role": "workflow:owner",
        "workflowId": "M41AzCPlhql4OhOe",
        "projectId": "CyuOAJo56zhDqPtw"
      }
    ],
    "activeVersion": {
      "updatedAt": "2025-12-15T18:19:45.041Z",
      "createdAt": "2025-12-15T18:19:45.041Z",
      "versionId": "fca6e73b-800c-441c-8f7d-c6f966d2c638",
      "workflowId": "M41AzCPlhql4OhOe",
      "nodes": [
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "triggerAtHour": 9
                }
              ]
            }
          },
          "id": "schedule-trigger",
          "name": "Cada día 9AM",
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.2,
          "position": [
            0,
            0
          ]
        },
        {
          "parameters": {
            "operation": "executeQuery",
            "query": "SELECT\n  f.*,\n  json_build_object('name', c.name, 'phone', c.phone) as clients\nFROM\n  client_followups f\nJOIN\n  clients c ON f.client_id = c.id\nWHERE\n  f.scheduled_date <= CURRENT_DATE\n  AND f.status = 'pending'",
            "additionalOptions": {}
          },
          "id": "postgres-get",
          "name": "Get Followups Pendientes",
          "type": "n8n-nodes-base.postgres",
          "typeVersion": 1,
          "position": [
            220,
            0
          ],
          "credentials": {
            "postgres": {
              "id": "8vHFUEVgUU6uzixr",
              "name": "Postgres a Supabase"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict"
              },
              "conditions": [
                {
                  "id": "condition-check",
                  "leftValue": "={{ $input.all().length }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "number",
                    "operation": "gt"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "id": "if-hay-pendientes",
          "name": "¿Hay pendientes?",
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            440,
            0
          ]
        },
        {
          "parameters": {
            "jsCode": "const followups = $input.all();\n\nconst today = new Date().toLocaleDateString('es-AR', { \n  weekday: 'long', \n  year: 'numeric', \n  month: 'long', \n  day: 'numeric' \n});\n\nlet message = `📅 *Seguimientos pendientes*\\n${today}\\n\\n`;\n\nconst typeEmojis = {\n  'reminder': '🔔',\n  'grouping': '📦',\n  'material': '🏭'\n};\n\nconst typeNames = {\n  'reminder': 'Recordatorio',\n  'grouping': 'Oportunidad de Agrupación',\n  'material': 'Material Disponible'\n};\n\nfollowups.forEach((item, index) => {\n  const f = item.json;\n  // Postgres json column handling\n  const client = typeof f.clients === 'string' ? JSON.parse(f.clients) : f.clients;\n  \n  const emoji = typeEmojis[f.type] || '📌';\n  const typeName = typeNames[f.type] || f.type;\n  \n  // Calcular días de atraso\n  const schedDate = new Date(f.scheduled_date);\n  const todayDate = new Date();\n  const daysLate = Math.floor((todayDate - schedDate) / (1000 * 60 * 60 * 24));\n  const lateText = daysLate > 0 ? ` ⚠️ (${daysLate} días de atraso)` : '';\n  \n  message += `${index + 1}. ${emoji} *${client?.name || 'Cliente'}*${lateText}\\n`;\n  message += `   _${typeName}_\\n`;\n  if (f.notes) message += `   📝 ${f.notes}\\n`;\n  if (f.product_reference) message += `   📦 ${f.product_reference}\\n`;\n  message += `   📱 ${client?.phone || 'Sin teléfono'}\\n\\n`;\n});\n\nmessage += `─────────────────\\n`;\nmessage += `_Total: ${followups.length} seguimiento(s) pendiente(s)_\\n`;\nmessage += `\\n💡 _Abrí Allpol Gestión > Seguimientos para gestionar_`;\n\nreturn [{ json: { message, count: followups.length } }];"
          },
          "id": "code-format",
          "name": "Formatear Mensaje",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            660,
            -100
          ]
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://automatizacion-evolution-api.aq0vtr.easypanel.host/message/sendText/Allpol",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                },
                {
                  "name": "apikey",
                  "value": "97D1DBC4C9E6-42E7-85E8-8E53D285C69E"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n  \"number\": \"5492216925658@s.whatsapp.net\",\n  \"text\": {{ JSON.stringify($json.message) }}\n}",
            "options": {}
          },
          "id": "http-whatsapp",
          "name": "Enviar WhatsApp",
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            880,
            -100
          ]
        },
        {
          "parameters": {},
          "id": "noop-end",
          "name": "Sin pendientes",
          "type": "n8n-nodes-base.noOp",
          "typeVersion": 1,
          "position": [
            660,
            100
          ]
        }
      ],
      "connections": {
        "Cada día 9AM": {
          "main": [
            [
              {
                "node": "Get Followups Pendientes",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Followups Pendientes": {
          "main": [
            [
              {
                "node": "¿Hay pendientes?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "¿Hay pendientes?": {
          "main": [
            [
              {
                "node": "Formatear Mensaje",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Sin pendientes",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Formatear Mensaje": {
          "main": [
            [
              {
                "node": "Enviar WhatsApp",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "authors": "malco fernandez",
      "name": null,
      "description": null
    },
    "tags": []
  },
  {
    "updatedAt": "2025-07-29T13:57:38.000Z",
    "createdAt": "2025-07-29T13:57:11.708Z",
    "id": "P7inH2L4zFOJD4p9",
    "name": "n8n-chat-conversational",
    "active": false,
    "isArchived": false,
    "nodes": [
      {
        "parameters": {
          "content": "### El historial de conversaciones (últimos 20 mensajes) se almacena en una memoria intermedia",
          "height": 225,
          "width": 300
        },
        "id": "8f576801-5096-4031-97d6-406330d740d1",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -48,
          400
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "### Herramientas que el agente puede utilizar para realizar la tarea",
          "height": 225,
          "width": 340
        },
        "id": "f93a2f8a-87b1-4a74-bb3f-46a940513623",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          304,
          400
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "### El agente conversacional utilizará las herramientas disponibles para responder la solicitud.",
          "height": 211,
          "width": 422
        },
        "id": "633248f4-79a5-4b27-bb37-cc3a62c97440",
        "name": "Sticky Note6",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          0,
          0
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "849971b9-8a6d-4c44-be45-97e208230bf2",
        "name": "When chat message received",
        "type": "@n8n/n8n-nodes-langchain.chatTrigger",
        "position": [
          -304,
          80
        ],
        "webhookId": "d48f9e07-3c05-4be8-86ca-5cee4c27b78f",
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "id": "d7f0523e-17d7-4e8d-83c7-14c18bb76760",
        "name": "OpenAI Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          -224,
          512
        ],
        "typeVersion": 1.2,
        "credentials": {
          "openAiApi": {
            "id": "4KlRoIAzZJhV4U20",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "contextWindowLength": 20
        },
        "id": "d1f939cf-0e0f-4480-9773-4c21073e8a2d",
        "name": "Simple Memory",
        "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "position": [
          64,
          512
        ],
        "typeVersion": 1.3
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "1ced84ec-4a27-4792-ac02-8e7318996933",
        "name": "SerpAPI",
        "type": "@n8n/n8n-nodes-langchain.toolSerpApi",
        "position": [
          368,
          512
        ],
        "typeVersion": 1
      },
      {
        "parameters": {},
        "id": "a6a277e4-723a-401f-9ddf-4dd0a84a3079",
        "name": "Wikipedia",
        "type": "@n8n/n8n-nodes-langchain.toolWikipedia",
        "position": [
          512,
          512
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "155adda9-f40a-411b-a95a-443b1143d3f5",
        "name": "AI Agent",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          80,
          80
        ],
        "typeVersion": 1.8
      }
    ],
    "connections": {
      "SerpAPI": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Wikipedia": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Simple Memory": {
        "ai_memory": [
          [
            {
              "node": "AI Agent",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "When chat message received": {
        "main": [
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": null,
    "pinData": {},
    "versionId": "d56bca4e-9744-40c8-8465-a8a49cf0dd98",
    "activeVersionId": null,
    "triggerCount": 0,
    "shared": [
      {
        "updatedAt": "2025-07-29T13:57:11.718Z",
        "createdAt": "2025-07-29T13:57:11.718Z",
        "role": "workflow:owner",
        "workflowId": "P7inH2L4zFOJD4p9",
        "projectId": "CyuOAJo56zhDqPtw"
      }
    ],
    "activeVersion": null,
    "tags": []
  }
]