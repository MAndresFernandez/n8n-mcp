[
  {
    "updatedAt": "2025-12-08T18:55:49.000Z",
    "createdAt": "2025-06-20T01:04:28.472Z",
    "id": "3vZyObH9koXfTnp8",
    "name": "Leads R&R",
    "active": true,
    "isArchived": false,
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "leads",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          -1904,
          1376
        ],
        "id": "d0908e51-97fa-42bd-85d0-1553a8b1808e",
        "name": "Webhook",
        "webhookId": "a3414e97-f942-4938-a579-02cbf2d4bf12"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $('Webhook').item.json.body.referrer }}",
                      "rightValue": "https://camarasseguridad.net/",
                      "operator": {
                        "type": "string",
                        "operation": "contains"
                      },
                      "id": "8f3859ea-ae2e-4b73-994a-50b8a7abddf1"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "camaras CR"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "5aa0ed40-7430-4dbc-a76b-89dee516d122",
                      "leftValue": "={{ $('Webhook').item.json.body.referrer }}",
                      "rightValue": "https://mecanicapesada.top/",
                      "operator": {
                        "type": "string",
                        "operation": "contains"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Meca pesada"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "933ffc16-ac72-4e54-ad3b-19da3ffeceea",
                      "leftValue": "={{ $('Webhook').item.json.body.referrer }}",
                      "rightValue": "https://allpol.com.ar/",
                      "operator": {
                        "type": "string",
                        "operation": "contains"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Allpol"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "4f429151-5941-4228-ad42-ba5e3fa19ebc",
                      "leftValue": "={{ $('Webhook').item.json.body.referrer }}",
                      "rightValue": "https://cr-sites.com/bolsas-maceta/",
                      "operator": {
                        "type": "string",
                        "operation": "contains"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Bolsas Maceta"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "9334526e-7727-421d-aa5a-f6d8d3492040",
                      "leftValue": "={{ $('Webhook').item.json.body.referrer }}",
                      "rightValue": "https://laplata.camarasseguridad.net/",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Cámaras LP"
              }
            ]
          },
          "options": {
            "fallbackOutput": "none"
          }
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          144,
          1024
        ],
        "id": "d5955acd-6a28-47f9-8abe-e061836a02f7",
        "name": "Switch"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "1FdSsi95qgMzvCJ8N10-jloPiTJuCFF5_ZDPwVihQ69I",
            "mode": "list",
            "cachedResultName": "Leads Allpol",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FdSsi95qgMzvCJ8N10-jloPiTJuCFF5_ZDPwVihQ69I/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Hoja 1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FdSsi95qgMzvCJ8N10-jloPiTJuCFF5_ZDPwVihQ69I/edit#gid=0"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "ingreso": "={{ $json[\"currentDate-ARG\"] }}",
              "nombre": "={{ $('Webhook').item.json.body.nombre }}",
              "telefono": "={{ $('Webhook').item.json.body[\"Número de WhatsApp\"] }}",
              "producto": "={{ $('Webhook').item.json.body.mensaje }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "ingreso",
                "displayName": "ingreso",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "nombre",
                "displayName": "nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "telefono",
                "displayName": "telefono",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "producto",
                "displayName": "producto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.6,
        "position": [
          592,
          1168
        ],
        "id": "c5aa7fad-d608-43ce-a702-19b76c3f8525",
        "name": "Agrega contacos de la web a Leads Allpol",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "XCVUrxXJwWv4s45E",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "inputText": "={{ $('Webhook').item.json.body.mensaje }}",
          "categories": {
            "categories": [
              {
                "category": "lead",
                "description": "Dinero entrante, solicitudes relacionadas a servicios o productos,cotizacion, instalacion o reparacion. Todo lo que sea un lead para nosotros."
              },
              {
                "category": "otros",
                "description": "Solicitudes de empleo u ofrecimientos de cv.\nOfrecimiento de servicios o productos por parte de proveedores, personas o empresas que quieran vendernos algo."
              }
            ]
          },
          "options": {
            "fallback": "discard"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.textClassifier",
        "typeVersion": 1.1,
        "position": [
          -1248,
          1376
        ],
        "id": "945a89e4-3a1d-45f7-8ddf-66db4d7041d8",
        "name": "Text Classifier"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatDeepSeek",
        "typeVersion": 1,
        "position": [
          -1248,
          1584
        ],
        "id": "bb3fb79c-e121-4d11-9fb8-293adef89baf",
        "name": "DeepSeek Chat Model",
        "credentials": {
          "deepSeekApi": {
            "id": "l9T4qmBFqTej3Qxo",
            "name": "DeepSeek account"
          }
        }
      },
      {
        "parameters": {
          "outputFieldName": "currentDate-CR",
          "options": {
            "timezone": "America/Costa_Rica"
          }
        },
        "type": "n8n-nodes-base.dateTime",
        "typeVersion": 2,
        "position": [
          368,
          784
        ],
        "id": "59a3933d-1513-4372-928e-f0531b6c4593",
        "name": "Costa Rica"
      },
      {
        "parameters": {
          "outputFieldName": "currentDate-ARG",
          "options": {
            "timezone": "America/Buenos_Aires"
          }
        },
        "type": "n8n-nodes-base.dateTime",
        "typeVersion": 2,
        "position": [
          368,
          1168
        ],
        "id": "50bcf71f-401f-469d-862a-bd291b9b9ec3",
        "name": "Argentina"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "triggerAtHour": 6
              }
            ]
          }
        },
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          -1936,
          848
        ],
        "id": "304e4c03-f547-4db7-96da-607b53215b61",
        "name": "Schedule Trigger"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "d7c31bf0-ee99-4f20-b84a-10ca0bdd1407"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "1"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "137bfc40-aa1b-4d81-a3ab-e80de79b57fc",
                      "leftValue": "",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "2"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "6f2ba0e7-86e2-48f4-9fda-b79e6356e2f1",
                      "leftValue": "",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "3"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "3679acc8-fda4-495d-ab14-c8de55b0a049",
                      "leftValue": "",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "4"
              }
            ]
          },
          "options": {
            "allMatchingOutputs": true
          }
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          -1712,
          816
        ],
        "id": "1a3cccd5-c6b1-4b8f-a4c1-0fcd082d32e6",
        "name": "Switch1"
      },
      {
        "parameters": {
          "operation": "restart-instance",
          "instanceName": "evolutionapi"
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          -1488,
          752
        ],
        "id": "077ea19c-7262-4887-b5d5-01df6ca3305b",
        "name": "Malco CR",
        "credentials": {
          "evolutionApi": {
            "id": "lgR3M6buNvrwBzQ0",
            "name": "Evolution 50662292932 - Malco CR"
          }
        }
      },
      {
        "parameters": {
          "operation": "restart-instance",
          "instanceName": "Smart CR"
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          -1488,
          560
        ],
        "id": "9dd76b25-cfcd-49ad-bb58-06b11e3201f4",
        "name": "Smart CR",
        "credentials": {
          "evolutionApi": {
            "id": "zEeNcZfyeYVosz78",
            "name": "Smart CR"
          }
        }
      },
      {
        "parameters": {
          "operation": "restart-instance",
          "instanceName": "Allpol"
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          -1488,
          944
        ],
        "id": "7d844b9f-669c-41c3-8801-0874b345b592",
        "name": "Allpol",
        "credentials": {
          "evolutionApi": {
            "id": "BcKApPoAEmD2PL5m",
            "name": "wsp Allpol - 221 6925658"
          }
        }
      },
      {
        "parameters": {
          "outputFieldName": "currentDate-ARG",
          "options": {
            "timezone": "America/Buenos_Aires"
          }
        },
        "type": "n8n-nodes-base.dateTime",
        "typeVersion": 2,
        "position": [
          368,
          976
        ],
        "id": "78608835-bf87-4c16-9eff-0d6fff96a007",
        "name": "Argentina2"
      },
      {
        "parameters": {
          "outputFieldName": "currentDate-ARG",
          "options": {
            "timezone": "America/Buenos_Aires"
          }
        },
        "type": "n8n-nodes-base.dateTime",
        "typeVersion": 2,
        "position": [
          368,
          1360
        ],
        "id": "f738fdf7-cf1c-4b36-a3e2-d40e8f2cc40e",
        "name": "Argentina1"
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "Malco ARG",
          "remoteJid": "5492215548877",
          "messageText": "=Alejandro buenas, entro un mensaje de la pagina, si no te escribió le podes escribir vos, acá te dejo los datos:\n\n{{ $('Webhook').item.json.body.referrer }}\nSolicitud de contacto:\nfecha/hs: {{ $('Webhook').item.json.body.sentDateUTC }}\nnombre: {{ $('Webhook').item.json.body.Nombre }}\ntel: {{ $('Webhook').item.json.body['Número de WhatsApp'] }}\nmensaje: {{ $('Webhook').item.json.body.mensaje }}",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          -2592,
          2896
        ],
        "id": "92684be8-29fe-44f7-8a8c-f91f4315dc40",
        "name": "Alejandro",
        "credentials": {
          "evolutionApi": {
            "id": "uFLlpp0hjQkOnZnJ",
            "name": "Evolution 5492216115728 - Malco ARG"
          }
        }
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "Malco ARG",
          "remoteJid": "5492213184300",
          "messageText": "=Mati buenas, entro un mensaje de la pagina, si no te escribió le podes escribir vos, acá te dejo los datos:\n\n{{ $('Webhook').item.json.body.referrer }}\nSolicitud de contacto:\nfecha/hs: {{ $('Webhook').item.json.body.sentDateUTC }}\nnombre: {{ $('Webhook').item.json.body.Nombre }}\ntel: {{ $('Webhook').item.json.body['Número de WhatsApp'] }}\nmensaje: {{ $('Webhook').item.json.body.mensaje }}",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          -2592,
          2448
        ],
        "id": "41570900-1c48-46a4-80d7-a30059f58bf8",
        "name": "Matias",
        "credentials": {
          "evolutionApi": {
            "id": "uFLlpp0hjQkOnZnJ",
            "name": "Evolution 5492216115728 - Malco ARG"
          }
        }
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "1HU_G0Hy4IX3GuNccFU1Q-P1rUjeOVNd3XKr7e4FGSHk",
            "mode": "list",
            "cachedResultName": "Base de Datos - Leads",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HU_G0Hy4IX3GuNccFU1Q-P1rUjeOVNd3XKr7e4FGSHk/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1755573248,
            "mode": "list",
            "cachedResultName": "leads",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HU_G0Hy4IX3GuNccFU1Q-P1rUjeOVNd3XKr7e4FGSHk/edit#gid=1755573248"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [
              {
                "id": "timestamp",
                "displayName": "timestamp",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "lead_id",
                "displayName": "lead_id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "client_name",
                "displayName": "client_name",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "client_phone",
                "displayName": "client_phone",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "client_location",
                "displayName": "client_location",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "service_details",
                "displayName": "service_details",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "lead_source",
                "displayName": "lead_source",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "professional_id",
                "displayName": "professional_id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "price_per_lead",
                "displayName": "price_per_lead",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "currency_code",
                "displayName": "currency_code",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "status",
                "displayName": "status",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "notified_timestamp",
                "displayName": "notified_timestamp",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "weekly_summary_id",
                "displayName": "weekly_summary_id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.6,
        "position": [
          592,
          784
        ],
        "id": "b3bd1eb5-eca4-4d06-ace0-03fccbe6dca1",
        "name": "Append row in sheet",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "XCVUrxXJwWv4s45E",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "edf444ee-1b8d-4cb7-930e-42fabc24d557",
                "name": "client_name",
                "value": "={{ $json.body.nombre }}",
                "type": "string"
              },
              {
                "id": "853fffdc-e7b7-4379-9c54-ed218f8e6850",
                "name": "client_phone",
                "value": "={{ $json.body.tel }}",
                "type": "string"
              },
              {
                "id": "d0170f01-7548-4755-98d1-f70f3948d7a4",
                "name": "service_details",
                "value": "={{ $json.body.serv }}",
                "type": "string"
              },
              {
                "id": "7a69fec7-af59-4e5c-a985-97aea15601e3",
                "name": "lead_source",
                "value": "={{ $json.body.referrerArrival }}",
                "type": "string"
              },
              {
                "id": "97d463d6-b45a-4c35-aee2-bb06cbe202bc",
                "name": "professional_whatsapp",
                "value": "={{ $('Webhook').item.json.body.phoneAgent }}",
                "type": "string"
              },
              {
                "id": "887d5af4-c7e2-4389-aee5-9245499d6ae2",
                "name": "timestamp",
                "value": "={{ DateTime.now().setZone('America/Costa_Rica').toFormat('yyyy-MM-dd HH:mm:ss') }}",
                "type": "string"
              },
              {
                "id": "9162b23f-bdf3-4e3e-b040-d36c2f61cb69",
                "name": "ubicacion",
                "value": "={{ $json.body.ubi }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -1680,
          1376
        ],
        "id": "1b4c1ea5-ab30-4cec-927b-482d64448191",
        "name": "Edit Fields"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "9cbab708-bf85-4f1b-a591-b63303f36b0e",
                "leftValue": "={{ $json.daily_prompt_id }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -464,
          1360
        ],
        "id": "7ded00a4-a7c3-4f67-8940-d4241b06f609",
        "name": "If"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          -1552,
          2144
        ],
        "id": "99b1e00a-f9b8-4562-9e11-48f2c8d65738",
        "name": "Loop Over Items"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Leads a notificar en concordancia ordinal: {{ $json.client_name }} - {{ $json.client_phone }} - {{ $json.service_details }} - {{ $json.timestamp }}",
          "options": {
            "systemMessage": "={{ $('Loop Over Items').item.json.daily_prompt_id }}"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 2.2,
        "position": [
          -656,
          1904
        ],
        "id": "c04e9dc5-d584-4c12-bf43-0a2cac1f829b",
        "name": "AI Agent"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "30ef8bd3-c0e8-41ab-877a-c520f8aa3763",
                "leftValue": "={{ $json.client_name }}",
                "rightValue": "",
                "operator": {
                  "type": "array",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "looseTypeValidation": "={{ false }}",
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -880,
          1904
        ],
        "id": "b77af841-3214-4f61-a29f-7bac5c5023e5",
        "name": "If1"
      },
      {
        "parameters": {
          "fieldsToAggregate": {
            "fieldToAggregate": [
              {
                "fieldToAggregate": "client_name"
              },
              {
                "fieldToAggregate": "client_phone"
              },
              {
                "fieldToAggregate": "service_details"
              },
              {
                "fieldToAggregate": "timestamp"
              }
            ]
          },
          "options": {
            "mergeLists": true
          }
        },
        "type": "n8n-nodes-base.aggregate",
        "typeVersion": 1,
        "position": [
          -1104,
          1904
        ],
        "id": "cdac17f2-d509-42e9-8538-7d78feb0cef3",
        "name": "Aggregate"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "triggerAtHour": 17,
                "triggerAtMinute": 7
              }
            ]
          }
        },
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          -2000,
          2240
        ],
        "id": "fdaef204-c7c0-4a96-b763-2f4e5f40158d",
        "name": "Diario"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3.2,
        "position": [
          -80,
          2160
        ],
        "id": "4b034838-2ae8-499c-942e-cc49bb12cf0a",
        "name": "Merge"
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "evolutionapi",
          "remoteJid": "50662292932",
          "messageText": "={{ $json.output }}",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          -2592,
          2672
        ],
        "id": "74c0467c-c5c4-42e9-aa44-a9383239f401",
        "name": "A mi los descartados1",
        "credentials": {
          "evolutionApi": {
            "id": "lgR3M6buNvrwBzQ0",
            "name": "Evolution 50662292932 - Malco CR"
          }
        }
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "evolutionapi",
          "remoteJid": "=5492216115728",
          "messageText": "={{ $json.output }}",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          -304,
          1904
        ],
        "id": "febf77e0-4a30-4e42-b39f-751438a136cd",
        "name": "A mi de prueba",
        "credentials": {
          "evolutionApi": {
            "id": "lgR3M6buNvrwBzQ0",
            "name": "Evolution 50662292932 - Malco CR"
          }
        }
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{ $('Loop Over Items').item.json.whatsapp_number }}",
          "contextWindowLength": 7
        },
        "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "typeVersion": 1.3,
        "position": [
          -560,
          2064
        ],
        "id": "050f08bf-2b3c-4324-85c6-9e2843e8cda1",
        "name": "Simple Memory"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "claude-3-7-sonnet-20250219",
            "mode": "list",
            "cachedResultName": "Claude Sonnet 3.7"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
        "typeVersion": 1.3,
        "position": [
          -736,
          2064
        ],
        "id": "2be5222d-c7c9-4d58-a05d-5e3d97cd4d4a",
        "name": "Anthropic Chat Model",
        "credentials": {
          "anthropicApi": {
            "id": "KvZF7MNs1iI9NLKB",
            "name": "Anthropic account"
          }
        }
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "evolutionapi",
          "remoteJid": "542216115728",
          "messageText": "Hubo un fallo en la coneccion de N8N con Google",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          -1552,
          2336
        ],
        "id": "09a70a8d-0411-4045-9a83-93cda4bb86df",
        "name": "Enviar texto",
        "credentials": {
          "evolutionApi": {
            "id": "lgR3M6buNvrwBzQ0",
            "name": "Evolution 50662292932 - Malco CR"
          }
        }
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "evolutionapi",
          "remoteJid": "542216115728",
          "messageText": "Hubo un fallo en la coneccion de N8N con Google",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          -592,
          1568
        ],
        "id": "38649981-33c0-4099-9a16-fef5982d3613",
        "name": "Enviar texto1",
        "credentials": {
          "evolutionApi": {
            "id": "lgR3M6buNvrwBzQ0",
            "name": "Evolution 50662292932 - Malco CR"
          }
        }
      },
      {
        "parameters": {
          "operation": "search",
          "base": {
            "__rl": true,
            "value": "appuqvJKOHdjlI6Np",
            "mode": "list",
            "cachedResultName": "Profesionales",
            "cachedResultUrl": "https://airtable.com/appuqvJKOHdjlI6Np"
          },
          "table": {
            "__rl": true,
            "value": "tblowzUNVeV8gYJZq",
            "mode": "list",
            "cachedResultName": "hoja1",
            "cachedResultUrl": "https://airtable.com/appuqvJKOHdjlI6Np/tblowzUNVeV8gYJZq"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.airtable",
        "typeVersion": 2.1,
        "position": [
          -1776,
          2240
        ],
        "id": "a1c5d1a4-70ec-4b40-a29b-2babdda2ac4c",
        "name": "Lista profesionales",
        "credentials": {
          "airtableTokenApi": {
            "id": "2zDfs1ZY0VzfVfyg",
            "name": "Airtable Personal Access Token account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "operation": "search",
          "base": {
            "__rl": true,
            "value": "app8jff881WWUr8Sl",
            "mode": "list",
            "cachedResultName": "Base de Datos - Leads",
            "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl"
          },
          "table": {
            "__rl": true,
            "value": "tblCq162vKS035OZf",
            "mode": "list",
            "cachedResultName": "leads",
            "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl/tblCq162vKS035OZf"
          },
          "filterByFormula": "=AND({professional_id} = '{{ $json.whatsapp_number }}', {status} = 'sin-notificar')",
          "returnAll": false,
          "options": {}
        },
        "type": "n8n-nodes-base.airtable",
        "typeVersion": 2.1,
        "position": [
          -1296,
          2160
        ],
        "id": "47fd2f1f-4efd-46ce-80d1-7ca822493e88",
        "name": "Leads sin notificar",
        "credentials": {
          "airtableTokenApi": {
            "id": "2zDfs1ZY0VzfVfyg",
            "name": "Airtable Personal Access Token account"
          }
        }
      },
      {
        "parameters": {
          "operation": "upsert",
          "base": {
            "__rl": true,
            "value": "app8jff881WWUr8Sl",
            "mode": "list",
            "cachedResultName": "Base de Datos - Leads",
            "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl"
          },
          "table": {
            "__rl": true,
            "value": "tblCq162vKS035OZf",
            "mode": "list",
            "cachedResultName": "leads",
            "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl/tblCq162vKS035OZf"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "client_phone": "={{ $json.client_phone }}",
              "status": "notificado",
              "notified_timestamp": "={{new Date().toLocaleDateString()}}"
            },
            "matchingColumns": [
              "client_phone"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "readOnly": true,
                "removed": false
              },
              {
                "id": "timestamp",
                "displayName": "timestamp",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "client_name",
                "displayName": "client_name",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "client_phone",
                "displayName": "client_phone",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "client_location",
                "displayName": "client_location",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "service_details",
                "displayName": "service_details",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "lead_source",
                "displayName": "lead_source",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "De qué página o campaña vino el lead.",
                    "value": "De qué página o campaña vino el lead."
                  },
                  {
                    "name": "camarasseguridad.net",
                    "value": "camarasseguridad.net"
                  },
                  {
                    "name": "https://services.tochat.be/es/app/whatsapp/1b7894f5-baf9-4fb6-bb30-2fc621360617/edit",
                    "value": "https://services.tochat.be/es/app/whatsapp/1b7894f5-baf9-4fb6-bb30-2fc621360617/edit"
                  },
                  {
                    "name": "https://services.tochat.be/es/app/whatsapp/form/whatsapp-form/1b7894f5-baf9-4fb6-bb30-2fc621360617",
                    "value": "https://services.tochat.be/es/app/whatsapp/form/whatsapp-form/1b7894f5-baf9-4fb6-bb30-2fc621360617"
                  },
                  {
                    "name": "https://camarasseguridad.net/",
                    "value": "https://camarasseguridad.net/"
                  },
                  {
                    "name": "https://laplata.camarasseguridad.net/",
                    "value": "https://laplata.camarasseguridad.net/"
                  },
                  {
                    "name": "https://camarasseguridad.net/#servicios",
                    "value": "https://camarasseguridad.net/#servicios"
                  },
                  {
                    "name": "FALSE",
                    "value": "FALSE"
                  },
                  {
                    "name": "https://camarasseguridad.net/#formulario",
                    "value": "https://camarasseguridad.net/#formulario"
                  },
                  {
                    "name": "https://camarasseguridad.net/costa-rica/alajuela/",
                    "value": "https://camarasseguridad.net/costa-rica/alajuela/"
                  },
                  {
                    "name": "https://camarasseguridad.net/?utm_source=google&utm_medium=organic&utm_content=main_button&utm_campaign=gmb",
                    "value": "https://camarasseguridad.net/?utm_source=google&utm_medium=organic&utm_content=main_button&utm_campaign=gmb"
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "professional_id",
                "displayName": "professional_id",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "Identificador único del profesional asignado.",
                    "value": "Identificador único del profesional asignado."
                  },
                  {
                    "name": "50660742444",
                    "value": "50660742444"
                  },
                  {
                    "name": "542215548877",
                    "value": "542215548877"
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "price_per_lead",
                "displayName": "price_per_lead",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "Costo acordado por este lead específico.",
                    "value": "Costo acordado por este lead específico."
                  },
                  {
                    "name": "2000",
                    "value": "2000"
                  },
                  {
                    "name": "5000",
                    "value": "5000"
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "currency_code",
                "displayName": "currency_code",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "Código de la moneda para el cobro.",
                    "value": "Código de la moneda para el cobro."
                  },
                  {
                    "name": "CRC (Colones), ARS (Pesos)",
                    "value": "CRC (Colones), ARS (Pesos)"
                  },
                  {
                    "name": "CRC",
                    "value": "CRC"
                  },
                  {
                    "name": "ARS",
                    "value": "ARS"
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "status",
                "displayName": "status",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "Estado del lead en el flujo de n8n.",
                    "value": "Estado del lead en el flujo de n8n."
                  },
                  {
                    "name": "notificado",
                    "value": "notificado"
                  },
                  {
                    "name": "sin-notificar",
                    "value": "sin-notificar"
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "notified_timestamp",
                "displayName": "notified_timestamp",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "weekly_summary_id",
                "displayName": "weekly_summary_id",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.airtable",
        "typeVersion": 2.1,
        "position": [
          -336,
          2176
        ],
        "id": "1bc8d79c-99be-4852-a1f2-9a903d59649c",
        "name": "cambia a notificado",
        "credentials": {
          "airtableTokenApi": {
            "id": "2zDfs1ZY0VzfVfyg",
            "name": "Airtable Personal Access Token account"
          }
        }
      },
      {
        "parameters": {
          "operation": "create",
          "base": {
            "__rl": true,
            "value": "app8jff881WWUr8Sl",
            "mode": "list",
            "cachedResultName": "Base de Datos - Leads",
            "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl"
          },
          "table": {
            "__rl": true,
            "value": "tblCq162vKS035OZf",
            "mode": "list",
            "cachedResultName": "leads",
            "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl/tblCq162vKS035OZf"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "timestamp": "={{ $('Edit Fields').item.json.timestamp }}",
              "client_name": "={{ $('Edit Fields').item.json.client_name }}",
              "client_phone": "={{ $('Edit Fields').item.json.client_phone }}",
              "client_location": "={{ $('Edit Fields').item.json.ubicacion }}",
              "service_details": "={{ $('Edit Fields').item.json.service_details }}",
              "lead_source": "={{ $('Edit Fields').item.json.lead_source }}",
              "professional_id": "={{ $('Edit Fields').item.json.professional_whatsapp }}",
              "price_per_lead": "={{ $('Busca profesional').item.json.price_per_lead }}",
              "status": "=sin-notificar",
              "currency_code": "={{ $('Busca profesional').item.json.currency_code }}",
              "notified_timestamp": "={{ $now }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "timestamp",
                "displayName": "timestamp",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "client_name",
                "displayName": "client_name",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "client_phone",
                "displayName": "client_phone",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "client_location",
                "displayName": "client_location",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "service_details",
                "displayName": "service_details",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "lead_source",
                "displayName": "lead_source",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "professional_id",
                "displayName": "professional_id",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "price_per_lead",
                "displayName": "price_per_lead",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "Costo acordado por este lead específico.",
                    "value": "Costo acordado por este lead específico."
                  },
                  {
                    "name": "2000",
                    "value": "2000"
                  },
                  {
                    "name": "5000",
                    "value": "5000"
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "currency_code",
                "displayName": "currency_code",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "Código de la moneda para el cobro.",
                    "value": "Código de la moneda para el cobro."
                  },
                  {
                    "name": "CRC (Colones), ARS (Pesos)",
                    "value": "CRC (Colones), ARS (Pesos)"
                  },
                  {
                    "name": "CRC",
                    "value": "CRC"
                  },
                  {
                    "name": "ARS",
                    "value": "ARS"
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "status",
                "displayName": "status",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "Estado del lead en el flujo de n8n.",
                    "value": "Estado del lead en el flujo de n8n."
                  },
                  {
                    "name": "notificado",
                    "value": "notificado"
                  },
                  {
                    "name": "sin-notificar",
                    "value": "sin-notificar"
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "notified_timestamp",
                "displayName": "notified_timestamp",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "weekly_summary_id",
                "displayName": "weekly_summary_id",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.airtable",
        "typeVersion": 2.1,
        "position": [
          256,
          1520
        ],
        "id": "c7eecea6-4f63-4a17-a02b-fb7680e559f5",
        "name": "Create a record",
        "credentials": {
          "airtableTokenApi": {
            "id": "2zDfs1ZY0VzfVfyg",
            "name": "Airtable Personal Access Token account"
          }
        }
      },
      {
        "parameters": {
          "operation": "search",
          "base": {
            "__rl": true,
            "value": "appuqvJKOHdjlI6Np",
            "mode": "list",
            "cachedResultName": "Profesionales",
            "cachedResultUrl": "https://airtable.com/appuqvJKOHdjlI6Np"
          },
          "table": {
            "__rl": true,
            "value": "tblowzUNVeV8gYJZq",
            "mode": "list",
            "cachedResultName": "hoja1",
            "cachedResultUrl": "https://airtable.com/appuqvJKOHdjlI6Np/tblowzUNVeV8gYJZq"
          },
          "filterByFormula": "=AND({whatsapp_number} = {{$json.professional_whatsapp}}, {activo?} = 'si')",
          "options": {
            "fields": [
              "daily_prompt_id",
              "price_per_lead",
              "currency_code"
            ]
          }
        },
        "type": "n8n-nodes-base.airtable",
        "typeVersion": 2.1,
        "position": [
          -896,
          1360
        ],
        "id": "49aa9822-2b8c-4a0c-95b9-b6a23419cf02",
        "name": "Busca profesional",
        "alwaysOutputData": false,
        "credentials": {
          "airtableTokenApi": {
            "id": "2zDfs1ZY0VzfVfyg",
            "name": "Airtable Personal Access Token account"
          }
        }
      },
      {
        "parameters": {
          "operation": "search",
          "base": {
            "__rl": true,
            "value": "app8jff881WWUr8Sl",
            "mode": "list",
            "cachedResultName": "Base de Datos - Leads",
            "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl"
          },
          "table": {
            "__rl": true,
            "value": "tblCq162vKS035OZf",
            "mode": "list",
            "cachedResultName": "leads",
            "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl/tblCq162vKS035OZf"
          },
          "filterByFormula": "=AND(\n  {client_phone} = '{{ $('Edit Fields').item.json.client_phone }}',\n  OR(\n    IS_SAME(DATETIME_PARSE({timestamp}, 'YYYY-MM-DD HH:mm:ss'), TODAY(), 'day'),\n    IS_SAME(DATETIME_PARSE({timestamp}, 'YYYY-MM-DD HH:mm:ss'), DATEADD(TODAY(), -1, 'days'), 'day')\n  )\n)",
          "returnAll": false,
          "limit": 5,
          "options": {}
        },
        "type": "n8n-nodes-base.airtable",
        "typeVersion": 2.1,
        "position": [
          -208,
          1328
        ],
        "id": "9859c7ed-a6c9-4fa6-b3b8-ee783e3d8cfd",
        "name": "Busca Lead en registros",
        "alwaysOutputData": true,
        "credentials": {
          "airtableTokenApi": {
            "id": "2zDfs1ZY0VzfVfyg",
            "name": "Airtable Personal Access Token account"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "ff57a4ac-c416-47e4-b5b0-d79238e55b60",
                "leftValue": "={{ $json.id }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "empty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          16,
          1408
        ],
        "id": "439c1ac1-f456-45de-b7df-15e321cba636",
        "name": "Es Lead unico?",
        "alwaysOutputData": false
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "18e9ae0c-d9f0-4b48-813b-654e791d54ec",
                "leftValue": "={{ $('Webhook').item.json.body.mensaje }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "notExists",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -1456,
          1216
        ],
        "id": "ff11c8f7-6952-4148-a38b-c9aa9c61c073",
        "name": "If2"
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "evolutionapi",
          "remoteJid": "={{ $('Edit Fields').item.json.professional_whatsapp }}",
          "messageText": "=Nuevo cliente recibido {{ $now.setLocale('es-CR').format(\"dd LLL yyyy '- 'HH:mm a\") }}\n\nnombre: {{ $('Edit Fields').item.json.client_name }}\ntel: {{ $('Edit Fields').item.json.client_phone }}\nubicación: {{ $('Edit Fields').item.json.ubicacion }}",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          624,
          1600
        ],
        "id": "a4f1d615-9909-4d2a-8922-4709596c4566",
        "name": "Mensaje a Profesional",
        "credentials": {
          "evolutionApi": {
            "id": "lgR3M6buNvrwBzQ0",
            "name": "Evolution 50662292932 - Malco CR"
          }
        }
      }
    ],
    "connections": {
      "Webhook": {
        "main": [
          [
            {
              "node": "Edit Fields",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Costa Rica",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Argentina2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Argentina",
              "type": "main",
              "index": 0
            }
          ],
          [],
          [
            {
              "node": "Argentina1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Text Classifier": {
        "main": [
          [
            {
              "node": "Busca profesional",
              "type": "main",
              "index": 0
            }
          ],
          [],
          []
        ]
      },
      "DeepSeek Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Text Classifier",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Costa Rica": {
        "main": [
          [
            {
              "node": "Append row in sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Argentina": {
        "main": [
          [
            {
              "node": "Agrega contacos de la web a Leads Allpol",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Schedule Trigger": {
        "main": [
          [
            {
              "node": "Switch1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch1": {
        "main": [
          [
            {
              "node": "Smart CR",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Malco CR",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Allpol",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Argentina2": {
        "main": [
          []
        ]
      },
      "Argentina1": {
        "main": [
          []
        ]
      },
      "Alejandro": {
        "main": [
          []
        ]
      },
      "Agrega contacos de la web a Leads Allpol": {
        "main": [
          []
        ]
      },
      "Append row in sheet": {
        "main": [
          []
        ]
      },
      "Edit Fields": {
        "main": [
          [
            {
              "node": "If2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If": {
        "main": [
          [
            {
              "node": "Busca Lead en registros",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items": {
        "main": [
          [],
          [
            {
              "node": "Leads sin notificar",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent": {
        "main": [
          [
            {
              "node": "A mi de prueba",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If1": {
        "main": [
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate": {
        "main": [
          [
            {
              "node": "If1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Diario": {
        "main": [
          [
            {
              "node": "Lista profesionales",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "A mi de prueba": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Simple Memory": {
        "ai_memory": [
          [
            {
              "node": "AI Agent",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Anthropic Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Lista profesionales": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Enviar texto",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Leads sin notificar": {
        "main": [
          [
            {
              "node": "Aggregate",
              "type": "main",
              "index": 0
            },
            {
              "node": "cambia a notificado",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "cambia a notificado": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Create a record": {
        "main": [
          [
            {
              "node": "Mensaje a Profesional",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Busca profesional": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Busca Lead en registros": {
        "main": [
          [
            {
              "node": "Es Lead unico?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Es Lead unico?": {
        "main": [
          [
            {
              "node": "Create a record",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If2": {
        "main": [
          [
            {
              "node": "Busca profesional",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Text Classifier",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1",
      "availableInMCP": true
    },
    "staticData": {
      "node:Schedule Trigger": {
        "recurrenceRules": []
      },
      "node:Schedule Trigger1": {
        "recurrenceRules": []
      },
      "node:Diario": {
        "recurrenceRules": []
      }
    },
    "meta": {
      "templateCredsSetupCompleted": true
    },
    "pinData": {
      "Switch": [],
      "Diario": [
        {
          "json": {
            "timestamp": "2025-11-15T17:07:25.024-05:00",
            "Readable date": "November 15th 2025, 5:07:25 pm",
            "Readable time": "5:07:25 pm",
            "Day of week": "Saturday",
            "Year": "2025",
            "Month": "November",
            "Day of month": "15",
            "Hour": "17",
            "Minute": "07",
            "Second": "25",
            "Timezone": "America/New_York (UTC-05:00)"
          }
        }
      ],
      "Schedule Trigger": [
        {
          "json": {
            "timestamp": "2025-11-21T06:00:19.049-05:00",
            "Readable date": "November 21st 2025, 6:00:19 am",
            "Readable time": "6:00:19 am",
            "Day of week": "Friday",
            "Year": "2025",
            "Month": "November",
            "Day of month": "21",
            "Hour": "06",
            "Minute": "00",
            "Second": "19",
            "Timezone": "America/New_York (UTC-05:00)"
          }
        }
      ]
    },
    "versionId": "b59d032a-11de-4923-93e8-768ab1122bfb",
    "activeVersionId": "b59d032a-11de-4923-93e8-768ab1122bfb",
    "triggerCount": 3,
    "shared": [
      {
        "updatedAt": "2025-06-20T01:04:28.477Z",
        "createdAt": "2025-06-20T01:04:28.477Z",
        "role": "workflow:owner",
        "workflowId": "3vZyObH9koXfTnp8",
        "projectId": "CyuOAJo56zhDqPtw"
      }
    ],
    "activeVersion": {
      "updatedAt": "2025-12-08T18:55:49.326Z",
      "createdAt": "2025-12-08T18:55:49.326Z",
      "versionId": "b59d032a-11de-4923-93e8-768ab1122bfb",
      "workflowId": "3vZyObH9koXfTnp8",
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "leads",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2,
          "position": [
            -1904,
            1376
          ],
          "id": "d0908e51-97fa-42bd-85d0-1553a8b1808e",
          "name": "Webhook",
          "webhookId": "a3414e97-f942-4938-a579-02cbf2d4bf12"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('Webhook').item.json.body.referrer }}",
                        "rightValue": "https://camarasseguridad.net/",
                        "operator": {
                          "type": "string",
                          "operation": "contains"
                        },
                        "id": "8f3859ea-ae2e-4b73-994a-50b8a7abddf1"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "camaras CR"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "5aa0ed40-7430-4dbc-a76b-89dee516d122",
                        "leftValue": "={{ $('Webhook').item.json.body.referrer }}",
                        "rightValue": "https://mecanicapesada.top/",
                        "operator": {
                          "type": "string",
                          "operation": "contains"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Meca pesada"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "933ffc16-ac72-4e54-ad3b-19da3ffeceea",
                        "leftValue": "={{ $('Webhook').item.json.body.referrer }}",
                        "rightValue": "https://allpol.com.ar/",
                        "operator": {
                          "type": "string",
                          "operation": "contains"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Allpol"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "4f429151-5941-4228-ad42-ba5e3fa19ebc",
                        "leftValue": "={{ $('Webhook').item.json.body.referrer }}",
                        "rightValue": "https://cr-sites.com/bolsas-maceta/",
                        "operator": {
                          "type": "string",
                          "operation": "contains"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Bolsas Maceta"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "9334526e-7727-421d-aa5a-f6d8d3492040",
                        "leftValue": "={{ $('Webhook').item.json.body.referrer }}",
                        "rightValue": "https://laplata.camarasseguridad.net/",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Cámaras LP"
                }
              ]
            },
            "options": {
              "fallbackOutput": "none"
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            144,
            1024
          ],
          "id": "d5955acd-6a28-47f9-8abe-e061836a02f7",
          "name": "Switch"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1FdSsi95qgMzvCJ8N10-jloPiTJuCFF5_ZDPwVihQ69I",
              "mode": "list",
              "cachedResultName": "Leads Allpol",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FdSsi95qgMzvCJ8N10-jloPiTJuCFF5_ZDPwVihQ69I/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Hoja 1",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FdSsi95qgMzvCJ8N10-jloPiTJuCFF5_ZDPwVihQ69I/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "ingreso": "={{ $json[\"currentDate-ARG\"] }}",
                "nombre": "={{ $('Webhook').item.json.body.nombre }}",
                "telefono": "={{ $('Webhook').item.json.body[\"Número de WhatsApp\"] }}",
                "producto": "={{ $('Webhook').item.json.body.mensaje }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "ingreso",
                  "displayName": "ingreso",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "nombre",
                  "displayName": "nombre",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "telefono",
                  "displayName": "telefono",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "producto",
                  "displayName": "producto",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            592,
            1168
          ],
          "id": "c5aa7fad-d608-43ce-a702-19b76c3f8525",
          "name": "Agrega contacos de la web a Leads Allpol",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "XCVUrxXJwWv4s45E",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "inputText": "={{ $('Webhook').item.json.body.mensaje }}",
            "categories": {
              "categories": [
                {
                  "category": "lead",
                  "description": "Dinero entrante, solicitudes relacionadas a servicios o productos,cotizacion, instalacion o reparacion. Todo lo que sea un lead para nosotros."
                },
                {
                  "category": "otros",
                  "description": "Solicitudes de empleo u ofrecimientos de cv.\nOfrecimiento de servicios o productos por parte de proveedores, personas o empresas que quieran vendernos algo."
                }
              ]
            },
            "options": {
              "fallback": "discard"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.textClassifier",
          "typeVersion": 1.1,
          "position": [
            -1248,
            1376
          ],
          "id": "945a89e4-3a1d-45f7-8ddf-66db4d7041d8",
          "name": "Text Classifier"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatDeepSeek",
          "typeVersion": 1,
          "position": [
            -1248,
            1584
          ],
          "id": "bb3fb79c-e121-4d11-9fb8-293adef89baf",
          "name": "DeepSeek Chat Model",
          "credentials": {
            "deepSeekApi": {
              "id": "l9T4qmBFqTej3Qxo",
              "name": "DeepSeek account"
            }
          }
        },
        {
          "parameters": {
            "outputFieldName": "currentDate-CR",
            "options": {
              "timezone": "America/Costa_Rica"
            }
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            368,
            784
          ],
          "id": "59a3933d-1513-4372-928e-f0531b6c4593",
          "name": "Costa Rica"
        },
        {
          "parameters": {
            "outputFieldName": "currentDate-ARG",
            "options": {
              "timezone": "America/Buenos_Aires"
            }
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            368,
            1168
          ],
          "id": "50bcf71f-401f-469d-862a-bd291b9b9ec3",
          "name": "Argentina"
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "triggerAtHour": 6
                }
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.2,
          "position": [
            -1936,
            848
          ],
          "id": "304e4c03-f547-4db7-96da-607b53215b61",
          "name": "Schedule Trigger"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "",
                        "rightValue": "",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "d7c31bf0-ee99-4f20-b84a-10ca0bdd1407"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "1"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "137bfc40-aa1b-4d81-a3ab-e80de79b57fc",
                        "leftValue": "",
                        "rightValue": "",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "2"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "6f2ba0e7-86e2-48f4-9fda-b79e6356e2f1",
                        "leftValue": "",
                        "rightValue": "",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "3"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "3679acc8-fda4-495d-ab14-c8de55b0a049",
                        "leftValue": "",
                        "rightValue": "",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "4"
                }
              ]
            },
            "options": {
              "allMatchingOutputs": true
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -1712,
            816
          ],
          "id": "1a3cccd5-c6b1-4b8f-a4c1-0fcd082d32e6",
          "name": "Switch1"
        },
        {
          "parameters": {
            "operation": "restart-instance",
            "instanceName": "evolutionapi"
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            -1488,
            752
          ],
          "id": "077ea19c-7262-4887-b5d5-01df6ca3305b",
          "name": "Malco CR",
          "credentials": {
            "evolutionApi": {
              "id": "lgR3M6buNvrwBzQ0",
              "name": "Evolution 50662292932 - Malco CR"
            }
          }
        },
        {
          "parameters": {
            "operation": "restart-instance",
            "instanceName": "Smart CR"
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            -1488,
            560
          ],
          "id": "9dd76b25-cfcd-49ad-bb58-06b11e3201f4",
          "name": "Smart CR",
          "credentials": {
            "evolutionApi": {
              "id": "zEeNcZfyeYVosz78",
              "name": "Smart CR"
            }
          }
        },
        {
          "parameters": {
            "operation": "restart-instance",
            "instanceName": "Allpol"
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            -1488,
            944
          ],
          "id": "7d844b9f-669c-41c3-8801-0874b345b592",
          "name": "Allpol",
          "credentials": {
            "evolutionApi": {
              "id": "BcKApPoAEmD2PL5m",
              "name": "wsp Allpol - 221 6925658"
            }
          }
        },
        {
          "parameters": {
            "outputFieldName": "currentDate-ARG",
            "options": {
              "timezone": "America/Buenos_Aires"
            }
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            368,
            976
          ],
          "id": "78608835-bf87-4c16-9eff-0d6fff96a007",
          "name": "Argentina2"
        },
        {
          "parameters": {
            "outputFieldName": "currentDate-ARG",
            "options": {
              "timezone": "America/Buenos_Aires"
            }
          },
          "type": "n8n-nodes-base.dateTime",
          "typeVersion": 2,
          "position": [
            368,
            1360
          ],
          "id": "f738fdf7-cf1c-4b36-a3e2-d40e8f2cc40e",
          "name": "Argentina1"
        },
        {
          "parameters": {
            "resource": "messages-api",
            "instanceName": "Malco ARG",
            "remoteJid": "5492215548877",
            "messageText": "=Alejandro buenas, entro un mensaje de la pagina, si no te escribió le podes escribir vos, acá te dejo los datos:\n\n{{ $('Webhook').item.json.body.referrer }}\nSolicitud de contacto:\nfecha/hs: {{ $('Webhook').item.json.body.sentDateUTC }}\nnombre: {{ $('Webhook').item.json.body.Nombre }}\ntel: {{ $('Webhook').item.json.body['Número de WhatsApp'] }}\nmensaje: {{ $('Webhook').item.json.body.mensaje }}",
            "options_message": {}
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            -2592,
            2896
          ],
          "id": "92684be8-29fe-44f7-8a8c-f91f4315dc40",
          "name": "Alejandro",
          "credentials": {
            "evolutionApi": {
              "id": "uFLlpp0hjQkOnZnJ",
              "name": "Evolution 5492216115728 - Malco ARG"
            }
          }
        },
        {
          "parameters": {
            "resource": "messages-api",
            "instanceName": "Malco ARG",
            "remoteJid": "5492213184300",
            "messageText": "=Mati buenas, entro un mensaje de la pagina, si no te escribió le podes escribir vos, acá te dejo los datos:\n\n{{ $('Webhook').item.json.body.referrer }}\nSolicitud de contacto:\nfecha/hs: {{ $('Webhook').item.json.body.sentDateUTC }}\nnombre: {{ $('Webhook').item.json.body.Nombre }}\ntel: {{ $('Webhook').item.json.body['Número de WhatsApp'] }}\nmensaje: {{ $('Webhook').item.json.body.mensaje }}",
            "options_message": {}
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            -2592,
            2448
          ],
          "id": "41570900-1c48-46a4-80d7-a30059f58bf8",
          "name": "Matias",
          "credentials": {
            "evolutionApi": {
              "id": "uFLlpp0hjQkOnZnJ",
              "name": "Evolution 5492216115728 - Malco ARG"
            }
          }
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1HU_G0Hy4IX3GuNccFU1Q-P1rUjeOVNd3XKr7e4FGSHk",
              "mode": "list",
              "cachedResultName": "Base de Datos - Leads",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HU_G0Hy4IX3GuNccFU1Q-P1rUjeOVNd3XKr7e4FGSHk/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 1755573248,
              "mode": "list",
              "cachedResultName": "leads",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HU_G0Hy4IX3GuNccFU1Q-P1rUjeOVNd3XKr7e4FGSHk/edit#gid=1755573248"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {},
              "matchingColumns": [],
              "schema": [
                {
                  "id": "timestamp",
                  "displayName": "timestamp",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "lead_id",
                  "displayName": "lead_id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "client_name",
                  "displayName": "client_name",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "client_phone",
                  "displayName": "client_phone",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "client_location",
                  "displayName": "client_location",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "service_details",
                  "displayName": "service_details",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "lead_source",
                  "displayName": "lead_source",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "professional_id",
                  "displayName": "professional_id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "price_per_lead",
                  "displayName": "price_per_lead",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "currency_code",
                  "displayName": "currency_code",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "status",
                  "displayName": "status",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "notified_timestamp",
                  "displayName": "notified_timestamp",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "weekly_summary_id",
                  "displayName": "weekly_summary_id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            592,
            784
          ],
          "id": "b3bd1eb5-eca4-4d06-ace0-03fccbe6dca1",
          "name": "Append row in sheet",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "XCVUrxXJwWv4s45E",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "edf444ee-1b8d-4cb7-930e-42fabc24d557",
                  "name": "client_name",
                  "value": "={{ $json.body.nombre }}",
                  "type": "string"
                },
                {
                  "id": "853fffdc-e7b7-4379-9c54-ed218f8e6850",
                  "name": "client_phone",
                  "value": "={{ $json.body.tel }}",
                  "type": "string"
                },
                {
                  "id": "d0170f01-7548-4755-98d1-f70f3948d7a4",
                  "name": "service_details",
                  "value": "={{ $json.body.serv }}",
                  "type": "string"
                },
                {
                  "id": "7a69fec7-af59-4e5c-a985-97aea15601e3",
                  "name": "lead_source",
                  "value": "={{ $json.body.referrerArrival }}",
                  "type": "string"
                },
                {
                  "id": "97d463d6-b45a-4c35-aee2-bb06cbe202bc",
                  "name": "professional_whatsapp",
                  "value": "={{ $('Webhook').item.json.body.phoneAgent }}",
                  "type": "string"
                },
                {
                  "id": "887d5af4-c7e2-4389-aee5-9245499d6ae2",
                  "name": "timestamp",
                  "value": "={{ DateTime.now().setZone('America/Costa_Rica').toFormat('yyyy-MM-dd HH:mm:ss') }}",
                  "type": "string"
                },
                {
                  "id": "9162b23f-bdf3-4e3e-b040-d36c2f61cb69",
                  "name": "ubicacion",
                  "value": "={{ $json.body.ubi }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1680,
            1376
          ],
          "id": "1b4c1ea5-ab30-4cec-927b-482d64448191",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "9cbab708-bf85-4f1b-a591-b63303f36b0e",
                  "leftValue": "={{ $json.daily_prompt_id }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -464,
            1360
          ],
          "id": "7ded00a4-a7c3-4f67-8940-d4241b06f609",
          "name": "If"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            -1552,
            2144
          ],
          "id": "99b1e00a-f9b8-4562-9e11-48f2c8d65738",
          "name": "Loop Over Items"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=Leads a notificar en concordancia ordinal: {{ $json.client_name }} - {{ $json.client_phone }} - {{ $json.service_details }} - {{ $json.timestamp }}",
            "options": {
              "systemMessage": "={{ $('Loop Over Items').item.json.daily_prompt_id }}"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 2.2,
          "position": [
            -656,
            1904
          ],
          "id": "c04e9dc5-d584-4c12-bf43-0a2cac1f829b",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "30ef8bd3-c0e8-41ab-877a-c520f8aa3763",
                  "leftValue": "={{ $json.client_name }}",
                  "rightValue": "",
                  "operator": {
                    "type": "array",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": "={{ false }}",
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -880,
            1904
          ],
          "id": "b77af841-3214-4f61-a29f-7bac5c5023e5",
          "name": "If1"
        },
        {
          "parameters": {
            "fieldsToAggregate": {
              "fieldToAggregate": [
                {
                  "fieldToAggregate": "client_name"
                },
                {
                  "fieldToAggregate": "client_phone"
                },
                {
                  "fieldToAggregate": "service_details"
                },
                {
                  "fieldToAggregate": "timestamp"
                }
              ]
            },
            "options": {
              "mergeLists": true
            }
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            -1104,
            1904
          ],
          "id": "cdac17f2-d509-42e9-8538-7d78feb0cef3",
          "name": "Aggregate"
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "triggerAtHour": 17,
                  "triggerAtMinute": 7
                }
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.2,
          "position": [
            -2000,
            2240
          ],
          "id": "fdaef204-c7c0-4a96-b763-2f4e5f40158d",
          "name": "Diario"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            -80,
            2160
          ],
          "id": "4b034838-2ae8-499c-942e-cc49bb12cf0a",
          "name": "Merge"
        },
        {
          "parameters": {
            "resource": "messages-api",
            "instanceName": "evolutionapi",
            "remoteJid": "50662292932",
            "messageText": "={{ $json.output }}",
            "options_message": {}
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            -2592,
            2672
          ],
          "id": "74c0467c-c5c4-42e9-aa44-a9383239f401",
          "name": "A mi los descartados1",
          "credentials": {
            "evolutionApi": {
              "id": "lgR3M6buNvrwBzQ0",
              "name": "Evolution 50662292932 - Malco CR"
            }
          }
        },
        {
          "parameters": {
            "resource": "messages-api",
            "instanceName": "evolutionapi",
            "remoteJid": "=5492216115728",
            "messageText": "={{ $json.output }}",
            "options_message": {}
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            -304,
            1904
          ],
          "id": "febf77e0-4a30-4e42-b39f-751438a136cd",
          "name": "A mi de prueba",
          "credentials": {
            "evolutionApi": {
              "id": "lgR3M6buNvrwBzQ0",
              "name": "Evolution 50662292932 - Malco CR"
            }
          }
        },
        {
          "parameters": {
            "sessionIdType": "customKey",
            "sessionKey": "={{ $('Loop Over Items').item.json.whatsapp_number }}",
            "contextWindowLength": 7
          },
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            -560,
            2064
          ],
          "id": "050f08bf-2b3c-4324-85c6-9e2843e8cda1",
          "name": "Simple Memory"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "claude-3-7-sonnet-20250219",
              "mode": "list",
              "cachedResultName": "Claude Sonnet 3.7"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
          "typeVersion": 1.3,
          "position": [
            -736,
            2064
          ],
          "id": "2be5222d-c7c9-4d58-a05d-5e3d97cd4d4a",
          "name": "Anthropic Chat Model",
          "credentials": {
            "anthropicApi": {
              "id": "KvZF7MNs1iI9NLKB",
              "name": "Anthropic account"
            }
          }
        },
        {
          "parameters": {
            "resource": "messages-api",
            "instanceName": "evolutionapi",
            "remoteJid": "542216115728",
            "messageText": "Hubo un fallo en la coneccion de N8N con Google",
            "options_message": {}
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            -1552,
            2336
          ],
          "id": "09a70a8d-0411-4045-9a83-93cda4bb86df",
          "name": "Enviar texto",
          "credentials": {
            "evolutionApi": {
              "id": "lgR3M6buNvrwBzQ0",
              "name": "Evolution 50662292932 - Malco CR"
            }
          }
        },
        {
          "parameters": {
            "resource": "messages-api",
            "instanceName": "evolutionapi",
            "remoteJid": "542216115728",
            "messageText": "Hubo un fallo en la coneccion de N8N con Google",
            "options_message": {}
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            -592,
            1568
          ],
          "id": "38649981-33c0-4099-9a16-fef5982d3613",
          "name": "Enviar texto1",
          "credentials": {
            "evolutionApi": {
              "id": "lgR3M6buNvrwBzQ0",
              "name": "Evolution 50662292932 - Malco CR"
            }
          }
        },
        {
          "parameters": {
            "operation": "search",
            "base": {
              "__rl": true,
              "value": "appuqvJKOHdjlI6Np",
              "mode": "list",
              "cachedResultName": "Profesionales",
              "cachedResultUrl": "https://airtable.com/appuqvJKOHdjlI6Np"
            },
            "table": {
              "__rl": true,
              "value": "tblowzUNVeV8gYJZq",
              "mode": "list",
              "cachedResultName": "hoja1",
              "cachedResultUrl": "https://airtable.com/appuqvJKOHdjlI6Np/tblowzUNVeV8gYJZq"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.airtable",
          "typeVersion": 2.1,
          "position": [
            -1776,
            2240
          ],
          "id": "a1c5d1a4-70ec-4b40-a29b-2babdda2ac4c",
          "name": "Lista profesionales",
          "credentials": {
            "airtableTokenApi": {
              "id": "2zDfs1ZY0VzfVfyg",
              "name": "Airtable Personal Access Token account"
            }
          },
          "onError": "continueErrorOutput"
        },
        {
          "parameters": {
            "operation": "search",
            "base": {
              "__rl": true,
              "value": "app8jff881WWUr8Sl",
              "mode": "list",
              "cachedResultName": "Base de Datos - Leads",
              "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl"
            },
            "table": {
              "__rl": true,
              "value": "tblCq162vKS035OZf",
              "mode": "list",
              "cachedResultName": "leads",
              "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl/tblCq162vKS035OZf"
            },
            "filterByFormula": "=AND({professional_id} = '{{ $json.whatsapp_number }}', {status} = 'sin-notificar')",
            "returnAll": false,
            "options": {}
          },
          "type": "n8n-nodes-base.airtable",
          "typeVersion": 2.1,
          "position": [
            -1296,
            2160
          ],
          "id": "47fd2f1f-4efd-46ce-80d1-7ca822493e88",
          "name": "Leads sin notificar",
          "credentials": {
            "airtableTokenApi": {
              "id": "2zDfs1ZY0VzfVfyg",
              "name": "Airtable Personal Access Token account"
            }
          }
        },
        {
          "parameters": {
            "operation": "upsert",
            "base": {
              "__rl": true,
              "value": "app8jff881WWUr8Sl",
              "mode": "list",
              "cachedResultName": "Base de Datos - Leads",
              "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl"
            },
            "table": {
              "__rl": true,
              "value": "tblCq162vKS035OZf",
              "mode": "list",
              "cachedResultName": "leads",
              "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl/tblCq162vKS035OZf"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "client_phone": "={{ $json.client_phone }}",
                "status": "notificado",
                "notified_timestamp": "={{new Date().toLocaleDateString()}}"
              },
              "matchingColumns": [
                "client_phone"
              ],
              "schema": [
                {
                  "id": "id",
                  "displayName": "id",
                  "required": false,
                  "defaultMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": true,
                  "removed": false
                },
                {
                  "id": "timestamp",
                  "displayName": "timestamp",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "client_name",
                  "displayName": "client_name",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "client_phone",
                  "displayName": "client_phone",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "client_location",
                  "displayName": "client_location",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "service_details",
                  "displayName": "service_details",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "lead_source",
                  "displayName": "lead_source",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "options",
                  "options": [
                    {
                      "name": "De qué página o campaña vino el lead.",
                      "value": "De qué página o campaña vino el lead."
                    },
                    {
                      "name": "camarasseguridad.net",
                      "value": "camarasseguridad.net"
                    },
                    {
                      "name": "https://services.tochat.be/es/app/whatsapp/1b7894f5-baf9-4fb6-bb30-2fc621360617/edit",
                      "value": "https://services.tochat.be/es/app/whatsapp/1b7894f5-baf9-4fb6-bb30-2fc621360617/edit"
                    },
                    {
                      "name": "https://services.tochat.be/es/app/whatsapp/form/whatsapp-form/1b7894f5-baf9-4fb6-bb30-2fc621360617",
                      "value": "https://services.tochat.be/es/app/whatsapp/form/whatsapp-form/1b7894f5-baf9-4fb6-bb30-2fc621360617"
                    },
                    {
                      "name": "https://camarasseguridad.net/",
                      "value": "https://camarasseguridad.net/"
                    },
                    {
                      "name": "https://laplata.camarasseguridad.net/",
                      "value": "https://laplata.camarasseguridad.net/"
                    },
                    {
                      "name": "https://camarasseguridad.net/#servicios",
                      "value": "https://camarasseguridad.net/#servicios"
                    },
                    {
                      "name": "FALSE",
                      "value": "FALSE"
                    },
                    {
                      "name": "https://camarasseguridad.net/#formulario",
                      "value": "https://camarasseguridad.net/#formulario"
                    },
                    {
                      "name": "https://camarasseguridad.net/costa-rica/alajuela/",
                      "value": "https://camarasseguridad.net/costa-rica/alajuela/"
                    },
                    {
                      "name": "https://camarasseguridad.net/?utm_source=google&utm_medium=organic&utm_content=main_button&utm_campaign=gmb",
                      "value": "https://camarasseguridad.net/?utm_source=google&utm_medium=organic&utm_content=main_button&utm_campaign=gmb"
                    }
                  ],
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "professional_id",
                  "displayName": "professional_id",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "options",
                  "options": [
                    {
                      "name": "Identificador único del profesional asignado.",
                      "value": "Identificador único del profesional asignado."
                    },
                    {
                      "name": "50660742444",
                      "value": "50660742444"
                    },
                    {
                      "name": "542215548877",
                      "value": "542215548877"
                    }
                  ],
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "price_per_lead",
                  "displayName": "price_per_lead",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "options",
                  "options": [
                    {
                      "name": "Costo acordado por este lead específico.",
                      "value": "Costo acordado por este lead específico."
                    },
                    {
                      "name": "2000",
                      "value": "2000"
                    },
                    {
                      "name": "5000",
                      "value": "5000"
                    }
                  ],
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "currency_code",
                  "displayName": "currency_code",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "options",
                  "options": [
                    {
                      "name": "Código de la moneda para el cobro.",
                      "value": "Código de la moneda para el cobro."
                    },
                    {
                      "name": "CRC (Colones), ARS (Pesos)",
                      "value": "CRC (Colones), ARS (Pesos)"
                    },
                    {
                      "name": "CRC",
                      "value": "CRC"
                    },
                    {
                      "name": "ARS",
                      "value": "ARS"
                    }
                  ],
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "status",
                  "displayName": "status",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "options",
                  "options": [
                    {
                      "name": "Estado del lead en el flujo de n8n.",
                      "value": "Estado del lead en el flujo de n8n."
                    },
                    {
                      "name": "notificado",
                      "value": "notificado"
                    },
                    {
                      "name": "sin-notificar",
                      "value": "sin-notificar"
                    }
                  ],
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "notified_timestamp",
                  "displayName": "notified_timestamp",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "weekly_summary_id",
                  "displayName": "weekly_summary_id",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.airtable",
          "typeVersion": 2.1,
          "position": [
            -336,
            2176
          ],
          "id": "1bc8d79c-99be-4852-a1f2-9a903d59649c",
          "name": "cambia a notificado",
          "credentials": {
            "airtableTokenApi": {
              "id": "2zDfs1ZY0VzfVfyg",
              "name": "Airtable Personal Access Token account"
            }
          }
        },
        {
          "parameters": {
            "operation": "create",
            "base": {
              "__rl": true,
              "value": "app8jff881WWUr8Sl",
              "mode": "list",
              "cachedResultName": "Base de Datos - Leads",
              "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl"
            },
            "table": {
              "__rl": true,
              "value": "tblCq162vKS035OZf",
              "mode": "list",
              "cachedResultName": "leads",
              "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl/tblCq162vKS035OZf"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "timestamp": "={{ $('Edit Fields').item.json.timestamp }}",
                "client_name": "={{ $('Edit Fields').item.json.client_name }}",
                "client_phone": "={{ $('Edit Fields').item.json.client_phone }}",
                "client_location": "={{ $('Edit Fields').item.json.ubicacion }}",
                "service_details": "={{ $('Edit Fields').item.json.service_details }}",
                "lead_source": "={{ $('Edit Fields').item.json.lead_source }}",
                "professional_id": "={{ $('Edit Fields').item.json.professional_whatsapp }}",
                "price_per_lead": "={{ $('Busca profesional').item.json.price_per_lead }}",
                "status": "=sin-notificar",
                "currency_code": "={{ $('Busca profesional').item.json.currency_code }}",
                "notified_timestamp": "={{ $now }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "timestamp",
                  "displayName": "timestamp",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "client_name",
                  "displayName": "client_name",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "client_phone",
                  "displayName": "client_phone",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "client_location",
                  "displayName": "client_location",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "service_details",
                  "displayName": "service_details",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "lead_source",
                  "displayName": "lead_source",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "professional_id",
                  "displayName": "professional_id",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "price_per_lead",
                  "displayName": "price_per_lead",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "options",
                  "options": [
                    {
                      "name": "Costo acordado por este lead específico.",
                      "value": "Costo acordado por este lead específico."
                    },
                    {
                      "name": "2000",
                      "value": "2000"
                    },
                    {
                      "name": "5000",
                      "value": "5000"
                    }
                  ],
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "currency_code",
                  "displayName": "currency_code",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "options",
                  "options": [
                    {
                      "name": "Código de la moneda para el cobro.",
                      "value": "Código de la moneda para el cobro."
                    },
                    {
                      "name": "CRC (Colones), ARS (Pesos)",
                      "value": "CRC (Colones), ARS (Pesos)"
                    },
                    {
                      "name": "CRC",
                      "value": "CRC"
                    },
                    {
                      "name": "ARS",
                      "value": "ARS"
                    }
                  ],
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "status",
                  "displayName": "status",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "options",
                  "options": [
                    {
                      "name": "Estado del lead en el flujo de n8n.",
                      "value": "Estado del lead en el flujo de n8n."
                    },
                    {
                      "name": "notificado",
                      "value": "notificado"
                    },
                    {
                      "name": "sin-notificar",
                      "value": "sin-notificar"
                    }
                  ],
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "notified_timestamp",
                  "displayName": "notified_timestamp",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "weekly_summary_id",
                  "displayName": "weekly_summary_id",
                  "required": false,
                  "defaultMatch": false,
                  "canBeUsedToMatch": true,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.airtable",
          "typeVersion": 2.1,
          "position": [
            256,
            1520
          ],
          "id": "c7eecea6-4f63-4a17-a02b-fb7680e559f5",
          "name": "Create a record",
          "credentials": {
            "airtableTokenApi": {
              "id": "2zDfs1ZY0VzfVfyg",
              "name": "Airtable Personal Access Token account"
            }
          }
        },
        {
          "parameters": {
            "operation": "search",
            "base": {
              "__rl": true,
              "value": "appuqvJKOHdjlI6Np",
              "mode": "list",
              "cachedResultName": "Profesionales",
              "cachedResultUrl": "https://airtable.com/appuqvJKOHdjlI6Np"
            },
            "table": {
              "__rl": true,
              "value": "tblowzUNVeV8gYJZq",
              "mode": "list",
              "cachedResultName": "hoja1",
              "cachedResultUrl": "https://airtable.com/appuqvJKOHdjlI6Np/tblowzUNVeV8gYJZq"
            },
            "filterByFormula": "=AND({whatsapp_number} = {{$json.professional_whatsapp}}, {activo?} = 'si')",
            "options": {
              "fields": [
                "daily_prompt_id",
                "price_per_lead",
                "currency_code"
              ]
            }
          },
          "type": "n8n-nodes-base.airtable",
          "typeVersion": 2.1,
          "position": [
            -896,
            1360
          ],
          "id": "49aa9822-2b8c-4a0c-95b9-b6a23419cf02",
          "name": "Busca profesional",
          "alwaysOutputData": false,
          "credentials": {
            "airtableTokenApi": {
              "id": "2zDfs1ZY0VzfVfyg",
              "name": "Airtable Personal Access Token account"
            }
          }
        },
        {
          "parameters": {
            "operation": "search",
            "base": {
              "__rl": true,
              "value": "app8jff881WWUr8Sl",
              "mode": "list",
              "cachedResultName": "Base de Datos - Leads",
              "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl"
            },
            "table": {
              "__rl": true,
              "value": "tblCq162vKS035OZf",
              "mode": "list",
              "cachedResultName": "leads",
              "cachedResultUrl": "https://airtable.com/app8jff881WWUr8Sl/tblCq162vKS035OZf"
            },
            "filterByFormula": "=AND(\n  {client_phone} = '{{ $('Edit Fields').item.json.client_phone }}',\n  OR(\n    IS_SAME(DATETIME_PARSE({timestamp}, 'YYYY-MM-DD HH:mm:ss'), TODAY(), 'day'),\n    IS_SAME(DATETIME_PARSE({timestamp}, 'YYYY-MM-DD HH:mm:ss'), DATEADD(TODAY(), -1, 'days'), 'day')\n  )\n)",
            "returnAll": false,
            "limit": 5,
            "options": {}
          },
          "type": "n8n-nodes-base.airtable",
          "typeVersion": 2.1,
          "position": [
            -208,
            1328
          ],
          "id": "9859c7ed-a6c9-4fa6-b3b8-ee783e3d8cfd",
          "name": "Busca Lead en registros",
          "alwaysOutputData": true,
          "credentials": {
            "airtableTokenApi": {
              "id": "2zDfs1ZY0VzfVfyg",
              "name": "Airtable Personal Access Token account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "ff57a4ac-c416-47e4-b5b0-d79238e55b60",
                  "leftValue": "={{ $json.id }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            16,
            1408
          ],
          "id": "439c1ac1-f456-45de-b7df-15e321cba636",
          "name": "Es Lead unico?",
          "alwaysOutputData": false
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "18e9ae0c-d9f0-4b48-813b-654e791d54ec",
                  "leftValue": "={{ $('Webhook').item.json.body.mensaje }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notExists",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -1456,
            1216
          ],
          "id": "ff11c8f7-6952-4148-a38b-c9aa9c61c073",
          "name": "If2"
        },
        {
          "parameters": {
            "resource": "messages-api",
            "instanceName": "evolutionapi",
            "remoteJid": "={{ $('Edit Fields').item.json.professional_whatsapp }}",
            "messageText": "=Nuevo cliente recibido {{ $now.setLocale('es-CR').format(\"dd LLL yyyy '- 'HH:mm a\") }}\n\nnombre: {{ $('Edit Fields').item.json.client_name }}\ntel: {{ $('Edit Fields').item.json.client_phone }}\nubicación: {{ $('Edit Fields').item.json.ubicacion }}",
            "options_message": {}
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            624,
            1600
          ],
          "id": "a4f1d615-9909-4d2a-8922-4709596c4566",
          "name": "Mensaje a Profesional",
          "credentials": {
            "evolutionApi": {
              "id": "lgR3M6buNvrwBzQ0",
              "name": "Evolution 50662292932 - Malco CR"
            }
          }
        }
      ],
      "connections": {
        "Webhook": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "Costa Rica",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Argentina2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Argentina",
                "type": "main",
                "index": 0
              }
            ],
            [],
            [
              {
                "node": "Argentina1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Text Classifier": {
          "main": [
            [
              {
                "node": "Busca profesional",
                "type": "main",
                "index": 0
              }
            ],
            [],
            []
          ]
        },
        "DeepSeek Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Text Classifier",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Costa Rica": {
          "main": [
            [
              {
                "node": "Append row in sheet",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Argentina": {
          "main": [
            [
              {
                "node": "Agrega contacos de la web a Leads Allpol",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger": {
          "main": [
            [
              {
                "node": "Switch1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch1": {
          "main": [
            [
              {
                "node": "Smart CR",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Malco CR",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Allpol",
                "type": "main",
                "index": 0
              }
            ],
            []
          ]
        },
        "Argentina2": {
          "main": [
            []
          ]
        },
        "Argentina1": {
          "main": [
            []
          ]
        },
        "Alejandro": {
          "main": [
            []
          ]
        },
        "Agrega contacos de la web a Leads Allpol": {
          "main": [
            []
          ]
        },
        "Append row in sheet": {
          "main": [
            []
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "If2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "Busca Lead en registros",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items": {
          "main": [
            [],
            [
              {
                "node": "Leads sin notificar",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent": {
          "main": [
            [
              {
                "node": "A mi de prueba",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If1": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate": {
          "main": [
            [
              {
                "node": "If1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Diario": {
          "main": [
            [
              {
                "node": "Lista profesionales",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "A mi de prueba": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Anthropic Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Lista profesionales": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Enviar texto",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Leads sin notificar": {
          "main": [
            [
              {
                "node": "Aggregate",
                "type": "main",
                "index": 0
              },
              {
                "node": "cambia a notificado",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "cambia a notificado": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Create a record": {
          "main": [
            [
              {
                "node": "Mensaje a Profesional",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca profesional": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ],
            []
          ]
        },
        "Busca Lead en registros": {
          "main": [
            [
              {
                "node": "Es Lead unico?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Es Lead unico?": {
          "main": [
            [
              {
                "node": "Create a record",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If2": {
          "main": [
            [
              {
                "node": "Busca profesional",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Text Classifier",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "authors": "malco fernandez",
      "name": null,
      "description": null
    },
    "tags": []
  },
  {
    "updatedAt": "2025-11-19T14:02:00.000Z",
    "createdAt": "2025-11-19T14:01:48.955Z",
    "id": "5mdeSznQUBSQro5k",
    "name": "Lista limpia",
    "active": false,
    "isArchived": true,
    "nodes": [],
    "connections": {},
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": null,
    "pinData": {},
    "versionId": "ae3fbee0-e9dd-4d2b-a4d6-1d4664c501a5",
    "activeVersionId": null,
    "triggerCount": 0,
    "shared": [
      {
        "updatedAt": "2025-11-19T14:01:48.960Z",
        "createdAt": "2025-11-19T14:01:48.960Z",
        "role": "workflow:owner",
        "workflowId": "5mdeSznQUBSQro5k",
        "projectId": "CyuOAJo56zhDqPtw"
      }
    ],
    "activeVersion": null,
    "tags": []
  },
  {
    "updatedAt": "2025-09-30T19:23:33.699Z",
    "createdAt": "2025-09-30T19:23:33.699Z",
    "id": "94x7SAJKgaOgB3Cf",
    "name": "Demo: RAG in n8n",
    "active": false,
    "isArchived": false,
    "nodes": [
      {
        "parameters": {
          "formTitle": "Upload your data to test RAG",
          "formFields": {
            "values": [
              {
                "fieldLabel": "Upload your file(s)",
                "fieldType": "file",
                "acceptFileTypes": ".pdf, .csv",
                "requiredField": true
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.formTrigger",
        "typeVersion": 2.2,
        "position": [
          -128,
          0
        ],
        "id": "f7a656ec-83fc-4ed2-a089-57a9def662b7",
        "name": "Upload your file here",
        "webhookId": "82848bc4-5ea2-4e5a-8bb6-3c09b94a8c5d"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
        "typeVersion": 1.2,
        "position": [
          528,
          480
        ],
        "id": "6ea78663-cf2f-4f2d-8e68-43047c2afd87",
        "name": "Embeddings OpenAI",
        "credentials": {
          "openAiApi": {
            "id": "4KlRoIAzZJhV4U20",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "dataType": "binary",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
        "typeVersion": 1.1,
        "position": [
          320,
          160
        ],
        "id": "94aecac0-03f9-4915-932b-d14a2576607b",
        "name": "Default Data Loader"
      },
      {
        "parameters": {
          "content": "### Léame\nCargue sus datos en una base de datos vectorial con el flujo 📚 **Cargar datos** y luego úselos como contexto de chat con el flujo 🐕 **Recuperador**.\n\n**Inicio rápido**\n1. Haga clic en el botón \"Ejecutar flujo de trabajo\" para ejecutar el flujo 📚 **Cargar datos**.\n2. Haga clic en el botón \"Abrir chat\" para ejecutar el flujo 🐕 **Recuperador**. A continuación, haga una pregunta sobre el contenido de sus documentos.\n\nPara más información, consulte [nuestra documentación sobre RAG en n8n](https://docs.n8n.io/advanced-ai/rag-in-n8n/).",
          "height": 316,
          "width": 440,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -656,
          -64
        ],
        "typeVersion": 1,
        "id": "0d07742b-0b36-4c2e-990c-266cbe6e2d4d",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "content": "### 📚 Load Data Flow",
          "height": 460,
          "width": 700,
          "color": 7
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -176,
          -64
        ],
        "typeVersion": 1,
        "id": "d19d04f3-5231-4e47-bed7-9f24a4a8f582",
        "name": "Sticky Note1"
      },
      {
        "parameters": {
          "mode": "insert",
          "memoryKey": {
            "__rl": true,
            "value": "vector_store_key",
            "mode": "list",
            "cachedResultName": "vector_store_key"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.vectorStoreInMemory",
        "typeVersion": 1.2,
        "position": [
          64,
          0
        ],
        "id": "bf50a11f-ca6a-4e04-a6d2-42fee272b260",
        "name": "Insert Data to Store"
      },
      {
        "parameters": {
          "mode": "retrieve-as-tool",
          "toolName": "knowledge_base",
          "toolDescription": "Use this knowledge base to answer questions from the user",
          "memoryKey": {
            "__rl": true,
            "mode": "list",
            "value": "vector_store_key"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.vectorStoreInMemory",
        "typeVersion": 1.2,
        "position": [
          944,
          208
        ],
        "id": "09c0db62-5413-440e-8c13-fb6bb66d9b6a",
        "name": "Query Data Tool"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 2,
        "position": [
          944,
          -16
        ],
        "id": "579aed76-9644-42d1-ac13-7369059ff1c2",
        "name": "AI Agent"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.chatTrigger",
        "typeVersion": 1.1,
        "position": [
          720,
          -16
        ],
        "id": "9c30de61-935a-471f-ae88-ec5f67beeefc",
        "name": "When chat message received",
        "webhookId": "4091fa09-fb9a-4039-9411-7104d213f601"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          720,
          208
        ],
        "id": "b5aa8942-9cd5-4c2f-bd77-7a0ceb921bac",
        "name": "OpenAI Chat Model",
        "credentials": {
          "openAiApi": {
            "id": "4KlRoIAzZJhV4U20",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "content": "### 🐕 2. Retriever Flow",
          "height": 460,
          "width": 680,
          "color": 7
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          608,
          -64
        ],
        "typeVersion": 1,
        "id": "28bc73a1-e64a-47bf-ac1c-ffe644894ea5",
        "name": "Sticky Note2"
      },
      {
        "parameters": {
          "content": "### Incrustaciones\n\nLas operaciones de inserción y recuperación utilizan el mismo nodo de incrustación.\n\nEsto garantiza que utilicen **exactamente las mismas incrustaciones y configuraciones**.\n\nEs posible que incrustaciones diferentes no funcionen o tengan consecuencias imprevistas.",
          "height": 272,
          "width": 320,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          672,
          448
        ],
        "typeVersion": 1,
        "id": "0cf8c647-418c-4d1a-8952-766145afca72",
        "name": "Sticky Note3"
      }
    ],
    "connections": {
      "Upload your file here": {
        "main": [
          [
            {
              "node": "Insert Data to Store",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Embeddings OpenAI": {
        "ai_embedding": [
          [
            {
              "node": "Insert Data to Store",
              "type": "ai_embedding",
              "index": 0
            },
            {
              "node": "Query Data Tool",
              "type": "ai_embedding",
              "index": 0
            }
          ]
        ]
      },
      "Default Data Loader": {
        "ai_document": [
          [
            {
              "node": "Insert Data to Store",
              "type": "ai_document",
              "index": 0
            }
          ]
        ]
      },
      "Query Data Tool": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "When chat message received": {
        "main": [
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": {
      "templateId": "rag-starter-template"
    },
    "pinData": {},
    "versionId": "5d2f1143-2d6a-4b7c-bd12-8cf061761914",
    "activeVersionId": null,
    "triggerCount": 0,
    "shared": [
      {
        "updatedAt": "2025-09-30T19:23:33.716Z",
        "createdAt": "2025-09-30T19:23:33.716Z",
        "role": "workflow:owner",
        "workflowId": "94x7SAJKgaOgB3Cf",
        "projectId": "CyuOAJo56zhDqPtw"
      }
    ],
    "activeVersion": null,
    "tags": []
  },
  {
    "updatedAt": "2025-12-15T18:11:37.000Z",
    "createdAt": "2025-12-15T15:53:59.860Z",
    "id": "9pBWg7IQeNUJczJO",
    "name": "Seguimientos Diarios Allpol",
    "active": false,
    "isArchived": true,
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "triggerAtHour": 9
              }
            ]
          }
        },
        "id": "schedule-trigger",
        "name": "Cada día 9AM",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          0,
          0
        ]
      },
      {
        "parameters": {
          "operation": "getAll",
          "tableId": "client_followups",
          "returnAll": true,
          "filterType": "string",
          "filterString": "scheduled_date=lte.{{ $now.format('yyyy-MM-dd') }}&status=eq.pending&select=*,clients(name,phone)",
          "options": {}
        },
        "id": "supabase-get",
        "name": "Get Followups Pendientes",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          220,
          0
        ],
        "credentials": {
          "supabaseApi": {
            "id": "supabase-creds",
            "name": "Supabase Allpol"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "condition-check",
                "leftValue": "={{ $input.all().length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "if-hay-pendientes",
        "name": "¿Hay pendientes?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          440,
          0
        ]
      },
      {
        "parameters": {
          "jsCode": "const followups = $input.all();\n\nconst today = new Date().toLocaleDateString('es-AR', { \n  weekday: 'long', \n  year: 'numeric', \n  month: 'long', \n  day: 'numeric' \n});\n\nlet message = `📅 *Seguimientos pendientes*\\n${today}\\n\\n`;\n\nconst typeEmojis = {\n  'reminder': '🔔',\n  'grouping': '📦',\n  'material': '🏭'\n};\n\nconst typeNames = {\n  'reminder': 'Recordatorio',\n  'grouping': 'Oportunidad de Agrupación',\n  'material': 'Material Disponible'\n};\n\nfollowups.forEach((item, index) => {\n  const f = item.json;\n  const emoji = typeEmojis[f.type] || '📌';\n  const typeName = typeNames[f.type] || f.type;\n  \n  // Calcular días de atraso\n  const schedDate = new Date(f.scheduled_date);\n  const todayDate = new Date();\n  const daysLate = Math.floor((todayDate - schedDate) / (1000 * 60 * 60 * 24));\n  const lateText = daysLate > 0 ? ` ⚠️ (${daysLate} días de atraso)` : '';\n  \n  message += `${index + 1}. ${emoji} *${f.clients?.name || 'Cliente'}*${lateText}\\n`;\n  message += `   _${typeName}_\\n`;\n  if (f.notes) message += `   📝 ${f.notes}\\n`;\n  if (f.product_reference) message += `   📦 ${f.product_reference}\\n`;\n  message += `   📱 ${f.clients?.phone || 'Sin teléfono'}\\n\\n`;\n});\n\nmessage += `─────────────────\\n`;\nmessage += `_Total: ${followups.length} seguimiento(s) pendiente(s)_\\n`;\nmessage += `\\n💡 _Abrí Allpol Gestión > Seguimientos para gestionar_`;\n\nreturn [{ json: { message, count: followups.length } }];"
        },
        "id": "code-format",
        "name": "Formatear Mensaje",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          660,
          -100
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://automatizacion-evolution-api.aq0vtr.easypanel.host/message/sendText/Allpol",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              },
              {
                "name": "apikey",
                "value": "97D1DBC4C9E6-42E7-85E8-8E53D285C69E"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"number\": \"5492216925658@s.whatsapp.net\",\n  \"text\": {{ JSON.stringify($json.message) }}\n}",
          "options": {}
        },
        "id": "http-whatsapp",
        "name": "Enviar WhatsApp",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          880,
          -100
        ]
      },
      {
        "parameters": {},
        "id": "noop-end",
        "name": "Sin pendientes",
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          660,
          100
        ]
      }
    ],
    "connections": {
      "Cada día 9AM": {
        "main": [
          [
            {
              "node": "Get Followups Pendientes",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Followups Pendientes": {
        "main": [
          [
            {
              "node": "¿Hay pendientes?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "¿Hay pendientes?": {
        "main": [
          [
            {
              "node": "Formatear Mensaje",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Sin pendientes",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Formatear Mensaje": {
        "main": [
          [
            {
              "node": "Enviar WhatsApp",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1",
      "timezone": "America/Argentina/Buenos_Aires",
      "callerPolicy": "workflowsFromSameOwner",
      "availableInMCP": false
    },
    "staticData": null,
    "meta": null,
    "pinData": null,
    "versionId": "ced0d023-1099-459b-8d63-861c66a53948",
    "activeVersionId": null,
    "triggerCount": 0,
    "shared": [
      {
        "updatedAt": "2025-12-15T15:53:59.866Z",
        "createdAt": "2025-12-15T15:53:59.866Z",
        "role": "workflow:owner",
        "workflowId": "9pBWg7IQeNUJczJO",
        "projectId": "CyuOAJo56zhDqPtw"
      }
    ],
    "activeVersion": null,
    "tags": []
  },
  {
    "updatedAt": "2025-07-29T14:20:50.000Z",
    "createdAt": "2025-07-29T03:31:07.633Z",
    "id": "9rIUHbeYPtzAAB8P",
    "name": "chatbot-pizza-order",
    "active": false,
    "isArchived": false,
    "nodes": [
      {
        "parameters": {},
        "id": "8a04b8e6-ac8b-487f-a5be-18369a292edc",
        "name": "Calculator",
        "type": "@n8n/n8n-nodes-langchain.toolCalculator",
        "position": [
          928,
          320
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "f0ce099e-41a7-433b-ac43-a9878969e0db",
        "name": "Chat OpenAI",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          208,
          320
        ],
        "typeVersion": 1
      },
      {
        "parameters": {},
        "id": "5a613397-c5bd-41cb-8626-65dd1ccb5a0b",
        "name": "Window Buffer Memory",
        "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "position": [
          368,
          320
        ],
        "typeVersion": 1.2
      },
      {
        "parameters": {
          "toolDescription": "Retrieve detailed information about the product menu.",
          "url": "https://n8n.io/webhook/get-products"
        },
        "id": "8c1b486b-36c0-4828-9838-2e5cbecdd63f",
        "name": "Get Products",
        "type": "@n8n/n8n-nodes-langchain.toolHttpRequest",
        "position": [
          528,
          320
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "toolDescription": "Process product orders.",
          "method": "POST",
          "url": "https://n8n.io/webhook/order-product",
          "sendBody": true,
          "parametersBody": {
            "values": [
              {
                "name": "message",
                "valueProvider": "fieldValue",
                "value": "={{ $json.chatInput }}"
              }
            ]
          }
        },
        "id": "a35682e4-2ac6-4af3-a724-245753cdcd15",
        "name": "Order Product",
        "type": "@n8n/n8n-nodes-langchain.toolHttpRequest",
        "position": [
          672,
          320
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "toolDescription": "Get the order status.",
          "url": "https://n8n.io/webhook/get-orders"
        },
        "id": "d60cfd94-aaf7-42e9-b01e-d717a3319200",
        "name": "Get Order",
        "type": "@n8n/n8n-nodes-langchain.toolHttpRequest",
        "position": [
          784,
          320
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "public": true,
          "initialMessages": "Hellooo! 👋 My name is Pizzaro 🍕. I'm here to help with your pizza order. How can I assist you?\n\n📣 INFO: If you’d like to order a pizza, please include your name + pizza type + quantity. Thank you!",
          "options": {}
        },
        "id": "6154ba61-77d1-4a03-9d81-121407846a28",
        "name": "When chat message received",
        "type": "@n8n/n8n-nodes-langchain.chatTrigger",
        "position": [
          0,
          0
        ],
        "webhookId": "d925cc6e-6dd7-4459-a917-e68d57ab0e2a",
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.chatInput }}",
          "options": {
            "systemMessage": "=Te llamas Pizzaro y eres asistente de pedidos de pizza.\n\n1. Si un cliente pregunta por el menú, proporciona información sobre los productos disponibles.\n2. Si un cliente realiza un pedido, confirma los detalles, infórmale de que está en proceso y agradécele.\n3. Si un cliente pregunta por el estado de su pedido, proporciona la fecha, el tipo de pizza y la cantidad."
          }
        },
        "id": "0266ccab-e93d-4065-a64b-ab90d78bc0e2",
        "name": "AI Agent",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          240,
          0
        ],
        "executeOnce": false,
        "typeVersion": 1.6
      }
    ],
    "connections": {
      "Get Order": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Calculator": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Chat OpenAI": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Get Products": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Order Product": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Window Buffer Memory": {
        "ai_memory": [
          [
            {
              "node": "AI Agent",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "When chat message received": {
        "main": [
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": null,
    "pinData": {},
    "versionId": "07a38d3c-0f0d-49ff-9f16-48b53cb2cc9f",
    "activeVersionId": null,
    "triggerCount": 0,
    "shared": [
      {
        "updatedAt": "2025-07-29T03:31:07.641Z",
        "createdAt": "2025-07-29T03:31:07.641Z",
        "role": "workflow:owner",
        "workflowId": "9rIUHbeYPtzAAB8P",
        "projectId": "CyuOAJo56zhDqPtw"
      }
    ],
    "activeVersion": null,
    "tags": []
  },
  {
    "updatedAt": "2025-12-15T18:09:11.000Z",
    "createdAt": "2025-12-15T16:02:11.250Z",
    "id": "BIRRbowBQlGr4BmB",
    "name": "Seguimientos Diarios Allpol",
    "active": false,
    "isArchived": true,
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "triggerAtHour": 9
              }
            ]
          }
        },
        "id": "schedule-trigger",
        "name": "Cada día 9AM",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          0,
          0
        ]
      },
      {
        "parameters": {
          "operation": "getAll",
          "tableId": "client_followups",
          "returnAll": true,
          "filterType": "string",
          "filterString": "scheduled_date=lte.{{ $now.format('yyyy-MM-dd') }}&status=eq.pending&select=*,clients(name,phone)",
          "options": {}
        },
        "id": "supabase-get",
        "name": "Get Followups Pendientes",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          220,
          0
        ],
        "credentials": {
          "supabaseApi": {
            "id": "supabase-creds",
            "name": "Supabase Allpol"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "condition-check",
                "leftValue": "={{ $input.all().length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "if-hay-pendientes",
        "name": "¿Hay pendientes?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          440,
          0
        ]
      },
      {
        "parameters": {
          "jsCode": "const followups = $input.all();\n\nconst today = new Date().toLocaleDateString('es-AR', { \n  weekday: 'long', \n  year: 'numeric', \n  month: 'long', \n  day: 'numeric' \n});\n\nlet message = `📅 *Seguimientos pendientes*\\n${today}\\n\\n`;\n\nconst typeEmojis = {\n  'reminder': '🔔',\n  'grouping': '📦',\n  'material': '🏭'\n};\n\nconst typeNames = {\n  'reminder': 'Recordatorio',\n  'grouping': 'Oportunidad de Agrupación',\n  'material': 'Material Disponible'\n};\n\nfollowups.forEach((item, index) => {\n  const f = item.json;\n  const emoji = typeEmojis[f.type] || '📌';\n  const typeName = typeNames[f.type] || f.type;\n  \n  // Calcular días de atraso\n  const schedDate = new Date(f.scheduled_date);\n  const todayDate = new Date();\n  const daysLate = Math.floor((todayDate - schedDate) / (1000 * 60 * 60 * 24));\n  const lateText = daysLate > 0 ? ` ⚠️ (${daysLate} días de atraso)` : '';\n  \n  message += `${index + 1}. ${emoji} *${f.clients?.name || 'Cliente'}*${lateText}\\n`;\n  message += `   _${typeName}_\\n`;\n  if (f.notes) message += `   📝 ${f.notes}\\n`;\n  if (f.product_reference) message += `   📦 ${f.product_reference}\\n`;\n  message += `   📱 ${f.clients?.phone || 'Sin teléfono'}\\n\\n`;\n});\n\nmessage += `─────────────────\\n`;\nmessage += `_Total: ${followups.length} seguimiento(s) pendiente(s)_\\n`;\nmessage += `\\n💡 _Abrí Allpol Gestión > Seguimientos para gestionar_`;\n\nreturn [{ json: { message, count: followups.length } }];"
        },
        "id": "code-format",
        "name": "Formatear Mensaje",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          660,
          -100
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://automatizacion-evolution-api.aq0vtr.easypanel.host/message/sendText/Allpol",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              },
              {
                "name": "apikey",
                "value": "97D1DBC4C9E6-42E7-85E8-8E53D285C69E"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"number\": \"5492216925658@s.whatsapp.net\",\n  \"text\": {{ JSON.stringify($json.message) }}\n}",
          "options": {}
        },
        "id": "http-whatsapp",
        "name": "Enviar WhatsApp",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          880,
          -100
        ]
      },
      {
        "parameters": {},
        "id": "noop-end",
        "name": "Sin pendientes",
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          660,
          100
        ]
      }
    ],
    "connections": {
      "Cada día 9AM": {
        "main": [
          [
            {
              "node": "Get Followups Pendientes",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Followups Pendientes": {
        "main": [
          [
            {
              "node": "¿Hay pendientes?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "¿Hay pendientes?": {
        "main": [
          [
            {
              "node": "Formatear Mensaje",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Sin pendientes",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Formatear Mensaje": {
        "main": [
          [
            {
              "node": "Enviar WhatsApp",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1",
      "timezone": "America/Argentina/Buenos_Aires",
      "callerPolicy": "workflowsFromSameOwner",
      "availableInMCP": false
    },
    "staticData": null,
    "meta": null,
    "pinData": null,
    "versionId": "92ee5f04-21ea-44b2-b448-93c0014b0cf2",
    "activeVersionId": null,
    "triggerCount": 0,
    "shared": [
      {
        "updatedAt": "2025-12-15T16:02:11.252Z",
        "createdAt": "2025-12-15T16:02:11.252Z",
        "role": "workflow:owner",
        "workflowId": "BIRRbowBQlGr4BmB",
        "projectId": "CyuOAJo56zhDqPtw"
      }
    ],
    "activeVersion": null,
    "tags": []
  },
  {
    "updatedAt": "2025-12-15T18:09:12.902Z",
    "createdAt": "2025-12-15T16:02:23.053Z",
    "id": "M41AzCPlhql4OhOe",
    "name": "Seguimientos Diarios Allpol",
    "active": true,
    "isArchived": false,
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "triggerAtHour": 9
              }
            ]
          }
        },
        "id": "schedule-trigger",
        "name": "Cada día 9AM",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          0,
          0
        ]
      },
      {
        "parameters": {
          "operation": "getAll",
          "tableId": "client_followups",
          "returnAll": true,
          "filterType": "string",
          "filterString": "scheduled_date=lte.{{ $now.format('yyyy-MM-dd') }}&status=eq.pending&select=*,clients(name,phone)",
          "options": {}
        },
        "id": "supabase-get",
        "name": "Get Followups Pendientes",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          220,
          0
        ],
        "credentials": {
          "supabaseApi": {
            "id": "supabase-creds",
            "name": "Supabase Allpol"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "condition-check",
                "leftValue": "={{ $input.all().length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "if-hay-pendientes",
        "name": "¿Hay pendientes?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          440,
          0
        ]
      },
      {
        "parameters": {
          "jsCode": "const followups = $input.all();\n\nconst today = new Date().toLocaleDateString('es-AR', { \n  weekday: 'long', \n  year: 'numeric', \n  month: 'long', \n  day: 'numeric' \n});\n\nlet message = `📅 *Seguimientos pendientes*\\n${today}\\n\\n`;\n\nconst typeEmojis = {\n  'reminder': '🔔',\n  'grouping': '📦',\n  'material': '🏭'\n};\n\nconst typeNames = {\n  'reminder': 'Recordatorio',\n  'grouping': 'Oportunidad de Agrupación',\n  'material': 'Material Disponible'\n};\n\nfollowups.forEach((item, index) => {\n  const f = item.json;\n  const emoji = typeEmojis[f.type] || '📌';\n  const typeName = typeNames[f.type] || f.type;\n  \n  // Calcular días de atraso\n  const schedDate = new Date(f.scheduled_date);\n  const todayDate = new Date();\n  const daysLate = Math.floor((todayDate - schedDate) / (1000 * 60 * 60 * 24));\n  const lateText = daysLate > 0 ? ` ⚠️ (${daysLate} días de atraso)` : '';\n  \n  message += `${index + 1}. ${emoji} *${f.clients?.name || 'Cliente'}*${lateText}\\n`;\n  message += `   _${typeName}_\\n`;\n  if (f.notes) message += `   📝 ${f.notes}\\n`;\n  if (f.product_reference) message += `   📦 ${f.product_reference}\\n`;\n  message += `   📱 ${f.clients?.phone || 'Sin teléfono'}\\n\\n`;\n});\n\nmessage += `─────────────────\\n`;\nmessage += `_Total: ${followups.length} seguimiento(s) pendiente(s)_\\n`;\nmessage += `\\n💡 _Abrí Allpol Gestión > Seguimientos para gestionar_`;\n\nreturn [{ json: { message, count: followups.length } }];"
        },
        "id": "code-format",
        "name": "Formatear Mensaje",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          660,
          -100
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://automatizacion-evolution-api.aq0vtr.easypanel.host/message/sendText/Allpol",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              },
              {
                "name": "apikey",
                "value": "97D1DBC4C9E6-42E7-85E8-8E53D285C69E"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"number\": \"5492216925658@s.whatsapp.net\",\n  \"text\": {{ JSON.stringify($json.message) }}\n}",
          "options": {}
        },
        "id": "http-whatsapp",
        "name": "Enviar WhatsApp",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          880,
          -100
        ]
      },
      {
        "parameters": {},
        "id": "noop-end",
        "name": "Sin pendientes",
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          660,
          100
        ]
      }
    ],
    "connections": {
      "Cada día 9AM": {
        "main": [
          [
            {
              "node": "Get Followups Pendientes",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Followups Pendientes": {
        "main": [
          [
            {
              "node": "¿Hay pendientes?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "¿Hay pendientes?": {
        "main": [
          [
            {
              "node": "Formatear Mensaje",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Sin pendientes",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Formatear Mensaje": {
        "main": [
          [
            {
              "node": "Enviar WhatsApp",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1",
      "timezone": "America/Argentina/Buenos_Aires",
      "callerPolicy": "workflowsFromSameOwner",
      "availableInMCP": true
    },
    "staticData": {
      "node:Cada día 9AM": {
        "recurrenceRules": []
      }
    },
    "meta": null,
    "pinData": null,
    "versionId": "df8f0479-b41f-4c92-a059-1c39855392cb",
    "activeVersionId": "df8f0479-b41f-4c92-a059-1c39855392cb",
    "triggerCount": 1,
    "shared": [
      {
        "updatedAt": "2025-12-15T16:02:23.056Z",
        "createdAt": "2025-12-15T16:02:23.056Z",
        "role": "workflow:owner",
        "workflowId": "M41AzCPlhql4OhOe",
        "projectId": "CyuOAJo56zhDqPtw"
      }
    ],
    "activeVersion": {
      "updatedAt": "2025-12-15T18:09:12.904Z",
      "createdAt": "2025-12-15T18:09:12.904Z",
      "versionId": "df8f0479-b41f-4c92-a059-1c39855392cb",
      "workflowId": "M41AzCPlhql4OhOe",
      "nodes": [
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "triggerAtHour": 9
                }
              ]
            }
          },
          "id": "schedule-trigger",
          "name": "Cada día 9AM",
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.2,
          "position": [
            0,
            0
          ]
        },
        {
          "parameters": {
            "operation": "getAll",
            "tableId": "client_followups",
            "returnAll": true,
            "filterType": "string",
            "filterString": "scheduled_date=lte.{{ $now.format('yyyy-MM-dd') }}&status=eq.pending&select=*,clients(name,phone)",
            "options": {}
          },
          "id": "supabase-get",
          "name": "Get Followups Pendientes",
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            220,
            0
          ],
          "credentials": {
            "supabaseApi": {
              "id": "supabase-creds",
              "name": "Supabase Allpol"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict"
              },
              "conditions": [
                {
                  "id": "condition-check",
                  "leftValue": "={{ $input.all().length }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "number",
                    "operation": "gt"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "id": "if-hay-pendientes",
          "name": "¿Hay pendientes?",
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            440,
            0
          ]
        },
        {
          "parameters": {
            "jsCode": "const followups = $input.all();\n\nconst today = new Date().toLocaleDateString('es-AR', { \n  weekday: 'long', \n  year: 'numeric', \n  month: 'long', \n  day: 'numeric' \n});\n\nlet message = `📅 *Seguimientos pendientes*\\n${today}\\n\\n`;\n\nconst typeEmojis = {\n  'reminder': '🔔',\n  'grouping': '📦',\n  'material': '🏭'\n};\n\nconst typeNames = {\n  'reminder': 'Recordatorio',\n  'grouping': 'Oportunidad de Agrupación',\n  'material': 'Material Disponible'\n};\n\nfollowups.forEach((item, index) => {\n  const f = item.json;\n  const emoji = typeEmojis[f.type] || '📌';\n  const typeName = typeNames[f.type] || f.type;\n  \n  // Calcular días de atraso\n  const schedDate = new Date(f.scheduled_date);\n  const todayDate = new Date();\n  const daysLate = Math.floor((todayDate - schedDate) / (1000 * 60 * 60 * 24));\n  const lateText = daysLate > 0 ? ` ⚠️ (${daysLate} días de atraso)` : '';\n  \n  message += `${index + 1}. ${emoji} *${f.clients?.name || 'Cliente'}*${lateText}\\n`;\n  message += `   _${typeName}_\\n`;\n  if (f.notes) message += `   📝 ${f.notes}\\n`;\n  if (f.product_reference) message += `   📦 ${f.product_reference}\\n`;\n  message += `   📱 ${f.clients?.phone || 'Sin teléfono'}\\n\\n`;\n});\n\nmessage += `─────────────────\\n`;\nmessage += `_Total: ${followups.length} seguimiento(s) pendiente(s)_\\n`;\nmessage += `\\n💡 _Abrí Allpol Gestión > Seguimientos para gestionar_`;\n\nreturn [{ json: { message, count: followups.length } }];"
          },
          "id": "code-format",
          "name": "Formatear Mensaje",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            660,
            -100
          ]
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://automatizacion-evolution-api.aq0vtr.easypanel.host/message/sendText/Allpol",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                },
                {
                  "name": "apikey",
                  "value": "97D1DBC4C9E6-42E7-85E8-8E53D285C69E"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n  \"number\": \"5492216925658@s.whatsapp.net\",\n  \"text\": {{ JSON.stringify($json.message) }}\n}",
            "options": {}
          },
          "id": "http-whatsapp",
          "name": "Enviar WhatsApp",
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            880,
            -100
          ]
        },
        {
          "parameters": {},
          "id": "noop-end",
          "name": "Sin pendientes",
          "type": "n8n-nodes-base.noOp",
          "typeVersion": 1,
          "position": [
            660,
            100
          ]
        }
      ],
      "connections": {
        "Cada día 9AM": {
          "main": [
            [
              {
                "node": "Get Followups Pendientes",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Followups Pendientes": {
          "main": [
            [
              {
                "node": "¿Hay pendientes?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "¿Hay pendientes?": {
          "main": [
            [
              {
                "node": "Formatear Mensaje",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Sin pendientes",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Formatear Mensaje": {
          "main": [
            [
              {
                "node": "Enviar WhatsApp",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "authors": "malco fernandez",
      "name": null,
      "description": null
    },
    "tags": []
  },
  {
    "updatedAt": "2025-07-29T13:57:38.000Z",
    "createdAt": "2025-07-29T13:57:11.708Z",
    "id": "P7inH2L4zFOJD4p9",
    "name": "n8n-chat-conversational",
    "active": false,
    "isArchived": false,
    "nodes": [
      {
        "parameters": {
          "content": "### El historial de conversaciones (últimos 20 mensajes) se almacena en una memoria intermedia",
          "height": 225,
          "width": 300
        },
        "id": "8f576801-5096-4031-97d6-406330d740d1",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -48,
          400
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "### Herramientas que el agente puede utilizar para realizar la tarea",
          "height": 225,
          "width": 340
        },
        "id": "f93a2f8a-87b1-4a74-bb3f-46a940513623",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          304,
          400
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "### El agente conversacional utilizará las herramientas disponibles para responder la solicitud.",
          "height": 211,
          "width": 422
        },
        "id": "633248f4-79a5-4b27-bb37-cc3a62c97440",
        "name": "Sticky Note6",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          0,
          0
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "849971b9-8a6d-4c44-be45-97e208230bf2",
        "name": "When chat message received",
        "type": "@n8n/n8n-nodes-langchain.chatTrigger",
        "position": [
          -304,
          80
        ],
        "webhookId": "d48f9e07-3c05-4be8-86ca-5cee4c27b78f",
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "id": "d7f0523e-17d7-4e8d-83c7-14c18bb76760",
        "name": "OpenAI Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          -224,
          512
        ],
        "typeVersion": 1.2,
        "credentials": {
          "openAiApi": {
            "id": "4KlRoIAzZJhV4U20",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "contextWindowLength": 20
        },
        "id": "d1f939cf-0e0f-4480-9773-4c21073e8a2d",
        "name": "Simple Memory",
        "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "position": [
          64,
          512
        ],
        "typeVersion": 1.3
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "1ced84ec-4a27-4792-ac02-8e7318996933",
        "name": "SerpAPI",
        "type": "@n8n/n8n-nodes-langchain.toolSerpApi",
        "position": [
          368,
          512
        ],
        "typeVersion": 1
      },
      {
        "parameters": {},
        "id": "a6a277e4-723a-401f-9ddf-4dd0a84a3079",
        "name": "Wikipedia",
        "type": "@n8n/n8n-nodes-langchain.toolWikipedia",
        "position": [
          512,
          512
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "155adda9-f40a-411b-a95a-443b1143d3f5",
        "name": "AI Agent",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          80,
          80
        ],
        "typeVersion": 1.8
      }
    ],
    "connections": {
      "SerpAPI": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Wikipedia": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Simple Memory": {
        "ai_memory": [
          [
            {
              "node": "AI Agent",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "When chat message received": {
        "main": [
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": null,
    "pinData": {},
    "versionId": "d56bca4e-9744-40c8-8465-a8a49cf0dd98",
    "activeVersionId": null,
    "triggerCount": 0,
    "shared": [
      {
        "updatedAt": "2025-07-29T13:57:11.718Z",
        "createdAt": "2025-07-29T13:57:11.718Z",
        "role": "workflow:owner",
        "workflowId": "P7inH2L4zFOJD4p9",
        "projectId": "CyuOAJo56zhDqPtw"
      }
    ],
    "activeVersion": null,
    "tags": []
  },
  {
    "updatedAt": "2025-07-09T19:00:54.000Z",
    "createdAt": "2025-06-20T02:51:26.992Z",
    "id": "QO38vJeFnnqWKYlc",
    "name": "Gestor de Gastos",
    "active": false,
    "isArchived": false,
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "recibir-mensaje",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          -208,
          -64
        ],
        "id": "7b29c7e9-c760-4267-9b0b-252adcd9dc9a",
        "name": "Webhook - recibir mensaje por whatsapp",
        "webhookId": "13cc1ee2-de58-4855-b2fb-9e471b475605"
      },
      {
        "parameters": {
          "inputText": "={{ $json.body.data.message.conversation }}",
          "categories": {
            "categories": [
              {
                "category": "nuevo gasto",
                "description": "el usuario pretende añadir un nuevo gasto"
              },
              {
                "category": "consultas",
                "description": "el usuario pretende información sobre gastos guardados"
              }
            ]
          },
          "options": {
            "fallback": "discard"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.textClassifier",
        "typeVersion": 1.1,
        "position": [
          240,
          -64
        ],
        "id": "2a59a1a1-4909-4981-81d2-1481dcb796f1",
        "name": "Text Classifier"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "claude-3-5-sonnet-20241022",
            "mode": "list",
            "cachedResultName": "Claude Sonnet 3.5 (New)"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
        "typeVersion": 1.3,
        "position": [
          352,
          160
        ],
        "id": "fb532456-d481-4621-b69e-0754938e6e6d",
        "name": "Anthropic Chat Model",
        "credentials": {
          "anthropicApi": {
            "id": "KvZF7MNs1iI9NLKB",
            "name": "Anthropic account"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "b410bce2-ca6a-456f-8259-b4c9d77f92e3",
                "leftValue": "={{ $json.body.data.pushName }}",
                "rightValue": "Malco Fernandez",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2.2,
        "position": [
          32,
          -64
        ],
        "id": "0813acb7-2e9b-4de1-84cb-a023f5de08b7",
        "name": "Filter"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.body.data.message.conversation }}",
          "options": {
            "systemMessage": "Eres un agente de procesamiento de texto especializado en la interpretación de mensajes sobre gastos. Tu objetivo es extraer de forma precisa y estructurada la siguiente información clave del mensaje de entrada, adhiriéndote estrictamente a los formatos y categorías definidos.\n\nInstrucciones de Extracción:\nAnaliza el mensaje completo para identificar todos los datos relevantes.\n\nFormatea la salida como un objeto JSON con las siguientes claves. Asegúrate de que todas las claves estén presentes, incluso si su valor es nulo o por defecto.\n\n\nReglas Específicas para Cada Campo:\nfecha:\n\nExtrae la fecha explícitamente mencionada en el mensaje (ej., \"fecha de factura\", \"pagado el\").\n\nFormato: YYYY-MM-DD.\n\nSi no se encuentra fecha: Usa la fecha actual del sistema. Considera la fecha actual como 2025-06-29.\n\nemisor:\n\nIdentifica el nombre de la empresa o persona que emite el gasto.\n\nSi no se encuentra emisor: Asigna el valor \"sin emisor\".\n\ndetalle:\n\nCrea un array de strings. Cada elemento debe representar un ítem o concepto de gasto individualizado.\n\nSé lo más específico posible. Si se listan varios productos o servicios, sepáralos en elementos distintos del array.\n\ncategoria:\n\nAsigna una única categoría de la siguiente lista predefinida: comidas, viajes, cosas ricas, servicios, casa, auto, mascotas.\n\nPrioriza la categoría más relevante si el gasto podría encajar en varias. Si la información es ambigua, elige la que parezca más apropiada por el contexto general del mensaje.\n\nsub_total:\n\nExtrae el monto total del gasto antes de impuestos.\n\nFormato: Número flotante (ej., 123.45).\n\nSi no se especifica subtotal pero hay un total: Calcula el subtotal si los impuestos son conocidos.\n\nimpuestos:\n\nExtrae el monto total de los impuestos aplicados al gasto.\n\nFormato: Número flotante (ej., 12.30).\n\nSi no se mencionan impuestos: Asigna el valor 0.00.\n\ntotal_con_impuestos:\n\nExtrae el monto total final del gasto, incluyendo impuestos.\n\nFormato: Número flotante (ej., 135.75).\n\nSi solo hay un monto mencionado y no se distingue subtotal/impuestos: Asume que este es el total_con_impuestos y, si los impuestos no se mencionan, establece sub_total igual a total_con_impuestos e impuestos a 0.00.\n\nVerificación: Asegúrate de que total_con_impuestos sea igual o muy cercano a sub_total + impuestos (permite pequeñas diferencias por redondeo, pero si hay una discrepancia significativa, prioriza el total_con_impuestos explícito).\n\nextras:\n\nRecopila cualquier información adicional presente en el mensaje que no encaje en las categorías anteriores, pero que pueda ser relevante (ej., métodos de pago, notas específicas, referencias).\n\nSi no hay información extra: Asigna una cadena vacía \"\".\n\ncargado_por:\n\nEste campo es fijo. Asigna siempre el valor \"Malco\".\n\nConsideraciones Adicionales:\nTolerancia a errores de entrada: Sé robusto ante variaciones en el lenguaje, abreviaciones o errores tipográficos menores.\n\nClaridad sobre ambigüedad: Si alguna información es ambigua, haz la interpretación más lógica y conseradora y refleja esto en la salida. No inventes datos.\n\nPriorización de datos numéricos: Los valores numéricos (subtotal, impuestos, total) deben ser extraídos con alta precisión."
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 2,
        "position": [
          608,
          -160
        ],
        "id": "c8ee86c1-26d9-4dfa-917d-96225dea0a94",
        "name": "AI Agent"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatDeepSeek",
        "typeVersion": 1,
        "position": [
          608,
          64
        ],
        "id": "dbdac4a6-a557-44b2-b03f-35041d492893",
        "name": "DeepSeek Chat Model",
        "credentials": {
          "deepSeekApi": {
            "id": "l9T4qmBFqTej3Qxo",
            "name": "DeepSeek account"
          }
        }
      },
      {
        "parameters": {
          "jsonSchemaExample": "{\n  \"fecha\": \"YYYY-MM-DD\",\n  \"emisor\": \"string\",\n  \"detalle\": \"array de strings\",\n  \"categoria\": \"string\",\n  \"sub_total\": \"float\",\n  \"impuestos\": \"float\",\n  \"total_con_impuestos\": \"float\",\n  \"extras\": \"string\",\n  \"cargado_por\": \"Malco\"\n}"
        },
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          800,
          64
        ],
        "id": "8fd0b342-bbef-4f27-bb91-803251fbf9cb",
        "name": "Structured Output Parser"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": ""
          }
        },
        "type": "n8n-nodes-base.googleSheetsTool",
        "typeVersion": 4.6,
        "position": [
          928,
          64
        ],
        "id": "781ecdc8-d452-4382-b468-665b11738c6b",
        "name": "Google Sheets"
      }
    ],
    "connections": {
      "Webhook - recibir mensaje por whatsapp": {
        "main": [
          [
            {
              "node": "Filter",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Anthropic Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Text Classifier",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Filter": {
        "main": [
          [
            {
              "node": "Text Classifier",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Text Classifier": {
        "main": [
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "DeepSeek Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Structured Output Parser": {
        "ai_outputParser": [
          [
            {
              "node": "AI Agent",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Google Sheets": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": {
      "templateCredsSetupCompleted": true
    },
    "pinData": {},
    "versionId": "31cf1671-84ea-4563-986e-0f3074e4fdb1",
    "activeVersionId": null,
    "triggerCount": 0,
    "shared": [
      {
        "updatedAt": "2025-06-20T02:51:26.995Z",
        "createdAt": "2025-06-20T02:51:26.995Z",
        "role": "workflow:owner",
        "workflowId": "QO38vJeFnnqWKYlc",
        "projectId": "CyuOAJo56zhDqPtw"
      }
    ],
    "activeVersion": null,
    "tags": []
  },
  {
    "updatedAt": "2025-08-22T00:56:20.000Z",
    "createdAt": "2025-08-22T00:56:20.619Z",
    "id": "RpTYO3XGVfE22Xen",
    "name": "My workflow",
    "active": false,
    "isArchived": false,
    "nodes": [
      {
        "parameters": {
          "updates": [
            "message"
          ],
          "additionalFields": {}
        },
        "type": "n8n-nodes-base.telegramTrigger",
        "typeVersion": 1.2,
        "position": [
          112,
          208
        ],
        "id": "a8a07d88-aedf-426f-a286-ebd64cd3d294",
        "name": "Telegram Trigger",
        "webhookId": "be0f74d0-76b4-4ac4-ab1d-b9a9e51252f4"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.message.text }}",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "exists",
                        "singleValue": true
                      },
                      "id": "2de0e1d8-b75f-4504-af83-7f8c0bf31740"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "texto"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "b8952dfe-545d-495a-a5ce-4094deef7bd2",
                      "leftValue": "={{ $json.message.voice.file_id }}",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "exists",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "audio"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "e041e04e-5ffb-42a5-9642-79e3affbd40c",
                      "leftValue": "={{ $json.message.photo[0].file_id }}",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "exists",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "imagen"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          288,
          208
        ],
        "id": "9bd02e29-29cc-47fe-9593-1253f47f8817",
        "name": "Switch"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "8785e0f6-f706-4415-9994-ffe55e68c6a3",
                "name": "text",
                "value": "={{ $json.message.text }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          512,
          48
        ],
        "id": "c4afe816-b9cd-4098-9e61-626d47f3e7a5",
        "name": "Edit Fields"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $('Merge').item.json.text }}",
          "options": {
            "systemMessage": "=#Descripción General:\nEres mi agente de finanzas personal, te encargas de añadir los gastos y los ingresos que te voy diciendo utilizando las herramientas que tienes a continuación y me dirás la información de los gastos o ingresos según te lo solicite, a parte también te encargas de agendarme citas y añadir contactos nuevos, también pueden enviar email y mensajes de texto a los contactos cuando yo te lo pida.\n\n##Herramientas:\n-(Calculadora) sirve para que puedas realizar las operaciones necesarias cuando te pida datos en los que necesites hacer operaciones matemáticas.\n-(Gastos) Aquí añadirás los gastos que te vaya diciendo\n-(Ver Gastos) te servirá para consultar los gastos que he tenido.\n-(Ingresos) Aquí añadirás los ingresos que te vaya diciendo\n-Ver Ingresos) te servirá para consultar los ingresos que he realizado.\n-(Contactos) te sirve para crear contactos nuevos\n-(Ver Contactos) Te sirve para enviar mensajes y también email a los contactos y recibir la información de los contactos.\n-(Gmail) sirve para enviar email\n-(AGREGAR CITAS) sirve para añdir citas al calenadrio\n-(VER CITAS) sirve para obtener información de las citas\n\n## Reglas\nCuando envies los datos al sheet rellena los datos correctamente.\nAsegurate de añadir las citas al calendario en la fecha correcta\nCuando vayas a finalizar la conversación añade esto: Recuerda suscribirte al canal 😃 https://youtube.com/@agentesinteligenciaartificial?si=6tiMpXU0X8GAPKiD\nSi ya lo has enviado en el mismo chat no vuelvas a enviarlo.\n\n## Recordatorios Finales  \nLa fecha y hora actuales son: {{ $now }}"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.9,
        "position": [
          864,
          432
        ],
        "id": "0c9dd92a-5096-4d02-8f08-e9ea0bba4633",
        "name": "AI Agent"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          752,
          704
        ],
        "id": "280b8fe1-8746-4710-b585-c28033a4558b",
        "name": "OpenAI Chat Model"
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
        },
        "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "typeVersion": 1.3,
        "position": [
          912,
          704
        ],
        "id": "a4dbcd3b-5693-4bd0-b09f-90679db743af",
        "name": "Simple Memory"
      },
      {
        "parameters": {},
        "type": "@n8n/n8n-nodes-langchain.toolCalculator",
        "typeVersion": 1,
        "position": [
          1232,
          832
        ],
        "id": "2eef2080-158d-44a8-bd36-6f93b7ac99bf",
        "name": "Calculator"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "1j1f265tfHAq6UhMzs6U84Q5wWYq8-NS9jkBkRQsvmN8",
            "mode": "list",
            "cachedResultName": "Gastos Mensuales",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1j1f265tfHAq6UhMzs6U84Q5wWYq8-NS9jkBkRQsvmN8/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Hoja 1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1j1f265tfHAq6UhMzs6U84Q5wWYq8-NS9jkBkRQsvmN8/edit#gid=0"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Tipo de Gasto": "={{ $('Code').item.json.Tipo }}",
              "Importe": "={{ $('Code').item.json.Importe }}",
              "Dia": "={{ $('Code').item.json.Dia }}",
              "Mes": "={{ $('Code').item.json.Mes }}",
              "Año": "={{ $('Code').item.json['Año'] }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "Tipo de Gasto",
                "displayName": "Tipo de Gasto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Importe",
                "displayName": "Importe",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Dia",
                "displayName": "Dia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Mes",
                "displayName": "Mes",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Año",
                "displayName": "Año",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheetsTool",
        "typeVersion": 4.5,
        "position": [
          1328,
          832
        ],
        "id": "cd4ec915-f95f-4d4d-b511-6c4440728ee7",
        "name": "Gastos"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "1Lx-CqbvP8quTko2c7ylL2iJJzlYrjshJeH7Hwlgnn_M",
            "mode": "list",
            "cachedResultName": "Ingresos Mensuales",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Lx-CqbvP8quTko2c7ylL2iJJzlYrjshJeH7Hwlgnn_M/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Hoja 1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Lx-CqbvP8quTko2c7ylL2iJJzlYrjshJeH7Hwlgnn_M/edit#gid=0"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Importe": "={{ $('Code').item.json.Importe }}",
              "Dia": "={{ $('Code').item.json.Dia }}",
              "Mes": "={{ $('Code').item.json.Mes }}",
              "Año": "={{ $('Code').item.json['Año'] }}",
              "Tipo de Ingreso": "={{ $('Code').item.json.Tipo }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "Tipo de Ingreso",
                "displayName": "Tipo de Ingreso",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Importe",
                "displayName": "Importe",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Dia",
                "displayName": "Dia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Mes",
                "displayName": "Mes",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Año",
                "displayName": "Año",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheetsTool",
        "typeVersion": 4.5,
        "position": [
          1520,
          832
        ],
        "id": "b127bc1c-6bea-459f-9747-fa6bc4680743",
        "name": "Ingresos"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "1j1f265tfHAq6UhMzs6U84Q5wWYq8-NS9jkBkRQsvmN8",
            "mode": "list",
            "cachedResultName": "Gastos Mensuales",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1j1f265tfHAq6UhMzs6U84Q5wWYq8-NS9jkBkRQsvmN8/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Hoja 1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1j1f265tfHAq6UhMzs6U84Q5wWYq8-NS9jkBkRQsvmN8/edit#gid=0"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheetsTool",
        "typeVersion": 4.5,
        "position": [
          1424,
          832
        ],
        "id": "a6171c2c-6cb5-4ec8-94b5-8dc5c1bf14de",
        "name": "Ver Gastos"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "1Lx-CqbvP8quTko2c7ylL2iJJzlYrjshJeH7Hwlgnn_M",
            "mode": "list",
            "cachedResultName": "Ingresos Mensuales",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Lx-CqbvP8quTko2c7ylL2iJJzlYrjshJeH7Hwlgnn_M/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Hoja 1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Lx-CqbvP8quTko2c7ylL2iJJzlYrjshJeH7Hwlgnn_M/edit#gid=0"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheetsTool",
        "typeVersion": 4.5,
        "position": [
          1632,
          832
        ],
        "id": "144020fb-f12a-4a1b-b8b6-f8ec4beebf2c",
        "name": "Ver Ingresos"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "1ZacvpinSkU10bXV7Fcau1SFu-DQtAN5ubzEpIARGIq4",
            "mode": "list",
            "cachedResultName": "Contactos Nuevos",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ZacvpinSkU10bXV7Fcau1SFu-DQtAN5ubzEpIARGIq4/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Hoja 1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ZacvpinSkU10bXV7Fcau1SFu-DQtAN5ubzEpIARGIq4/edit#gid=0"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Email": "={{ $('Code').item.json.Contacto_Email }}",
              "Telefono": "={{ $('Code').item.json.Contacto_Telefono }}",
              "Nombre": "={{ $('Code').item.json.Contacto_Nombre }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "Nombre",
                "displayName": "Nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Telefono",
                "displayName": "Telefono",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Email",
                "displayName": "Email",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheetsTool",
        "typeVersion": 4.5,
        "position": [
          1728,
          832
        ],
        "id": "4ca9c136-a395-4862-91a5-55fdb640fb94",
        "name": "Contactos"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "1ZacvpinSkU10bXV7Fcau1SFu-DQtAN5ubzEpIARGIq4",
            "mode": "list",
            "cachedResultName": "Contactos Nuevos",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ZacvpinSkU10bXV7Fcau1SFu-DQtAN5ubzEpIARGIq4/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Hoja 1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ZacvpinSkU10bXV7Fcau1SFu-DQtAN5ubzEpIARGIq4/edit#gid=0"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheetsTool",
        "typeVersion": 4.5,
        "position": [
          1824,
          832
        ],
        "id": "9867b2f8-d086-497a-8a3c-40189aa7237b",
        "name": "Ver Contactos"
      },
      {
        "parameters": {
          "numberInputs": 3
        },
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3.1,
        "position": [
          912,
          208
        ],
        "id": "ee33f6f4-cd85-4b22-8277-0f3f07b5d6d9",
        "name": "Merge"
      },
      {
        "parameters": {
          "jsCode": "const mensaje = $input.item.json.text;\nconst fecha = new Date();\nlet output = {};\n\n// === GASTOS ===\nconst patronesGasto = [\n  /(\\d+)(?:\\s*euros?)?\\s+de\\s+gastos?\\s+de\\s+(.*)/i,\n  /gasto\\s+(\\d+)(?:\\s*euros?)?\\s+en\\s+(.*)/i,\n  /(\\d+)(?:\\s*euros?)?\\s+(.*)/i,\n  /añade\\s+(\\d+)(?:\\s*euros?)?\\s+(.*)/i,\n  /ayer\\s+(\\d+)(?:\\s*euros?)?\\s+(.*)/i\n];\n\nfor (const regex of patronesGasto) {\n  const match = mensaje.match(regex);\n  if (match) {\n    const importe = parseFloat(match[1]);\n    const tipoGasto = match[2].trim();\n\n    if (/ayer/i.test(mensaje)) {\n      fecha.setDate(fecha.getDate() - 1);\n    }\n\n    output = {\n      ...output,\n      Tipo: tipoGasto,\n      Importe: importe,\n      Dia: fecha.getDate(),\n      Mes: fecha.getMonth() + 1,\n      Año: fecha.getFullYear()\n    };\n\n    break;\n  }\n}\n\n// === CONTACTO ===\nconst contactoRegex = /(?:añade\\s+el\\s+)?contacto[:\\s]*[\"']?(.+?)[\"']?[,;\\s]+(\\d{6,})[,;\\s]+([\\w\\.-]+@[\\w\\.-]+\\.\\w+)/i;\nconst contactoMatch = mensaje.match(contactoRegex);\n\nif (contactoMatch) {\n  output = {\n    ...output,\n    Contacto_Nombre: contactoMatch[1].trim(),\n    Contacto_Telefono: contactoMatch[2].replace(/\\s+/g, \"\"),\n    Contacto_Email: contactoMatch[3].trim()\n  };\n}\n\n// === CITA ===\nconst citaRegex = /(?:el\\s+)?(?:día\\s+)?(\\d{1,2})(?:[\\/\\-\\.](\\d{1,2}))(?:[\\/\\-\\.](\\d{2,4}))?.*?(?:a\\s+las\\s+)?(\\d{1,2})(?::(\\d{2}))?/i;\nconst citaSimple = /(?:el\\s+)?(\\d{1,2})\\s+de\\s+([a-zA-Z]+).*?(\\d{1,2})(?::(\\d{2}))?/i;\nconst citaRelativa = /(mañana|pasado mañana|hoy|lunes|martes|miércoles|jueves|viernes|sábado|domingo).*?(\\d{1,2})(?::(\\d{2}))?/i;\n\nconst meses = {\n  enero: 0, febrero: 1, marzo: 2, abril: 3, mayo: 4, junio: 5,\n  julio: 6, agosto: 7, septiembre: 8, octubre: 9, noviembre: 10, diciembre: 11\n};\n\nfunction getDiaDeLaSemana(diaPalabra) {\n  const dias = [\"domingo\", \"lunes\", \"martes\", \"miércoles\", \"jueves\", \"viernes\", \"sábado\"];\n  const hoy = new Date();\n  const hoyNum = hoy.getDay();\n  const buscado = dias.indexOf(diaPalabra.toLowerCase());\n  let diferencia = buscado - hoyNum;\n  if (diferencia <= 0) diferencia += 7;\n  const fechaFinal = new Date();\n  fechaFinal.setDate(hoy.getDate() + diferencia);\n  return fechaFinal;\n}\n\nlet citaMatch = mensaje.match(citaRegex);\nif (citaMatch) {\n  const dia = parseInt(citaMatch[1]);\n  const mes = parseInt(citaMatch[2]) - 1;\n  const año = citaMatch[3] ? parseInt(citaMatch[3]) : new Date().getFullYear();\n  const hora = parseInt(citaMatch[4]);\n  const minutos = citaMatch[5] ? parseInt(citaMatch[5]) : 0;\n\n  const fechaCita = new Date(año, mes, dia, hora, minutos);\n\n  output = {\n    ...output,\n    Cita_FechaCompleta: fechaCita.toISOString(),\n    Cita_Dia: dia,\n    Cita_Mes: mes + 1,\n    Cita_Año: año,\n    Cita_Hora: hora,\n    Cita_Minutos: minutos\n  };\n} else if ((citaMatch = mensaje.match(citaSimple))) {\n  const dia = parseInt(citaMatch[1]);\n  const mesTexto = citaMatch[2].toLowerCase();\n  const mes = meses[mesTexto] ?? new Date().getMonth();\n  const hora = parseInt(citaMatch[3]);\n  const minutos = citaMatch[4] ? parseInt(citaMatch[4]) : 0;\n  const año = new Date().getFullYear();\n  const fechaCita = new Date(año, mes, dia, hora, minutos);\n\n  output = {\n    ...output,\n    Cita_FechaCompleta: fechaCita.toISOString(),\n    Cita_Dia: dia,\n    Cita_Mes: mes + 1,\n    Cita_Año: año,\n    Cita_Hora: hora,\n    Cita_Minutos: minutos\n  };\n} else if ((citaMatch = mensaje.match(citaRelativa))) {\n  let fecha = new Date();\n  const palabra = citaMatch[1].toLowerCase();\n  if (palabra === \"mañana\") {\n    fecha.setDate(fecha.getDate() + 1);\n  } else if (palabra === \"pasado mañana\") {\n    fecha.setDate(fecha.getDate() + 2);\n  } else if (palabra !== \"hoy\") {\n    fecha = getDiaDeLaSemana(palabra);\n  }\n\n  const hora = parseInt(citaMatch[2]);\n  const minutos = citaMatch[3] ? parseInt(citaMatch[3]) : 0;\n  fecha.setHours(hora);\n  fecha.setMinutes(minutos);\n\n  output = {\n    ...output,\n    Cita_FechaCompleta: fecha.toISOString(),\n    Cita_Dia: fecha.getDate(),\n    Cita_Mes: fecha.getMonth() + 1,\n    Cita_Año: fecha.getFullYear(),\n    Cita_Hora: hora,\n    Cita_Minutos: minutos\n  };\n}\n\n// === MENSAJE VACÍO → dejar pasar mensaje original si no se extrajo nada\nif (Object.keys(output).length === 0) {\n  return [{\n    json: {\n      texto_original: mensaje\n    }\n  }];\n}\n\n// === SALIDA FINAL\nreturn [{ json: output }];\n\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1152,
          208
        ],
        "id": "4dc558f9-b916-4507-b903-738b7903f408",
        "name": "Code"
      },
      {
        "parameters": {
          "sendTo": "={{ $fromAI('To', ``, 'string') }}",
          "subject": "={{ $fromAI('Subject', ``, 'string') }}",
          "message": "={{ $fromAI('Message', ``, 'string') }} \nNo olvides suscribirte al canal https://youtube.com/@agentesinteligenciaartificial?si=6tiMpXU0X8GAPKiD",
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.gmailTool",
        "typeVersion": 2.1,
        "position": [
          1920,
          832
        ],
        "id": "7048197c-a960-4423-bc56-08f170d0b5c1",
        "name": "Gmail",
        "webhookId": "db4358b5-ce03-4328-8596-fa8d4281bb23"
      },
      {
        "parameters": {
          "calendar": {
            "__rl": true,
            "value": "9a609688b40d3b3d37bab99ecb519bfcbbf803b7b8fdc62c045972d3369efe44@group.calendar.google.com",
            "mode": "list",
            "cachedResultName": "CITAS ASISTENTE"
          },
          "start": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}",
          "end": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}",
          "additionalFields": {
            "description": "={{ $('Merge').item.json.text }}",
            "summary": "={{ $('Code').item.json.Tipo }}"
          }
        },
        "type": "n8n-nodes-base.googleCalendarTool",
        "typeVersion": 1.3,
        "position": [
          1104,
          832
        ],
        "id": "acc79b2d-ed57-4d07-ad5f-e62839e720a0",
        "name": "AGREGAR CITAS"
      },
      {
        "parameters": {
          "descriptionType": "manual",
          "toolDescription": "Busca las citas que tengo en el calendario que se parezcan a la consulta",
          "operation": "get",
          "calendar": {
            "__rl": true,
            "value": "9a609688b40d3b3d37bab99ecb519bfcbbf803b7b8fdc62c045972d3369efe44@group.calendar.google.com",
            "mode": "list",
            "cachedResultName": "CITAS ASISTENTE"
          },
          "eventId": "={{ $fromAI('Event_ID', ``, 'string') }}",
          "options": {
            "timeZone": {
              "__rl": true,
              "value": "Europe/Madrid",
              "mode": "list",
              "cachedResultName": "Europe/Madrid"
            }
          }
        },
        "type": "n8n-nodes-base.googleCalendarTool",
        "typeVersion": 1.3,
        "position": [
          960,
          832
        ],
        "id": "7ab2e166-ee90-4764-a015-240256eb2ed9",
        "name": "VER CITAS"
      },
      {
        "parameters": {
          "content": "ASISTENTE PERSONAL y ASISTENTE FINANCIERO!!\nControla todos tus gastos y tu agenda con tus contactos",
          "height": 960,
          "width": 2060
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          0,
          0
        ],
        "typeVersion": 1,
        "id": "8179e4da-aa45-4d0a-b47b-39d2290cd500",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "resource": "file",
          "fileId": "={{ $json.message.voice.file_id }}",
          "additionalFields": {}
        },
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          512,
          208
        ],
        "id": "52ca5c8b-7168-4531-8bb8-18955b40f15c",
        "name": "Audio Telegram",
        "webhookId": "19fae0ff-7795-443a-90c5-4291fbe6ae06"
      },
      {
        "parameters": {
          "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
          "text": "={{ $json.output }}\n",
          "additionalFields": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          1328,
          432
        ],
        "id": "331e607c-bb22-4c73-ac83-0f0990b18cd3",
        "name": "Enviar Mensaje",
        "webhookId": "a12d0a29-3a06-4cd6-9d22-8757e28af558",
        "notesInFlow": false
      },
      {
        "parameters": {
          "resource": "audio",
          "operation": "transcribe",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          672,
          208
        ],
        "id": "a11a5558-30e3-4485-b162-10c7e66eab36",
        "name": "Transcriptor"
      }
    ],
    "connections": {
      "Telegram Trigger": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Edit Fields",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Audio Telegram",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Simple Memory": {
        "ai_memory": [
          [
            {
              "node": "AI Agent",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent": {
        "main": [
          [
            {
              "node": "Enviar Mensaje",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculator": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Gastos": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Ingresos": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Ver Gastos": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Ver Ingresos": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Contactos": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Ver Contactos": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Merge": {
        "main": [
          [
            {
              "node": "Code",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code": {
        "main": [
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gmail": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "AGREGAR CITAS": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "VER CITAS": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Audio Telegram": {
        "main": [
          [
            {
              "node": "Transcriptor",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Transcriptor": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 1
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": null,
    "pinData": {},
    "versionId": "40105217-c6fc-4d52-8e16-3577307994f0",
    "activeVersionId": null,
    "triggerCount": 0,
    "shared": [
      {
        "updatedAt": "2025-08-22T00:56:20.662Z",
        "createdAt": "2025-08-22T00:56:20.662Z",
        "role": "workflow:owner",
        "workflowId": "RpTYO3XGVfE22Xen",
        "projectId": "CyuOAJo56zhDqPtw"
      }
    ],
    "activeVersion": null,
    "tags": [
      {
        "updatedAt": "2025-08-22T00:55:44.141Z",
        "createdAt": "2025-08-22T00:55:44.141Z",
        "id": "0KpvxAXYSSyyfxeJ",
        "name": "Aitech2.com"
      },
      {
        "updatedAt": "2025-08-22T00:55:44.152Z",
        "createdAt": "2025-08-22T00:55:44.152Z",
        "id": "D4vyLTVdQAWL1u8F",
        "name": "Carlos Miró IA"
      }
    ]
  }
]